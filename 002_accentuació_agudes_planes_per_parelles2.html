<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercici de Paraules</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; overflow: hidden; }
        canvas { background-color: #f0f0f0; display: block; }
        #inputContainer {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%); text-align: center;
        }
        input { font-size: 18px; padding: 10px; margin: 5px; width: 300px; }
        #feedback {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-size: 32px; font-weight: bold; display: none;
        }
        .correct { color: green; }
        .incorrect { color: red; }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="inputContainer">
    <input type="text" id="userInput" placeholder="Escriu cada paraula i prem Enter">
</div>
<div id="feedback"></div>

<script>

// El missatge inicial
alert("ðŸ“¢ Benvingut al joc d'ortografia! âœï¸\n\n" +
      "ðŸ”¹ Escriu cada paraula que baixa, amb accent quan calgui.\n" +
      "ðŸ”¹ Escriu una paraula i prem Enter, desprÃ©s la segÃ¼ent, fins que hagis escrit totes les paraules que cauen.\n\n" +
      "ðŸ“– Recorda aquestes regles bÃ siques d'accentuaciÃ³:\n" +
      "âœ… Accentuem les paraules agudes quan acaben en a, e, i, o, u, as, es, is, os, us, en, in.\n" +
      "   âœ¨âš ï¸ Exemple: acciÃ³ perÃ² accions, entÃ©n perÃ² entens.\n\n" +
      "âœ… Accentuem les paraules planes quan NO acaben en a, e, i, o, u, as, es, is, os, us, en, in.\n" +
      "   âœ¨âš ï¸ Exemple: examen perÃ² exÃ mens, origen perÃ² orÃ­gens, jugaven perÃ² jugÃ vem i jugÃ veu.\n\n" +
      "ðŸŽ¯ Prepara't i molta sort! ðŸ€");

// ConfiguraciÃ³ del canvas
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Llista completa de grups de paraules
const allWordGroups = [
    { words: ["accio", "accions"].sort(() => Math.random() - 0.5), solutions: ["acciÃ³", "accions"] },
    { words: ["examen", "examens"].sort(() => Math.random() - 0.5), solutions: ["examen", "exÃ mens"] },
    { words: ["origen", "origens"].sort(() => Math.random() - 0.5), solutions: ["origen", "orÃ­gens"] },
    { words: ["telefon", "telefons"].sort(() => Math.random() - 0.5), solutions: ["telÃ¨fon", "telÃ¨fons"] },
    { words: ["menjaven", "menjavem", "menjaveu"].sort(() => Math.random() - 0.5), solutions: ["menjaven", "menjÃ vem", "menjÃ veu"] },
    { words: ["divan", "divans"].sort(() => Math.random() - 0.5), solutions: ["divan", "divans"] },
    { words: ["relacio", "relacions"].sort(() => Math.random() - 0.5), solutions: ["relaciÃ³", "relacions"] },
    { words: ["opinions", "opinio"].sort(() => Math.random() - 0.5), solutions: ["opinions", "opiniÃ³"] },
    { words: ["nacions", "nacio"].sort(() => Math.random() - 0.5), solutions: ["nacions", "naciÃ³"] },
    { words: ["condicions", "condicio"].sort(() => Math.random() - 0.5), solutions: ["condicions", "condiciÃ³"] },
    { words: ["depen", "depens"].sort(() => Math.random() - 0.5), solutions: ["depÃ¨n", "depens"] },
    { words: ["enten", "entens"].sort(() => Math.random() - 0.5), solutions: ["entÃ©n", "entens"] },
    { words: ["compren", "comprens"].sort(() => Math.random() - 0.5), solutions: ["comprÃ¨n", "comprens"] },
    { words: ["parlaven", "parlavem", "parlaveu"].sort(() => Math.random() - 0.5), solutions: ["parlaven", "parlÃ vem", "parlÃ veu"] },
    { words: ["jugaven", "jugaveu", "jugavem"].sort(() => Math.random() - 0.5), solutions: ["jugaven", "jugÃ veu", "jugÃ vem"] },
    { words: ["vivien", "viviem", "vivieu"].sort(() => Math.random() - 0.5), solutions: ["vivien", "vivÃ­em", "vivÃ­eu"] },
    { words: ["llegien", "llegiem", "llegieu"].sort(() => Math.random() - 0.5), solutions: ["llegien", "llegÃ­em", "llegÃ­eu"] },
    { words: ["tenien", "teniem", "tenieu"].sort(() => Math.random() - 0.5), solutions: ["tenien", "tenÃ­em", "tenÃ­eu"] },
    { words: ["venien", "veniem", "venieu"].sort(() => Math.random() - 0.5), solutions: ["venien", "venÃ­em", "venÃ­eu"] },
    { words: ["feien", "feiem", "feieu"].sort(() => Math.random() - 0.5), solutions: ["feien", "fÃ¨iem", "fÃ¨ieu"] },
    { words: ["deien", "deiem", "deieu"].sort(() => Math.random() - 0.5), solutions: ["deien", "dÃ¨iem", "dÃ¨ieu"] },
    { words: ["fessis", "fessim", "fessiu"].sort(() => Math.random() - 0.5), solutions: ["fessis", "fÃ©ssim", "fÃ©ssiu"] },
    { words: ["anessin", "anessim", "anessiu"].sort(() => Math.random() - 0.5), solutions: ["anessin", "anÃ©ssim", "anÃ©ssiu"] },
    { words: ["regim", "regims"].sort(() => Math.random() - 0.5), solutions: ["rÃ¨gim", "rÃ¨gims"] },
    { words: ["malson", "malsons"].sort(() => Math.random() - 0.5), solutions: ["malson", "malsons"] },
    { words: ["pentagon", "pentagons"].sort(() => Math.random() - 0.5), solutions: ["pentÃ gon", "pentÃ gons"] },
    { words: ["segon", "segons"].sort(() => Math.random() - 0.5), solutions: ["segon", "segons"] },
    { words: ["caiman", "caimans"].sort(() => Math.random() - 0.5), solutions: ["caiman", "caimans"] },
    { words: ["organ", "organs"].sort(() => Math.random() - 0.5), solutions: ["Ã²rgan", "Ã²rgans"] },
    { words: ["platan", "platans"].sort(() => Math.random() - 0.5), solutions: ["plÃ tan", "plÃ tans"] },
    { words: ["tobogan", "tobogans"].sort(() => Math.random() - 0.5), solutions: ["tobogan", "tobogans"] },
    { words: ["algun", "alguns"].sort(() => Math.random() - 0.5), solutions: ["algun", "alguns"] },
    { words: ["Berlin"].sort(() => Math.random() - 0.5), solutions: ["BerlÃ­n"] },
    { words: ["havien", "haviem", "havieu"].sort(() => Math.random() - 0.5), solutions: ["havien", "havÃ­em", "havÃ­eu"] }
];

// Barregem tots els grups i nomÃ©s n'agafem 10
const wordGroups = allWordGroups.sort(() => Math.random() - 0.5).slice(0, 10);

// Variables de control
let fallingWords = [];
let currentGroupIndex = 0;
let userAnswers = [];
let gameFinished = false;   // Indica quan el joc finalitza
let score = 0;             // Contador de grups encertats

// Inicia un nou grup de paraules
function startNewWords() {
    if (currentGroupIndex < wordGroups.length) {
        const baseX = Math.random() * (canvas.width - 200);
        fallingWords = wordGroups[currentGroupIndex].words.map((word, i) => ({
            word,
            x: baseX,
            y: -30 - (i * 100)
        }));
        userAnswers = [];
        currentGroupIndex++;
    } else {
        // Quan hem exhaurit tots els grups, finalitzem
        finalizeGame();
    }
}

// Comprova la paraula de l'usuari
function checkAnswer() {
    const inputWord = userInput.value.trim();
    userAnswers.push(inputWord);

    // Un cop hem respost tantes paraules com cauen en aquest grup
    if (userAnswers.length === fallingWords.length) {
        const correctSolutions = wordGroups[currentGroupIndex - 1].solutions;
        const isCorrect = userAnswers.every(ans => correctSolutions.includes(ans));

        if (isCorrect) {
            showFeedback("Correcte!", "correct");
            score++; // augmenta puntuaciÃ³ si tot el grup Ã©s correcte
        } else {
            showFeedback("Incorrecte! Era: " + correctSolutions.join(", "), "incorrect");
        }

        // DesprÃ©s d'uns segons, passem al segÃ¼ent grup o finalitzem el joc
        setTimeout(() => {
            if (currentGroupIndex < wordGroups.length) {
                startNewWords();
            } else {
                finalizeGame();
            }
        }, 2000);
    }
    userInput.value = "";
}

// Mostra missatges a la pantalla
function showFeedback(message, className) {
    const feedback = document.getElementById("feedback");
    feedback.innerText = message;
    feedback.className = className;
    feedback.style.display = "block";
    setTimeout(() => {
        feedback.style.display = "none";
    }, 2000);
}

// Quan hem acabat tots els grups
function finalizeGame() {
    // Marca el joc com finalitzat i neteja la pantalla
    gameFinished = true;
    fallingWords = []; // aixÃ­ no es dibuixen mÃ©s paraules
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Mostra la puntuaciÃ³ final
    showFeedback(`Joc completat! Has encertat ${score} de ${wordGroups.length} grups.`, "correct");
}

// AnimaciÃ³ de la caiguda de paraules
function updateGame() {
    // Si el joc s'ha acabat, no continuem
    if (gameFinished) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    fallingWords.forEach(obj => {
        obj.y += 0.5; // velocitat de caiguda
        ctx.font = "24px Arial";
        ctx.fillText(obj.word, obj.x, obj.y);
    });

    requestAnimationFrame(updateGame);
}

// Event listener per Enter a l'input
const userInput = document.getElementById("userInput");
userInput.addEventListener("keydown", event => {
    if (event.key === "Enter") checkAnswer();
});

// Quan es carrega la pÃ gina, engeguem el joc
window.onload = () => {
    userInput.focus();
    startNewWords();
    updateGame();
};
</script>
</body>
</html>
