<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8" />
<title>Relaciona: Jocs en polon√®s</title>
<style>
body {
  font-family: 'Georgia', serif;
  max-width: 900px;
  margin: auto;
  padding: 20px;
  background: #fff;
  color: #000;
}
h1 {
  color: #003366;
}
#tema-selector {
  margin-bottom: 20px;
}
#tema-selector select {
  padding: 6px;
  font-size: 14px;
}
.match-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2em;
  padding: 20px 0;
  min-height: 400px;
  position: relative;
}
.match-lines {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}
.col {
  display: flex;
  flex-direction: column;
}
.item {
  padding: 10px;
  border: 1px solid #ccc;
  margin-bottom: 6px;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.2s ease, border 0.2s ease;
  background-color: #fff;
}
.selected {
  background-color: #d0ebff;
}
.matched {
  border: 2px solid green;
  background-color: #e8fbe8;
}
.fixed-pol {
  border: 2px solid orange;
  background-color: #fffacc !important;
}
.fixed-cat {
  border: 2px solid orange;
  background-color: #fffacc !important;
  pointer-events: none; /* Traduccions no clicables un cop resoltes */
}
.incorrect-pol, .incorrect-cat {
  border: 2px solid red;
  background-color: #ffeaea !important;
}
#score {
  font-weight: bold;
  margin-top: 1em;
  color: #003366;
}
#controls {
  margin-top: 2em;
}
#controls button {
  margin: 5px 5px 15px 0;
  padding: 6px 12px;
  font-size: 14px;
  background-color: #003366;
  color: #fff;
  border: none;
  cursor: pointer;
}
#controls button:hover {
  background-color: #005599;
}
.nota {
  margin-top: 30px;
  padding: 12px;
  background: #f4f8ff;
  border-left: 4px solid #003366;
  font-size: 14px;
}
</style>
</head>
<body>

<h1>Relaciona en polon√®s</h1>
<div id="tema-selector">
  <label for="tema">Tria un tema: </label>
  <select id="tema">
    <option value="transcripci√≥">Transcripci√≥</option>
    <option value="colors">Colors</option>
    <option value="fruites">Fruites</option>
    <option value="numeros">N√∫meros (1-10)</option>
    <option value="basiques">Paraules b√†siques</option>
  </select>
  <button onclick="canviaTema()">‚úÖ Carrega tema</button>
</div>

<div class="match-container">
  <svg class="match-lines"></svg>
  <div class="col" id="polones"></div>
  <div class="col" id="catala"></div>
</div>

<div id="score">Encerts: 0 / 10</div>
<div id="controls">
  <button onclick="novaRonda()">üîÅ Torna a comen√ßar</button>
</div>

<div class="nota">
  Verd = encert a la primera | Groc = encert despr√©s d'errors (es repetir√† a la seg√ºent ronda) | Vermell = error.
</div>

<script>
const TOTAL_PER_RONDA = 10;

const TEMES = {
  transcripcio: [
  {"id":1,"pol":"cz","cat":"tx"},
  {"id":2,"pol":"sz","cat":"x"},
  {"id":3,"pol":"≈º","cat":"j"},
  {"id":4,"pol":"rz","cat":"j"},
  {"id":5,"pol":"d≈º","cat":"dj"},
  {"id":6,"pol":"c","cat":"ts"},
  {"id":7,"pol":"ƒá","cat":"tx"},
  {"id":8,"pol":"≈õ","cat":"x"},
  {"id":9,"pol":"≈∫","cat":"j"},
  {"id":10,"pol":"≈Ñ","cat":"n"},
  {"id":11,"pol":"≈Ç","cat":"u"},
  {"id":12,"pol":"ƒÖ","cat":"on"},
  {"id":13,"pol":"ƒô","cat":"en"},
  {"id":14,"pol":"√≥","cat":"u"},
  {"id":15,"pol":"y","cat":"e"},
  {"id":16,"pol":"j","cat":"i"},
  {"id":17,"pol":"w","cat":"v"},
  {"id":18,"pol":"ch","cat":"j castellana"},
  {"id":19,"pol":"si(+vocal)","cat":"x"},
  {"id":20,"pol":"zi(+vocal)","cat":"j"},
  {"id":21,"pol":"ci(+vocal)","cat":"tx"},
  {"id":22,"pol":"ni(+vocal)","cat":"ny"}
],
  colors: [
    {"id":1,"pol":"bia≈Çy","cat":"blanc"},
    {"id":2,"pol":"czarny","cat":"negre"},
    {"id":3,"pol":"czerwony","cat":"vermell"},
    {"id":4,"pol":"niebieski","cat":"blau"},
    {"id":5,"pol":"zielony","cat":"verd"},
    {"id":6,"pol":"≈º√≥≈Çty","cat":"groc"},
    {"id":7,"pol":"pomara≈Ñczowy","cat":"taronja"},
    {"id":8,"pol":"r√≥≈ºowy","cat":"rosa"},
    {"id":9,"pol":"fioletowy","cat":"lila"},
    {"id":10,"pol":"brƒÖzowy","cat":"marr√≥"},
    {"id":11,"pol":"szary","cat":"gris"},
    {"id":12,"pol":"be≈ºowy","cat":"beix"}
  ],
  fruites: [
    {"id":1,"pol":"jab≈Çko","cat":"poma"},
    {"id":2,"pol":"gruszka","cat":"pera"},
    {"id":3,"pol":"banan","cat":"pl√†tan"},
    {"id":4,"pol":"pomara≈Ñcza","cat":"taronja"},
    {"id":5,"pol":"cytryna","cat":"llimona"},
    {"id":6,"pol":"winogrono","cat":"ra√Øm"},
    {"id":7,"pol":"truskawka","cat":"maduixa"},
    {"id":8,"pol":"wi≈õnia","cat":"cirera"},
    {"id":9,"pol":"malina","cat":"gerd"},
    {"id":10,"pol":"arbuz","cat":"s√≠ndria"},
    {"id":11,"pol":"ananas","cat":"pinya"},
    {"id":12,"pol":"brzoskwinia","cat":"pr√©ssec"}
  ],
  numeros: [
    {"id":1,"pol":"jeden","cat":"1"},
    {"id":2,"pol":"dwa","cat":"2"},
    {"id":3,"pol":"trzy","cat":"3"},
    {"id":4,"pol":"cztery","cat":"4"},
    {"id":5,"pol":"piƒôƒá","cat":"5"},
    {"id":6,"pol":"sze≈õƒá","cat":"6"},
    {"id":7,"pol":"siedem","cat":"7"},
    {"id":8,"pol":"osiem","cat":"8"},
    {"id":9,"pol":"dziewiƒôƒá","cat":"9"},
    {"id":10,"pol":"dziesiƒôƒá","cat":"10"}
  ],
  basiques: [
    {"id":1,"pol":"tak","cat":"s√≠"},
    {"id":2,"pol":"nie","cat":"no"},
    {"id":3,"pol":"dziƒôkujƒô","cat":"gr√†cies"},
    {"id":4,"pol":"proszƒô","cat":"si us plau"},
    {"id":5,"pol":"przepraszam","cat":"perd√≥"},
    {"id":6,"pol":"gdzie","cat":"on"},
    {"id":7,"pol":"kiedy","cat":"quan"},
    {"id":8,"pol":"dzisiaj","cat":"avui"},
    {"id":9,"pol":"jutro","cat":"dem√†"},
    {"id":10,"pol":"wczoraj","cat":"ahir"}
  ]
};

let frasesActuals = TEMES.colors;
let encerts = 0;
let selectedPol = null;
let currentAttempts = {};

function canviaTema() {
  frasesActuals = TEMES[document.getElementById("tema").value];
  novaRonda();
}

function barreja(array) {
  return array.slice().sort(() => Math.random() - 0.5);
}

function speakPolish(text) {
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = "pl-PL";
  speechSynthesis.cancel();
  speechSynthesis.speak(utterance);
}

function actualitzaPuntuacio() {
  document.getElementById("score").textContent = `Encerts: ${encerts} / ${TOTAL_PER_RONDA}`;
}

function novaRonda() {
  const grogues = [];
  document.querySelectorAll(".fixed-pol").forEach(el => {
    grogues.push(parseInt(el.dataset.id));
  });

  const restants = frasesActuals.filter(f => !grogues.includes(f.id));
  const seleccionades = [];

  grogues.forEach(id => {
    const paraula = frasesActuals.find(f => f.id === id);
    if (paraula) seleccionades.push(paraula);
  });

  const addicionals = barreja(restants).slice(0, TOTAL_PER_RONDA - seleccionades.length);
  seleccionades.push(...addicionals);

  currentAttempts = {};
  generaExercici(seleccionades);
  dibuixaLinies();
}

function netejaErrors() {
  document.querySelectorAll(".incorrect-pol, .incorrect-cat").forEach(el => {
    el.classList.remove("incorrect-pol", "incorrect-cat");
  });
}

function mouAlTop(element) {
  const parent = element.parentNode;
  parent.insertBefore(element, parent.firstChild);
}

function dibuixaLinies() {
  const svg = document.querySelector(".match-lines");
  svg.innerHTML = "";
  const polContainer = document.getElementById("polones");
  const catContainer = document.getElementById("catala");

  const matchedPol = polContainer.querySelectorAll(".matched, .fixed-pol");
  matchedPol.forEach(pol => {
    const polId = pol.dataset.id;
    const cat = catContainer.querySelector(`.matched[data-id="${polId}"], .fixed-cat[data-id="${polId}"]`);
    if (cat) {
      const polRect = pol.getBoundingClientRect();
      const catRect = cat.getBoundingClientRect();
      const containerRect = svg.getBoundingClientRect();

      const x1 = polRect.right - containerRect.left;
      const y1 = polRect.top + polRect.height / 2 - containerRect.top;
      const x2 = catRect.left - containerRect.left;
      const y2 = catRect.top + catRect.height / 2 - containerRect.top;

      const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
      line.setAttribute("x1", x1);
      line.setAttribute("y1", y1);
      line.setAttribute("x2", x2);
      line.setAttribute("y2", y2);
      line.setAttribute("stroke", "#666");
      line.setAttribute("stroke-width", "2");
      svg.appendChild(line);
    }
  });
}

function generaExercici(frases) {
  const polContainer = document.getElementById("polones");
  const catContainer = document.getElementById("catala");
  polContainer.innerHTML = "";
  catContainer.innerHTML = "";
  encerts = 0;
  selectedPol = null;
  actualitzaPuntuacio();

  const polFrases = barreja(frases);
  const catFrases = barreja(frases);

  polFrases.forEach(f => {
    const div = document.createElement("div");
    div.className = "item";
    div.dataset.id = f.id;
    div.textContent = f.pol;

    div.addEventListener("click", () => {
      speakPolish(f.pol); // ‚úÖ Sempre pronuncia
      if (div.classList.contains("matched") || div.classList.contains("fixed-pol")) return;
      netejaErrors();
      document.querySelectorAll("#polones .item").forEach(el => el.classList.remove("selected"));
      div.classList.add("selected");
      selectedPol = div;
    });

    polContainer.appendChild(div);
  });

  catFrases.forEach(f => {
    const div = document.createElement("div");
    div.className = "item";
    div.dataset.id = f.id;
    div.textContent = f.cat;

    div.addEventListener("click", () => {
      if (!selectedPol) return;
      if (div.classList.contains("matched") || div.classList.contains("fixed-cat")) return;

      const polId = selectedPol.dataset.id;
      const catId = div.dataset.id;

      if (polId === catId) {
        if (currentAttempts[polId] && currentAttempts[polId].attempts > 0) {
          selectedPol.classList.add("fixed-pol");
          div.classList.add("fixed-cat");
        } else {
          selectedPol.classList.add("matched");
          div.classList.add("matched");
          encerts++;
          actualitzaPuntuacio();
        }
        mouAlTop(selectedPol);
        mouAlTop(div);
        dibuixaLinies();
      } else {
        selectedPol.classList.add("incorrect-pol");
        div.classList.add("incorrect-cat");
        if (!currentAttempts[polId]) currentAttempts[polId] = { attempts: 0 };
        currentAttempts[polId].attempts++;
      }

      selectedPol.classList.remove("selected");
      selectedPol = null;
    });

    catContainer.appendChild(div);
  });
}

window.addEventListener("resize", dibuixaLinies);
window.onload = () => canviaTema();
</script>
</body>
</html>
