<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Text i Processador de Paraules Catalanes</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            min-height: 400px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .panel {
            border: 1px solid #eaeaea;
            border-radius: 5px;
            padding: 20px;
            background-color: #f9f9f9;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeaea;
        }
        
        .panel-title {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .editor-container {
            height: 400px;
            position: relative;
        }
        
        #textEditor {
            width: 100%;
            height: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
        }
        
        .word-count {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .transform-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        button:hover:not(:disabled) {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .secondary-btn {
            background-color: #2ecc71;
        }
        
        .secondary-btn:hover {
            background-color: #27ae60;
        }
        
        .danger-btn {
            background-color: #e74c3c;
        }
        
        .danger-btn:hover {
            background-color: #c0392b;
        }
        
        .file-input-section {
            background-color: #e8f4fd;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .file-input-section h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .file-input-button {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        
        .file-input-button:hover {
            background-color: #27ae60;
        }
        
        .search-section {
            margin-top: 20px;
        }
        
        .search-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .multi-select-group {
            width: 100%;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-item input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }
        
        .search-options {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 4px solid #3498db;
        }
        
        .search-options-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .search-options-title::before {
            content: "‚öôÔ∏è";
        }
        
        .advanced-search {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            border-left: 4px solid #f39c12;
        }
        
        .advanced-search-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .advanced-search-title::before {
            content: "üîç";
        }
        
        .search-terms-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        
        .search-term-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .search-term-group select {
            flex: 0 0 140px;
        }
        
        .search-term-group input {
            flex: 1;
        }
        
        .search-term-group button {
            flex: 0 0 auto;
            background-color: #e74c3c;
            padding: 8px 12px;
        }
        
        .add-term-btn {
            background-color: #2ecc71 !important;
            width: 100%;
            margin-top: 10px;
        }
        
        .logic-operator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 8px;
            background-color: #e8f4fd;
            border-radius: 5px;
        }
        
        .logic-operator label {
            margin-bottom: 0;
            font-weight: 600;
        }
        
        .logic-operator select {
            width: auto;
            flex: 0 0 100px;
        }
        
        .results-section {
            margin-top: 20px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .results-count {
            font-weight: 600;
            color: #7f8c8d;
        }
        
        .results-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #eaeaea;
            border-radius: 5px;
            padding: 15px;
            background-color: white;
            min-height: 100px;
        }
        
        .word-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .word-item {
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
            font-family: 'Courier New', monospace;
            word-break: break-word;
            text-align: center;
            position: relative;
        }
        
        .word-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .accent-type {
            position: absolute;
            top: 2px;
            right: 5px;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .agut {
            background-color: #e8f6f3;
            color: #148f77;
        }
        
        .pla {
            background-color: #e8f4fd;
            color: #2980b9;
        }
        
        .esdruixol {
            background-color: #fdf2e9;
            color: #e67e22;
        }
        
        .monosillab {
            background-color: #f4ecf7;
            color: #8e44ad;
        }
        
        .no-results {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .status-info {
            background-color: #e8f4fd;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .encoding-info {
            background-color: #fff3cd;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            color: #856404;
            font-size: 14px;
        }
        
        .success {
            text-align: center;
            padding: 15px;
            color: #27ae60;
            background-color: #d5f4e6;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .stats-info {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .auto-process-info {
            background-color: #e8f6f3;
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 10px;
            color: #148f77;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .auto-process-info::before {
            content: "‚úì";
            font-weight: bold;
        }
        
        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .filter-tag {
            background-color: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .filter-tag::before {
            content: "üîç";
        }
        
        .filter-tag .remove-filter {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-weight: bold;
            padding: 0;
            margin-left: 5px;
        }
        
        .search-explanation {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
            font-style: italic;
        }
        
        .real-time-update {
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .multiple-values-info {
            background-color: #e8f6f3;
            padding: 8px 12px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 12px;
            color: #148f77;
        }
        
        .multiple-values-info strong {
            display: block;
            margin-bottom: 5px;
        }
        
        .accent-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .word-details {
            font-size: 10px;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Processador de Paraules Catalanes</h1>
            <p class="subtitle">Analitza l'accentuaci√≥ de paraules segons les normes IEC</p>
        </header>
        
        <div class="encoding-info" id="encodingInfo" style="display: none;">
            <strong>Nota:</strong> S'ha detectat i corregit autom√†ticament un problema d'encoding.
        </div>
        
        <div class="success" id="successInfo" style="display: none;">
            <strong>‚úì Correcte:</strong> Encoding UTF-8 detectat correctament.
        </div>
        
        <section class="file-input-section" id="fileInputSection">
            <h3>Carrega el fitxer de text</h3>
            <p>Selecciona un fitxer TXT per analitzar l'accentuaci√≥ de les seves paraules</p>
            <input type="file" id="fileInput" accept=".txt" style="display: none;">
            <button class="file-input-button" onclick="document.getElementById('fileInput').click()">
                Seleccionar fitxer TXT
            </button>
            <p><small>El sistema analitzar√† autom√†ticament l'accentuaci√≥ de cada paraula</small></p>
        </section>
        
        <div class="main-content">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">Editor de Text</h2>
                    <div class="stats-info">
                        <span id="charCount">0 car√†cters</span>
                        <span id="lineCount">0 l√≠nies</span>
                    </div>
                </div>
                
                <div class="editor-container">
                    <textarea id="textEditor" placeholder="Escriu o enganxa text en catal√† per analitzar l'accentuaci√≥..."></textarea>
                    <div class="word-count" id="wordCount">0 paraules</div>
                </div>
                
                <div class="transform-buttons">
                    <button id="replaceNewlines" class="secondary-btn">Canviar \n per salts de l√≠nia</button>
                    <button id="replaceTabs" class="secondary-btn">Canviar \t per tabulacions</button>
                    <button id="toUpperCase" class="secondary-btn">Text a maj√∫scules</button>
                    <button id="toLowerCase" class="secondary-btn">Text a min√∫scules</button>
                    <button id="clearText" class="danger-btn">Netejar text</button>
                </div>
            </div>
            
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">Analitzador d'Accentuaci√≥</h2>
                    <div class="stats-info">
                        <span id="uniqueWordsCount">0 paraules √∫niques</span>
                    </div>
                </div>
                
                <div class="auto-process-info">
                    Algorisme IEC - Separaci√≥ sil¬∑l√†bica i accentuaci√≥ autom√†tica
                </div>
                
                <div class="search-section">
                    <div class="advanced-search">
                        <div class="advanced-search-title">Cerca per tipus d'accentuaci√≥</div>
                        <p class="search-explanation">Filtra les paraules segons el seu tipus d'accentuaci√≥ o altres criteris</p>
                        
                        <div class="multiple-values-info">
                            <strong>üí° Tipus d'accentuaci√≥:</strong>
                            <ul style="margin: 5px 0 0 15px;">
                                <li><strong>Agut</strong>: accent a l'√∫ltima s√≠l¬∑laba (ex: caf√®, menj√†)</li>
                                <li><strong>Pla</strong>: accent a la pen√∫ltima s√≠l¬∑laba (ex: taula, casa)</li>
                                <li><strong>Esdr√∫ixol</strong>: accent a l'antepen√∫ltima s√≠l¬∑laba (ex: s√≠l¬∑laba, c√†ntir)</li>
                                <li><strong>Monos√≠l¬∑lab</strong>: paraules d'una sola s√≠l¬∑laba</li>
                            </ul>
                        </div>
                        
                        <div class="logic-operator">
                            <label>Operador l√≤gic entre condicions:</label>
                            <select id="logicOperator">
                                <option value="AND">I (AND) - Totes les condicions</option>
                                <option value="OR">O (OR) - Qualsevol condici√≥</option>
                            </select>
                        </div>
                        
                        <div class="search-terms-container" id="searchTermsContainer">
                            <div class="search-term-group">
                                <select class="search-type">
                                    <option value="contains">Cont√©</option>
                                    <option value="startsWith">Comen√ßa amb</option>
                                    <option value="endsWith">Acaba amb</option>
                                    <option value="exact">√âs exactament</option>
                                    <option value="accentType" selected>Tipus d'accentuaci√≥</option>
                                </select>
                                <input type="text" class="search-term-input" placeholder="agut, pla, esdruixol, monosillab">
                                <button class="remove-term-btn">√ó</button>
                            </div>
                        </div>
                        
                        <button class="add-term-btn secondary-btn" id="addTermBtn">+ Afegir una altra condici√≥</button>
                    </div>
                    
                    <div class="active-filters" id="activeFilters" style="display: none;">
                        <!-- Els filtres actius es mostraran aqu√≠ -->
                    </div>
                    
                    <button id="searchButton" style="margin-top: 15px; width: 100%;">Cercar amb les condicions</button>
                </div>
                
                <div class="results-section">
                    <div class="results-header">
                        <h3>Resultats de l'An√†lisi</h3>
                        <div class="results-count" id="resultsCount">-</div>
                    </div>
                    
                    <div class="accent-stats" id="accentStats" style="display: none;">
                        <span id="agutCount">0 aguts</span>
                        <span id="plaCount">0 plans</span>
                        <span id="esdruixolCount">0 esdr√∫ixols</span>
                        <span id="monosillabCount">0 monos√≠l¬∑labs</span>
                    </div>
                    
                    <div class="results-container">
                        <div id="initialMessage" class="no-results">
                            Escriu o carrega text en catal√† per analitzar l'accentuaci√≥
                        </div>
                        <div class="word-list" id="wordList" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ALGORITME COMPLET D'ACCENTUACI√ì CATALANA - VERSI√ì IEC
        class AccentuacioCatalana {
            
            // Llistes de paraules espec√≠fiques
            static DIFTONGS_DECREIXENTS = [
                'esglai', 'servei', 'Alcoi', 'biscuit', 'holocaust', 'guineu', 
                'arxiu', 'dinou', 'enduu', 'bungalou', 'commou', 'vei', 'trei', 'crei'
            ];
            
            static EXCEPCIONS_U = [
                'g√∫a', 'ag√∫o', 'ag√∫es', 'ag√∫a', 'ag√∫en', 'ag√∫is',
                'ag√ºo', 'ag√ºes', 'ag√ºa', 'ag√ºen', 'ag√ºis', 'ing√∫ix', 'ing√∫ixia'
            ];

            static HIATS_ESPECIALS = ['a√º', 'e√º', 'o√º', 'a√Ø', 'e√Ø', 'o√Ø'];
            
            static TERMINACIONS_LATINES = ['um', 'us'];

            /**
             * Analitza una paraula completa
             */
            static analitzarParaula(paraula) {
                if (!paraula || paraula.trim() === '') {
                    return { error: 'Paraula buida' };
                }

                const neta = paraula.toLowerCase().replace(/[^a-z√†√®√©√≠√Ø√≤√≥√∫√º√ß√±\-]/g, '');
                const silabes = this.separarSilabes(neta);
                const tipus = this.determinarTipusAccentuacio(neta);
                
                return {
                    paraula: paraula,
                    neta: neta,
                    silabes: silabes,
                    tipusAccentuacio: tipus,
                    esSimple: true
                };
            }

            /**
             * SIL¬∑LABIFICACI√ì PRINCIPAL - VERSI√ì IEC CORREGIDA
             */
            static separarSilabes(paraula) {
                const silabes = [];
                let index = 0;
                
                while (index < paraula.length) {
                    const silaba = this.obtenirSilaba(paraula, index);
                    silabes.push(silaba);
                    index += silaba.length;
                }
                
                return silabes;
            }

            static obtenirSilaba(paraula, inici) {
                const resta = paraula.substring(inici);
                
                // REGLA a) - i/u febles entre dues vocals ‚Üí semivocals
                if (this.esSemivocalEntreVocals(paraula, inici)) {
                    return resta.substring(0, 2);
                }
                
                // Casos especials de i/u (altres situacions)
                if (this.esVocalSeparada(paraula, inici)) {
                    return paraula[inici];
                }
                
                // Diftongs i triftongs (no es separen) - amb verificaci√≥ de hiats
                const diftong = this.obtenirDiftong(resta);
                if (diftong) return diftong;
                
                // D√≠grafs que no es separen
                const digraf = this.obtenirDigraf(resta);
                if (digraf) return digraf;
                
                // Grups conson√†ntics complexes
                const grupConsonantic = this.obtenirGrupConsonantic(resta);
                if (grupConsonantic) return grupConsonantic;
                
                // Consonant + vocal
                if (/^[^aeiou√†√®√©√≠√Ø√≤√≥√∫√º][aeiou√†√®√©√≠√Ø√≤√≥√∫√º]/.test(resta)) {
                    return resta.substring(0, 2);
                }
                
                // Vocal sola
                if (/^[aeiou√†√®√©√≠√Ø√≤√≥√∫√º]/.test(resta)) {
                    return resta[0];
                }
                
                // Consonant sola
                return resta[0];
            }

            /**
             * REGLA a) - i/u febles entre dues vocals ‚Üí semivocals
             */
            static esSemivocalEntreVocals(paraula, posicio) {
                const lletra = paraula[posicio];
                if (!'iu'.includes(lletra)) return false;
                
                const anterior = posicio > 0 ? paraula[posicio - 1] : null;
                const seguent = posicio < paraula.length - 1 ? paraula[posicio + 1] : null;
                
                // REGLA a): i/u entre dues vocals ‚Üí semivocal amb la seg√ºent
                if (anterior && 'aeiou√†√®√©√≠√Ø√≤√≥√∫√º'.includes(anterior) &&
                    seguent && 'aeiou√†√®√©√≠√Ø√≤√≥√∫√º'.includes(seguent)) {
                    return true;
                }
                
                return false;
            }

            /**
             * REGLA b) - i/u febles entre consonant i vocal
             */
            static esVocalSeparada(paraula, posicio) {
                const lletra = paraula[posicio];
                if (!'iu'.includes(lletra)) return false;
                
                const anterior = posicio > 0 ? paraula[posicio - 1] : null;
                const seguent = posicio < paraula.length - 1 ? paraula[posicio + 1] : null;
                
                // REGLA b): i/u entre consonant i vocal ‚Üí ES SEPARA (esdr√∫ixols)
                if (anterior && !'aeiou√†√®√©√≠√Ø√≤√≥√∫√º'.includes(anterior) && 
                    seguent && 'aeiou√†√®√©√≠√Ø√≤√≥√∫√º'.includes(seguent)) {
                    
                    // EXCEPCI√ì: u despr√©s de g/q ‚Üí NO es separa (diftong)
                    if (lletra === 'u' && 'gq'.includes(anterior.toLowerCase())) {
                        return false;
                    }
                    
                    // EXCEPCI√ì: u despr√©s de c ‚Üí S√ç es separa (esdr√∫ixol)
                    if (lletra === 'u' && anterior.toLowerCase() === 'c') {
                        return true;
                    }
                    
                    return true;
                }
                
                return false;
            }

            /**
             * DIFTONGS I HIATS
             */
            static obtenirDiftong(resta) {
                // TRIFTONGS
                if (/^[aeiou√†√®√©√≠√Ø√≤√≥√∫√º][iu][aeiou√†√®√©√≠√Ø√≤√≥√∫√º]/.test(resta)) {
                    const match = resta.match(/^[aeiou√†√®√©√≠√Ø√≤√≥√∫√º][iu][aeiou√†√®√©√≠√Ø√≤√≥√∫√º]/)[0];
                    if (!this.esHiat(match)) {
                        return match;
                    }
                }
                
                // DIFTONGS CREIXENTS - i/u + vocal forta
                if (/^[iu][aeiou√†√®√©√≠√Ø√≤√≥√∫√º]/.test(resta)) {
                    const match = resta.match(/^[iu][aeiou√†√®√©√≠√Ø√≤√≥√∫√º]/)[0];
                    if (!this.esHiat(match)) {
                        return match;
                    }
                }
                
                // DIFTONGS DECREIXENTS - vocal forta + i/u (REGLA c)
                if (/^[aeiou√†√®√©√≠√Ø√≤√≥√∫√º][iu]/.test(resta)) {
                    const match = resta.match(/^[aeiou√†√®√©√≠√Ø√≤√≥√∫√º][iu]/)[0];
                    if (!this.esHiat(match) && !this.esExcepcioDiftongDecreixent(resta)) {
                        return match;
                    }
                }
                
                return null;
            }

            /**
             * REGLA c) - Excepcions de diftongs decreixents
             */
            static esExcepcioDiftongDecreixent(resta) {
                // Present de subjuntiu: -i, -is, -in
                if (/^(i|is|in)$/.test(resta)) {
                    return true;
                }
                
                // Terminacions llatines -um, -us
                if (this.TERMINACIONS_LATINES.some(terminacio => resta.endsWith(terminacio))) {
                    return true;
                }
                
                return false;
            }

            /**
             * DETECTAR HIATS
             */
            static esHiat(grupVocals) {
                const paraula = grupVocals.toLowerCase();
                
                // Casos especials amb di√®resi (es separen)
                if (this.HIATS_ESPECIALS.includes(paraula)) {
                    return true;
                }
                
                // Vocal t√≤nica seguida de vocal √†tona ‚Üí hiat
                if (/[√†√®√©√≠√Ø√≤√≥√∫√º][aeiou]/.test(paraula)) {
                    return true;
                }
                
                // Vocal √†tona seguida de vocal t√≤nica ‚Üí hiat  
                if (/[aeiou][√†√®√©√≠√Ø√≤√≥√∫√º]/.test(paraula)) {
                    return true;
                }
                
                // Dos vocals fortes (a, e, o) ‚Üí hiat
                if (/[aeo][aeo]/.test(paraula)) {
                    return true;
                }
                
                return false;
            }

            /**
             * DETERMINACI√ì DEL TIPUS D'ACCENTUACI√ì
             */
            static determinarTipusAccentuacio(paraula) {
                const silabes = this.separarSilabes(paraula.toLowerCase());
                
                if (silabes.length <= 1) return 'monosillab';
                
                // Buscar s√≠l¬∑laba t√≤nica per accent gr√†fic
                for (let i = 0; i < silabes.length; i++) {
                    if (/[√†√®√©√≠√Ø√≤√≥√∫√º]/.test(silabes[i])) {
                        if (i === silabes.length - 1) return 'agut';
                        if (i === silabes.length - 2) return 'pla';
                        return 'esdruixol';
                    }
                }
                
                // Sense accent gr√†fic - aplicar regles generals
                const ultima = silabes[silabes.length - 1];
                
                // Aguts: acaben en vocal, vocal+s, -en, -in (excepte diftongs decreixents)
                if (this.esTerminacioAguda(ultima) && !this.esDiftongDecreixent(paraula)) {
                    return 'agut';
                }
                
                // Per defecte: pla
                return 'pla';
            }

            /**
             * FUNCIONS AUXILIARS
             */
            static obtenirDigraf(resta) {
                const digrafs = [/^gu[aeiou]/, /^qu[aeiou]/, /^ll/, /^ny/, /^ix/, /^rr/, /^ss/];
                for (const digraf of digrafs) {
                    const match = resta.match(digraf);
                    if (match) return match[0];
                }
                return null;
            }

            static obtenirGrupConsonantic(resta) {
                const grups = ['bl', 'br', 'cl', 'cr', 'dr', 'fl', 'fr', 'gl', 'gr', 'pl', 'pr', 'tr'];
                for (const grup of grups) {
                    if (resta.startsWith(grup)) {
                        return grup;
                    }
                }
                return null;
            }

            static esTerminacioAguda(silaba) {
                return /^[aeiou]s?$|en$|in$/.test(silaba);
            }

            static esDiftongDecreixent(paraula) {
                return this.DIFTONGS_DECREIXENTS.some(diftong => 
                    paraula.toLowerCase().endsWith(diftong)
                );
            }
        }

        // Variables globals
        let words = [];
        let textContent = "";
        let searchTimeout = null;

        // Elements del DOM
        const textEditor = document.getElementById('textEditor');
        const fileInput = document.getElementById('fileInput');
        const fileInputSection = document.getElementById('fileInputSection');
        const wordCount = document.getElementById('wordCount');
        const charCount = document.getElementById('charCount');
        const lineCount = document.getElementById('lineCount');
        const uniqueWordsCount = document.getElementById('uniqueWordsCount');
        const replaceNewlines = document.getElementById('replaceNewlines');
        const replaceTabs = document.getElementById('replaceTabs');
        const toUpperCase = document.getElementById('toUpperCase');
        const toLowerCase = document.getElementById('toLowerCase');
        const clearText = document.getElementById('clearText');
        const searchButton = document.getElementById('searchButton');
        const resultsCount = document.getElementById('resultsCount');
        const wordList = document.getElementById('wordList');
        const initialMessage = document.getElementById('initialMessage');
        const encodingInfo = document.getElementById('encodingInfo');
        const successInfo = document.getElementById('successInfo');
        const activeFilters = document.getElementById('activeFilters');
        const searchTermsContainer = document.getElementById('searchTermsContainer');
        const addTermBtn = document.getElementById('addTermBtn');
        const logicOperator = document.getElementById('logicOperator');
        const accentStats = document.getElementById('accentStats');
        const agutCount = document.getElementById('agutCount');
        const plaCount = document.getElementById('plaCount');
        const esdruixolCount = document.getElementById('esdruixolCount');
        const monosillabCount = document.getElementById('monosillabCount');

        // Funci√≥ per processar m√∫ltiples valors d'una condici√≥
        function processMultipleValues(input) {
            return input
                .split(',')
                .map(term => term.trim().toLowerCase())
                .filter(term => term.length > 0);
        }

        // Funci√≥ per actualitzar els comptadors
        function updateCounters() {
            const text = textEditor.value;
            const chars = text.length;
            const lines = text.split('\n').length;
            const wordCountValue = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            
            charCount.textContent = `${chars} car√†cters`;
            lineCount.textContent = `${lines} l√≠nies`;
            wordCount.textContent = `${wordCountValue} paraules`;
            
            // Processar paraules autom√†ticament
            processTextWords();
        }

        // Funci√≥ per processar les paraules del text
        function processTextWords() {
            const text = textEditor.value;
            
            if (text.trim() === '') {
                words = [];
                uniqueWordsCount.textContent = "0 paraules √∫niques";
                showResults([], "No hi ha text per processar");
                return;
            }
            
            // Netejar i separar paraules
            const rawWords = text
                .replace(/[^\w\s√†√®√©√≠√Ø√≤√≥√∫√º√ß√±\-]/gi, ' ')
                .split(/\s+/)
                .filter(word => word.length > 0)
                .map(word => word.toLowerCase().trim());
            
            // Analitzar cada paraula amb l'algorisme IEC
            words = rawWords.map(word => {
                const analisi = AccentuacioCatalana.analitzarParaula(word);
                return {
                    paraula: word,
                    tipus: analisi.tipusAccentuacio,
                    silabes: analisi.silabes
                };
            });
            
            // Eliminar duplicats
            const uniqueMap = new Map();
            words.forEach(item => {
                if (!uniqueMap.has(item.paraula)) {
                    uniqueMap.set(item.paraula, item);
                }
            });
            words = Array.from(uniqueMap.values());
            
            // Ordenar alfab√®ticament
            words.sort((a, b) => a.paraula.localeCompare(b.paraula));
            
            uniqueWordsCount.textContent = `${words.length} paraules √∫niques`;
            console.log(`Paraules processades: ${words.length}`);
            
            // Realitzar cerca autom√†tica
            performSearch();
        }

        // Funci√≥ per afegir un nou terme de cerca
        function addSearchTerm() {
            const termGroup = document.createElement('div');
            termGroup.className = 'search-term-group';
            
            termGroup.innerHTML = `
                <select class="search-type">
                    <option value="contains">Cont√©</option>
                    <option value="startsWith">Comen√ßa amb</option>
                    <option value="endsWith">Acaba amb</option>
                    <option value="exact">√âs exactament</option>
                    <option value="accentType">Tipus d'accentuaci√≥</option>
                </select>
                <input type="text" class="search-term-input" placeholder="Ex: ci√≥, enc, ent (m√∫ltiples valors separats per comes)">
                <button class="remove-term-btn">√ó</button>
            `;
            
            searchTermsContainer.appendChild(termGroup);
            
            // Configurar esdeveniments per al nou terme
            setupSearchTermEvents(termGroup);
            
            updateActiveFilters();
        }

        // Configurar esdeveniments per a un terme de cerca
        function setupSearchTermEvents(termGroup) {
            // Esdeveniment per eliminar el terme
            termGroup.querySelector('.remove-term-btn').addEventListener('click', function() {
                if (searchTermsContainer.children.length > 1) {
                    termGroup.remove();
                    updateActiveFilters();
                    performSearch();
                }
            });
            
            // Esdeveniments per a actualitzacions en temps real
            const searchInput = termGroup.querySelector('.search-term-input');
            const searchType = termGroup.querySelector('.search-type');
            
            searchInput.addEventListener('input', function() {
                updateActiveFilters();
                performRealTimeSearch();
            });
            
            searchType.addEventListener('change', function() {
                updateActiveFilters();
                performSearch();
            });
        }

        // Funci√≥ per obtenir tots els termes de cerca
        function getSearchTerms() {
            const terms = [];
            const termGroups = searchTermsContainer.querySelectorAll('.search-term-group');
            
            termGroups.forEach(group => {
                const type = group.querySelector('.search-type').value;
                const input = group.querySelector('.search-term-input').value.trim();
                
                if (input) {
                    const values = processMultipleValues(input);
                    if (values.length > 0) {
                        terms.push({ type, values });
                    }
                }
            });
            
            return terms;
        }

        // Funci√≥ per actualitzar els filtres actius
        function updateActiveFilters() {
            const filtersContainer = document.getElementById('activeFilters');
            const searchTerms = getSearchTerms();
            
            filtersContainer.innerHTML = '';
            
            if (searchTerms.length === 0) {
                filtersContainer.style.display = 'none';
                return;
            }
            
            filtersContainer.style.display = 'flex';
            
            searchTerms.forEach((term, index) => {
                const filterTag = document.createElement('div');
                filterTag.className = 'filter-tag real-time-update';
                
                let label = '';
                switch(term.type) {
                    case 'startsWith': label = 'Comen√ßa amb'; break;
                    case 'endsWith': label = 'Acaba amb'; break;
                    case 'contains': label = 'Cont√©'; break;
                    case 'exact': label = '√âs'; break;
                    case 'accentType': label = 'Tipus accent'; break;
                }
                
                const valuesDisplay = term.values.join(' o ');
                filterTag.innerHTML = `
                    ${label} ${term.values.length > 1 ? `(${term.values.length} valors)` : ''}: ${valuesDisplay}
                    <button class="remove-filter" data-index="${index}">√ó</button>
                `;
                
                filtersContainer.appendChild(filterTag);
                
                // Eliminar l'animaci√≥ despr√©s de completar-se
                setTimeout(() => {
                    filterTag.classList.remove('real-time-update');
                }, 500);
            });
            
            // Afegir esdeveniments als botons d'eliminar
            document.querySelectorAll('.remove-filter').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const termGroups = searchTermsContainer.querySelectorAll('.search-term-group');
                    
                    if (termGroups.length > 1) {
                        termGroups[index].remove();
                        updateActiveFilters();
                        performSearch();
                    } else {
                        // Si nom√©s queda un grup, netejar-lo en lloc d'eliminar-lo
                        termGroups[0].querySelector('.search-term-input').value = '';
                        updateActiveFilters();
                        performSearch();
                    }
                });
            });
        }

        // Funci√≥ per llegir el fitxer
        function readFileWithEncoding(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const arrayBuffer = e.target.result;
                    const uint8Array = new Uint8Array(arrayBuffer);
                    
                    // Provar diferents encodings
                    const encodings = ['utf-8', 'windows-1252', 'iso-8859-1', 'latin1'];
                    
                    for (let encoding of encodings) {
                        try {
                            const decoder = new TextDecoder(encoding);
                            const text = decoder.decode(uint8Array);
                            
                            // Comprovar si el text sembla correcte
                            if (!text.includes('ÔøΩ') && !text.includes('√Ø¬ø¬Ω')) {
                                console.log(`Encoding correcte detectat: ${encoding}`);
                                resolve(text);
                                return;
                            }
                        } catch (e) {
                            // Continuar amb el seg√ºent encoding
                        }
                    }
                    
                    // Si cap encoding funciona, tornar el text amb UTF-8
                    const decoder = new TextDecoder('utf-8');
                    const text = decoder.decode(uint8Array);
                    resolve(text);
                };
                
                reader.onerror = function() {
                    reject(new Error('Error llegint el fitxer'));
                };
                
                reader.readAsArrayBuffer(file);
            });
        }

        // Funci√≥ per detectar i corregir encoding
        function autoDetectAndFixEncoding(text) {
            // Comprovar si hi ha el patr√≥ "√Ø¬ø¬Ω" que indica doble encoding
            if (text.includes('√Ø¬ø¬Ω') || text.includes('√É')) {
                console.log('S\'ha detectat problema d\'encoding, aplicant correcci√≥...');
                encodingInfo.style.display = 'block';
                encodingInfo.innerHTML = `<strong>Problema d'encoding detectat:</strong> S'est√† aplicant correcci√≥ per a car√†cters especials`;
                successInfo.style.display = 'none';
                
                // Correccions b√†siques
                return text
                    .replace(/√Ø¬ø¬Ω/g, '√†')
                    .replace(/√É /g, '√Ä')
                    .replace(/√É¬°/g, '√°')
                    .replace(/√É¬©/g, '√©')
                    .replace(/√É¬®/g, '√®')
                    .replace(/√É¬≠/g, '√≠')
                    .replace(/√É¬≥/g, '√≥')
                    .replace(/√É¬≤/g, '√≤')
                    .replace(/√É¬∫/g, '√∫')
                    .replace(/√É¬º/g, '√º')
                    .replace(/√É¬ß/g, '√ß')
                    .replace(/√É¬±/g, '√±');
            }
            
            // Si arribem aqu√≠, el text sembla correcte
            console.log('Encoding UTF-8 detectat correctament');
            successInfo.style.display = 'block';
            encodingInfo.style.display = 'none';
            return text;
        }

        // Funci√≥ per realitzar la cerca amb m√∫ltiples condicions i m√∫ltiples valors
        function performSearch() {
            if (words.length === 0) {
                showResults([], "No hi ha paraules per cercar");
                return;
            }
            
            const searchTerms = getSearchTerms();
            const operator = logicOperator.value;
            
            // Si no hi ha termes de cerca, mostrar totes les paraules
            if (searchTerms.length === 0) {
                showResults(words, "Totes les paraules");
                return;
            }
            
            let results = [];
            
            if (operator === 'AND') {
                // AND l√≤gic: les paraules han de complir TOTES les condicions
                results = words.filter(wordObj => {
                    return searchTerms.every(searchTerm => {
                        // Dins d'una condici√≥, es compleix si alguna de les opcions √©s certa (OR)
                        return searchTerm.values.some(value => {
                            switch(searchTerm.type) {
                                case 'startsWith':
                                    return wordObj.paraula.startsWith(value);
                                case 'endsWith':
                                    return wordObj.paraula.endsWith(value);
                                case 'contains':
                                    return wordObj.paraula.includes(value);
                                case 'exact':
                                    return wordObj.paraula === value;
                                case 'accentType':
                                    return wordObj.tipus === value;
                                default:
                                    return true;
                            }
                        });
                    });
                });
            } else {
                // OR l√≤gic: les paraules han de complir QUALSEVOL de les condicions
                results = words.filter(wordObj => {
                    return searchTerms.some(searchTerm => {
                        // Dins d'una condici√≥, es compleix si alguna de les opcions √©s certa (OR)
                        return searchTerm.values.some(value => {
                            switch(searchTerm.type) {
                                case 'startsWith':
                                    return wordObj.paraula.startsWith(value);
                                case 'endsWith':
                                    return wordObj.paraula.endsWith(value);
                                case 'contains':
                                    return wordObj.paraula.includes(value);
                                case 'exact':
                                    return wordObj.paraula === value;
                                case 'accentType':
                                    return wordObj.tipus === value;
                                default:
                                    return false;
                            }
                        });
                    });
                });
            }
            
            showResults(results);
        }

        // Funci√≥ per realitzar cerca en temps real
        function performRealTimeSearch() {
            if (searchTimeout) {
                clearTimeout(searchTimeout);
            }
            
            searchTimeout = setTimeout(() => {
                performSearch();
            }, 300);
        }

        // Funci√≥ per mostrar els resultats
        function showResults(results, message = null) {
            initialMessage.style.display = 'none';
            wordList.style.display = 'block';
            
            if (message) {
                resultsCount.textContent = message;
                accentStats.style.display = 'none';
                if (results.length === 0) {
                    wordList.innerHTML = `<div class="no-results">${message}</div>`;
                } else {
                    wordList.innerHTML = results.map(wordObj => 
                        `<div class="word-item">
                            ${wordObj.paraula}
                            <span class="accent-type ${wordObj.tipus}">${wordObj.tipus.charAt(0).toUpperCase()}</span>
                            <div class="word-details">${wordObj.silabes.join('-')}</div>
                        </div>`
                    ).join('');
                }
                return;
            }
            
            const searchTerms = getSearchTerms();
            const operator = logicOperator.value;
            
            if (searchTerms.length > 0) {
                resultsCount.textContent = `${results.length} paraules trobades (${operator})`;
            } else {
                resultsCount.textContent = `${results.length} paraules trobades`;
            }
            
            // Actualitzar estad√≠stiques d'accentuaci√≥
            const stats = {
                agut: 0,
                pla: 0,
                esdruixol: 0,
                monosillab: 0
            };
            
            results.forEach(wordObj => {
                stats[wordObj.tipus]++;
            });
            
            agutCount.textContent = `${stats.agut} aguts`;
            plaCount.textContent = `${stats.pla} plans`;
            esdruixolCount.textContent = `${stats.esdruixol} esdr√∫ixols`;
            monosillabCount.textContent = `${stats.monosillab} monos√≠l¬∑labs`;
            accentStats.style.display = 'flex';
            
            if (results.length === 0) {
                wordList.innerHTML = '<div class="no-results">No s\'han trobat resultats</div>';
            } else {
                wordList.innerHTML = results.map(wordObj => 
                    `<div class="word-item">
                        ${wordObj.paraula}
                        <span class="accent-type ${wordObj.tipus}">${wordObj.tipus.charAt(0).toUpperCase()}</span>
                        <div class="word-details">${wordObj.silabes.join('-')}</div>
                    </div>`
                ).join('');
            }
        }

        // Configurar esdeveniments
        function setupEventListeners() {
            // Actualitzar comptadors quan canvia el text (amb retard per rendiment)
            let typingTimer;
            textEditor.addEventListener('input', function() {
                clearTimeout(typingTimer);
                typingTimer = setTimeout(updateCounters, 500);
            });
            
            // Carregar fitxer
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    readFileWithEncoding(file)
                        .then(text => {
                            // Aplicar correcci√≥ d'encoding si cal
                            const correctedText = autoDetectAndFixEncoding(text);
                            
                            // Mostrar el text a l'editor
                            textEditor.value = correctedText;
                            textContent = correctedText;
                            
                            // Actualitzar comptadors
                            updateCounters();
                            
                            // Amagar la secci√≥ de c√†rrega de fitxer
                            fileInputSection.style.display = 'none';
                        })
                        .catch(error => {
                            alert(`Error carregant el fitxer: ${error.message}`);
                        });
                }
            });
            
            // Transformacions de text
            replaceNewlines.addEventListener('click', function() {
                textEditor.value = textEditor.value.replace(/\\n/g, '\n');
                updateCounters();
            });
            
            replaceTabs.addEventListener('click', function() {
                textEditor.value = textEditor.value.replace(/\\t/g, '\t');
                updateCounters();
            });
            
            toUpperCase.addEventListener('click', function() {
                textEditor.value = textEditor.value.toUpperCase();
                updateCounters();
            });
            
            toLowerCase.addEventListener('click', function() {
                textEditor.value = textEditor.value.toLowerCase();
                updateCounters();
            });
            
            clearText.addEventListener('click', function() {
                if (confirm('Est√†s segur que vols netejar tot el text?')) {
                    textEditor.value = '';
                    updateCounters();
                    words = [];
                    showResults([], "El text s'ha netejat");
                }
            });
            
            // Afegir terme de cerca
            addTermBtn.addEventListener('click', addSearchTerm);
            
            // Operador l√≤gic
            logicOperator.addEventListener('change', performSearch);
            
            // Cercar
            searchButton.addEventListener('click', performSearch);
            
            // Configurar esdeveniments per als termes existents inicials
            document.querySelectorAll('.search-term-group').forEach(group => {
                setupSearchTermEvents(group);
            });
        }

        // Inicialitzaci√≥
        function initApp() {
            setupEventListeners();
            updateCounters();
            updateActiveFilters();
        }

        // Iniciar l'aplicaci√≥ quan es carregui la p√†gina
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
