<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cercador</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea {
            width: 100%;
            height: 150px;
        }
        input[type="text"],
        select {
            width: 100%;
            margin-top: 10px;
        }
        button {
            margin-top: 10px;
        }
        .highlight {
            background-color: yellow;
        }
    </style>
</head>
<body>

<h1>Cercador</h1>
<input type="file" id="fileInput" accept=".txt">
<button onclick="clearText()">Netejar</button>
<textarea id="textInput" placeholder="Introdueix el text aquí..."></textarea>
<input type="text" id="searchWord" placeholder="Paraula a cercar">

<label>
    <input type="checkbox" id="exactMatch"> Cercar coincidència exacta
</label>

<label for="precedingCount">Quantes paraules precedeixen:</label>
<select id="precedingCount">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
</select>

<label for="followingCount">Quantes paraules segueixen:</label>
<select id="followingCount">
    <option value="0">0</option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
</select>

<button onclick="searchText()">Cercar</button>


<h2>Resultats:</h2>
<div id="results"></div>

<script>
document.getElementById('fileInput').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('textInput').value = e.target.result;
            };
            reader.readAsText(file);
        }
    });

    function clearText() {
        document.getElementById('textInput').value = '';
        document.getElementById('searchWord').value = '';
        document.getElementById('results').innerHTML = '';
    }

function searchText() {
    const text = document.getElementById('textInput').value;
    const searchWord = document.getElementById('searchWord').value.trim();
    const isExactMatch = document.getElementById('exactMatch').checked;
    const precedingCount = parseInt(document.getElementById('precedingCount').value);
    const followingCount = parseInt(document.getElementById('followingCount').value);
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '';

    const punctuationRegex = /[.,!?;:—()»]/g;

    // Dividir el text en frases i cercar coincidències
    const sentences = text.split(/[.?!]/);
    const matchedSentences = sentences.filter(sentence => 
        isExactMatch 
        ? new RegExp(`\\b${searchWord}\\b`, 'i').test(sentence.replace(punctuationRegex, '')) 
        : sentence.toLowerCase().includes(searchWord.toLowerCase())
    );

    if (matchedSentences.length > 0) {
        resultsDiv.innerHTML += '<h3>Frases que contenen "' + searchWord + '":</h3>';
        matchedSentences.forEach(sentence => {
            const highlightedSentence = sentence.replace(new RegExp(`(\\b${searchWord}\\b)`, 'gi'), '<span class="highlight">$1</span>');
            resultsDiv.innerHTML += '<p>' + highlightedSentence.trim() + '.</p>';
        });
    } else {
        resultsDiv.innerHTML += 'No s\'ha trobat cap frase.';
    }

    // Càlcul de paraules que precedeixen i segueixen
    const words = text.split(/\s+/);
    const followingWords = {};
    const precedingWords = {};
    
    for (let i = 0; i < words.length; i++) {
        const currentWord = isExactMatch 
            ? words[i].replace(punctuationRegex, '') 
            : words[i].toLowerCase().replace(punctuationRegex, '');
        
        if (new RegExp(`^${searchWord}$`, 'i').test(currentWord)) {
            // Paraules que segueixen
            for (let j = 1; j <= followingCount; j++) {
                if (i + j < words.length) {
                    const followingWord = words[i + j].replace(punctuationRegex, '');
                    followingWords[followingWord] = (followingWords[followingWord] || 0) + 1;
                }
            }
            
            // Paraules que precedeixen
            for (let k = 1; k <= precedingCount; k++) {
                if (i - k >= 0) {
                    const precedingWord = words[i - k].replace(punctuationRegex, '');
                    precedingWords[precedingWord] = (precedingWords[precedingWord] || 0) + 1;
                }
            }
        }
    }

    // Mostrar paraules que segueixen
    if (Object.keys(followingWords).length > 0) {
        resultsDiv.innerHTML += '<h3>Paraules que segueixen "' + searchWord + '":</h3>';
        const sortedFollowing = Object.entries(followingWords).sort((a, b) => b[1] - a[1]);
        resultsDiv.innerHTML += '<p>' + sortedFollowing.map(entry => `${entry[0]} (${entry[1]})`).join(', ') + '</p>';
    } else {
        resultsDiv.innerHTML += 'No s\'han trobat paraules que segueixin aquesta paraula.';
    }

    // Mostrar paraules que precedeixen
    if (Object.keys(precedingWords).length > 0) {
        resultsDiv.innerHTML += '<h3>Paraules que precedeixen "' + searchWord + '":</h3>';
        const sortedPreceding = Object.entries(precedingWords).sort((a, b) => b[1] - a[1]);
        resultsDiv.innerHTML += '<p>' + sortedPreceding.map(entry => `${entry[0]} (${entry[1]})`).join(', ') + '</p>';
    } else {
        resultsDiv.innerHTML += 'No s\'han trobat paraules que precedeixin aquesta paraula.';
    }
}
</script>
</body>
</html>
