<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Esdr√∫ixoles i Separaci√≥ de S√≠l¬∑labes</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* =============================
       Disseny modern i accessible
       ============================= */
    :root {
      --bg: #f6f8fb;
      --surface: #ffffff;
      --text: #243447;
      --muted: #5f6b7a;
      --primary: #2563eb; /* blau indigitible */
      --primary-600: #1d4ed8;
      --success: #22c55e;
      --success-600: #16a34a;
      --danger: #ef4444;
      --danger-600: #dc2626;
      --warning: #f59e0b;
      --info: #06b6d4;
      --ring: 0 0 0 3px rgb(37 99 235 / 22%);
      --radius: 14px;
      --shadow-1: 0 10px 30px rgb(2 6 23 / 8%);
      --shadow-2: 0 4px 12px rgb(2 6 23 / 6%);
      --grid-gap: 22px;
    }

  /* N√∫mero gran i gris per a les targetes de l‚Äôaccentuaci√≥ */
  .card-index{
    font-weight: 900;
    color: var(--muted);          /* gris mitj√† del teu tema */
    font-size: clamp(1.2rem, 2.2vw, 1.6rem);
    letter-spacing: .01em;
  }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --surface: #0f172a;
        --text: #e2e8f0;
        --muted: #9aa7b8;
        --primary: #60a5fa;
        --primary-600: #93c5fd;
        --success: #34d399;
        --success-600: #10b981;
        --danger: #f87171;
        --danger-600: #ef4444;
        --warning: #fbbf24;
        --info: #22d3ee;
        --ring: 0 0 0 3px rgb(96 165 250 / 24%);
        --shadow-1: 0 10px 30px rgb(0 0 0 / 30%);
        --shadow-2: 0 4px 12px rgb(0 0 0 / 25%);
      }
    }

    * { box-sizing: border-box; }

    html, body { height: 100%; }

    body {
      margin: 0;
      background:
        radial-gradient(1200px 500px at 10% -10%, rgb(37 99 235 / 7%), transparent 60%),
        radial-gradient(900px 450px at 120% 10%, rgb(34 211 238 / 10%), transparent 60%),
        var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 24px;
      display: grid;
      place-items: start center;
    }

    .container {
      width: min(1100px, 100%);
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow-1);
      padding: clamp(18px, 4vw, 32px);
      border: 1px solid rgb(2 6 23 / 6%);
    }

    header.page-header {
      display: grid;
      gap: 6px;
      margin-bottom: 18px;
    }

    .eyebrow {
      font-size: 0.85rem;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-weight: 700;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.6rem, 2.8vw, 2.2rem);
      letter-spacing: -0.02em;
    }

    .subtle {
      color: var(--muted);
      font-size: 0.98rem;
    }

    /* ======= Tabs accessibles ======= */
    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      align-items: end;
      margin-top: 14px;
      border-bottom: 1px solid rgb(2 6 23 / 8%);
      position: sticky;
      top: 0;
      background: linear-gradient( to bottom, color-mix(in oklab, var(--surface), transparent 0%), color-mix(in oklab, var(--surface), transparent 20%) );
      z-index: 10;
    }

    .tablist {
      display: flex;
      gap: 6px;
    }

    .tab {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      border: 0;
      padding: 10px 14px;
      border-radius: 10px 10px 0 0;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: 0.01em;
      cursor: pointer;
      position: relative;
      transition: color .2s ease;
    }

    .tab[aria-selected="true"] { color: var(--text); }

    .tab[aria-selected="true"]::after {
      content: "";
      position: absolute;
      left: 0; right: 0; bottom: -1px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--info));
      border-radius: 999px;
    }

    /* ======= Blocs de contingut ======= */
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .section {
      background: color-mix(in oklab, var(--surface), var(--bg) 12%);
      border: 1px solid rgb(2 6 23 / 8%);
      box-shadow: var(--shadow-2);
      border-radius: var(--radius);
      padding: clamp(14px, 2.5vw, 20px);
      margin: 18px 0;
    }

    .section h2 {
      margin: 0 0 10px 0;
      font-size: clamp(1.1rem, 2.2vw, 1.3rem);
      color: var(--primary-600);
      letter-spacing: -0.01em;
    }

    p { line-height: 1.7; margin: 10px 0; }

    ol { margin: 0 0 0 1.15rem; }

    .kbd {
      font: 600 0.88rem ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      padding: 2px 6px; border-radius: 6px;
      background: color-mix(in oklab, var(--surface), var(--bg) 22%);
      border: 1px solid rgb(2 6 23 / 10%);
    }

    /* ======= Targetes/exercicis ======= */
    .exercise-container { margin-top: 10px; }

    .instructions {
      border-left: 4px solid var(--primary);
      background: color-mix(in oklab, var(--primary), transparent 88%);
      padding: 14px 16px;
      border-radius: 10px;
      color: color-mix(in oklab, var(--text), var(--primary) 20%);
    }

    .syllable-exercise {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: var(--grid-gap);
      margin: 18px 0;
    }

    .word-exercise {
      background: var(--surface);
      border-radius: 12px;
      padding: 14px;
      border: 1px solid rgb(2 6 23 / 8%);
      box-shadow: var(--shadow-2);
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .word-exercise:focus-within { box-shadow: 0 0 0 3px rgb(37 99 235 / 16%); }
    .word-exercise.correct { border-color: color-mix(in oklab, var(--success), black 10%); background: color-mix(in oklab, var(--success), transparent 92%); }
    .word-exercise.incorrect { border-color: color-mix(in oklab, var(--danger), black 10%); background: color-mix(in oklab, var(--danger), transparent 92%); }

    /* ‚úÖ Estat "correcte" (despr√©s d'haver fallat) */
    .word-exercise.late { 
      border-color: color-mix(in oklab, var(--warning), black 10%);
      background: color-mix(in oklab, var(--warning), transparent 92%);
    }

    .word-title { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .word-title span:first-child { font-weight: 700; letter-spacing: .01em; }

    .word-status {
      font-size: 0.8rem; padding: 4px 10px; border-radius: 999px;
      background: color-mix(in oklab, var(--surface), var(--bg) 18%);
      color: var(--muted); border: 1px solid rgb(2 6 23 / 10%);
    }
    .word-status.correct { background: color-mix(in oklab, var(--success), transparent 86%); color: color-mix(in oklab, var(--success), black 20%); border-color: color-mix(in oklab, var(--success), black 10%); }
    .word-status.incorrect { background: color-mix(in oklab, var(--danger), transparent 86%); color: color-mix(in oklab, var(--danger), black 20%); border-color: color-mix(in oklab, var(--danger), black 10%); }
    /* ‚úÖ Xip d‚Äôestat groc per als encerts sense punt */
    .word-status.late {
      background: color-mix(in oklab, var(--warning), transparent 86%);
      color: color-mix(in oklab, var(--warning), black 20%);
      border-color: color-mix(in oklab, var(--warning), black 10%);
    }

    .word-container {
      display: flex; justify-content: center; align-items: center; flex-wrap: wrap;
      gap: 3px; margin: 12px 0; padding: 10px; border-radius: 10px;
      background: color-mix(in oklab, var(--surface), var(--bg) 18%);
      min-height: 58px;
    }

    .letter { font-size: 1.45rem; padding: 8px 3px; border-bottom: 2px solid transparent; border-radius: 6px; cursor: pointer; }
    .letter:hover { background: color-mix(in oklab, var(--surface), var(--bg) 24%); }

    .special-char { font-size: 1.45rem; padding: 8px 2px; color: #8e44ad; font-weight: 800; cursor: pointer; border-radius: 6px; }
    .special-char:hover { background: color-mix(in oklab, var(--surface), var(--bg) 24%); color: var(--primary); }

    .separator { font-size: 1.45rem; padding: 8px 4px; color: var(--primary); font-weight: 800; cursor: pointer; border-radius: 6px; position: relative; }
    /* Abans: fons groc i text vermell + ‚úï. Ara: sense ‚úï i amb fons suau blau */
    .separator:hover { background: color-mix(in oklab, var(--primary), transparent 88%); color: var(--primary); }
    .separator::after { content: none !important; }           /* ‚úï eliminada en qualsevol estat */

    .separator-placeholder { width: 9px; height: 30px; cursor: pointer; border: 2px dashed rgb(2 6 23 / 20%); border-radius: 3px; transition: 120ms ease; }
    .separator-placeholder:hover { background: color-mix(in oklab, var(--primary), transparent 88%); border-color: var(--primary); }

    .word-controls { display: flex; gap: 10px; }

    .word-check-btn {
      flex: 1; background: var(--primary); color: white; border: 0; padding: 10px 14px; border-radius: 999px; font-weight: 800; cursor: pointer;
      box-shadow: 0 2px 8px rgb(37 99 235 / 22%);
      transition: transform .16s ease, background .16s ease, box-shadow .16s ease;
    }
    .word-check-btn:hover { background: var(--primary-600); transform: translateY(-1px); }
    .word-check-btn:active { transform: translateY(0); }

    .word-feedback { margin-top: 10px; font-weight: 700; min-height: 22px; text-align: center; padding: 8px; border-radius: 8px; }
    .word-feedback.correct { color: var(--success-600); background: color-mix(in oklab, var(--success), transparent 88%); }
    .word-feedback.incorrect { color: var(--danger-600); background: color-mix(in oklab, var(--danger), transparent 88%); }
    /* ‚úÖ Missatge groc per a ‚ÄúCorrecte (sense punt)‚Äù */
    .word-feedback.late { 
      color: #b45309; 
      background: color-mix(in oklab, var(--warning), transparent 88%);
    }

    /* ======= Controls generals ======= */
    .controls { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
    .btn { background: var(--primary); color: white; border: 0; padding: 12px 22px; border-radius: 12px; cursor: pointer; font-weight: 800; box-shadow: 0 4px 12px rgb(37 99 235 / 22%); transition: .18s ease; }
    .btn:hover { transform: translateY(-2px); }
    .btn:focus-visible { outline: none; box-shadow: var(--ring); }
    .btn-check { background: var(--success); }
    .btn-check:hover { background: var(--success-600); }
    .btn-reset { background: var(--danger); }
    .btn-reset:hover { background: var(--danger-600); }

    .score { font-weight: 800; text-align: center; margin: 14px 0; }

    .progress-bar { height: 12px; border-radius: 999px; background: color-mix(in oklab, var(--surface), var(--bg) 24%); overflow: hidden; border: 1px solid rgb(2 6 23 / 10%); }
    .progress { height: 100%; width: 0%; background: linear-gradient(90deg, var(--success), var(--info)); transition: width .4s ease; }

    /* ======= Llistes d'exemples i caixes tem√†tiques ======= */
    .accent-examples { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; margin: 12px 0; }
    .accent-group { background: var(--surface); border-radius: 10px; border: 1px solid rgb(2 6 23 / 10%); padding: 10px; }
    .accent-list { display: grid; gap: 8px; }
    .example-word { padding: 6px 10px; border-radius: 8px; background: color-mix(in oklab, var(--surface), var(--bg) 16%); text-align: center; font-weight: 600; }

    .rule-box, .important-box, .accent-box, .exception-box, .mnemonic-box { border-radius: 12px; padding: 16px; margin: 16px 0; }
    .rule-box { border-left: 6px solid var(--primary); background: color-mix(in oklab, var(--primary), transparent 90%); }
    .important-box { border-left: 6px solid var(--warning); background: color-mix(in oklab, var(--warning), transparent 90%); }
    .accent-box { border-left: 6px solid var(--info); background: color-mix(in oklab, var(--info), transparent 92%); }
    .exception-box { border-left: 6px solid #e67e22; background: color-mix(in oklab, #e67e22, transparent 90%); }

    .special-cases { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 14px; }
    .case-group { background: var(--surface); border-radius: 12px; border: 1px solid rgb(2 6 23 / 10%); padding: 12px; }
    .case-title { font-weight: 800; color: var(--primary-600); margin-bottom: 8px; text-align: center; }

    .open-accent { color: #16a34a; font-weight: 800; }
    .closed-accent { color: #b45309; font-weight: 800; }
    .special-case { color: #8e44ad; font-weight: 800; }

    .examples-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; }

    .mnemonic-box .mnemonic-title { color: #8e44ad; font-weight: 900; display: flex; align-items: center; gap: 8px; }
    .mnemonic-text { font-style: italic; background: var(--surface); border: 1px dashed #8e44ad; padding: 14px; border-radius: 10px; text-align: center; }
    .highlight-word { background: #e8d4f5; padding: 2px 6px; border-radius: 6px; font-weight: 900; color: #6d28d9; }
    .mnemonic-image { text-align: center; margin: 12px 0; }
    .mnemonic-image img { max-width: 100%; border-radius: 10px; border: 3px solid #e8d4f5; box-shadow: var(--shadow-2); }
    .image-caption { color: var(--muted); font-size: .9rem; text-align: center; }

    /* ======= Mostra grans/petites per a accents ======= */
    .char-board { display: grid; gap: 6px; margin: 8px 0 4px; }
    .char-row { display: flex; gap: 14px; align-items: baseline; justify-content: center; flex-wrap: wrap; }
    .char-large { 
      font-size: clamp(10rem, 35vw, 40rem); 
      line-height: .85;
    }

    .char-tiny { 
      font-size: clamp(0.35rem, 0.9vw, 0.4rem); 
      line-height: 1.1;
    }

    /* ======= Responsive ======= */
    @media (max-width: 720px) {
      body { padding: 16px; }
      .tablist { overflow-x: auto; }
      .word-container { min-height: 52px; }
    }
  </style>
</head>
<body>
  <main class="container">
    <header class="page-header">
      <span class="eyebrow">Pr√†ctica guiada</span>
      <h1>Esdr√∫ixoles i separaci√≥ de s√≠l¬∑labes</h1>
    </header>

    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="Seccions">
      <div class="tablist">
        <button class="tab" role="tab" id="tab-teoria" aria-controls="teoria" aria-selected="true" data-tab="teoria">Esdr√∫ixoles</button>
        <button class="tab" role="tab" id="tab-separacio" aria-controls="separacio-sil-labes" aria-selected="false" data-tab="separacio-sil-labes">Separaci√≥ de s√≠l¬∑labes</button>
        <button class="tab" role="tab" id="tab-accent" aria-controls="accentuacio-esdruixoles" aria-selected="false" data-tab="accentuacio-esdruixoles">Accentuaci√≥ d‚Äôesdr√∫ixoles</button>
      </div>
    </nav>

    <!-- Contingut: Teoria (CONTINGUT ORIGINAL COMPLET) -->
    <section id="teoria" class="tab-content active" role="tabpanel" aria-labelledby="tab-teoria">
      <div class="section">
        <h2>Qu√® √©s una paraula esdr√∫ixola?</h2>
        <p>Una paraula <strong>esdr√∫ixola</strong> t√© l'accent t√≤nic (la s√≠l¬∑laba que es pronuncia amb m√©s for√ßa) a la  s√≠l¬∑laba <strong>antepen√∫ltima</strong> (la tercera comen√ßant pel final).</p>
        <p class="instructions"><strong>Exemples:</strong> <em><strong>m√∫</strong>-si-ca</em>, <em>es-<strong>dr√∫i</strong>-xo-la</em>, <em><strong>c√†</strong>-me-ra</em>.</p>
      </div>

      <div class="section">
        <h2>Com identificar una esdr√∫ixola</h2>
        <ol>
          <li>Separa la paraula en s√≠l¬∑labes.</li>
          <li>Compta les s√≠l¬∑labes des del final.</li>
          <li>Si l'accent t√≤nic √©s a la tercera s√≠l¬∑laba des del final, √©s esdr√∫ixola.</li>
        </ol>
        <p class="instructions">Exemple: <strong>esdr√∫ixola</strong> ‚Üí es-<strong>dr√∫i</strong>-xo-la (accent a la s√≠l¬∑laba <strong>antepen√∫ltima</strong>).</p>
      </div>

      <div class="important-box section">
        <h2>Recorda quan les vocals se separen:</h2>
        <div class="special-cases">
          <div class="case-group">
            <div class="case-title">I + a/e/o</div>
            <p>La <span class="special-case">i</span> seguida de <strong>a</strong>, <strong>e</strong> o <strong>o</strong> no forma diftong; s√≥n s√≠l¬∑labes diferents:</p>
            <div class="examples-grid">
              <div class="example-word">fa-m<span class="special-case">√≠</span>-li-a</div>
              <div class="example-word">gr<span class="special-case">√†</span>-ci-es</div>
              <div class="example-word">su-per-f<span class="special-case">√≠</span>-ci-e</div>
              <div class="example-word">c<span class="special-case">√†</span>-ri-es</div>
              <div class="example-word">N<span class="special-case">√∫</span>-ri-a</div>
              <div class="example-word">r<span class="special-case">√†</span>-di-o</div>
            </div>
          </div>
          <div class="case-group">
            <div class="case-title">U + a/e/o</div>
            <p>Quan la <span class="special-case">u</span> va seguida de <strong>a</strong>, <strong>e</strong> o <strong>o</strong>, tampoc forma diftong:</p>
            <div class="examples-grid">
              <div class="example-word">con-t<span class="special-case">√≠</span>-nu-a</div>
              <div class="example-word">t<span class="special-case">√®</span>-nu-e</div>
            </div>
          </div>
        </div>
        <div class="special-cases">
          <div class="case-group">
            <div class="case-title">Atenci√≥!</div>
            <p>Les vocals de les combinacions <strong>gua / g√ºe / g√ºi / guo</strong> i <strong>qua / q√ºe / q√ºi / quo</strong> formen diftong i, per tant, no se separen:</p>
            <div class="examples-grid">
              <div class="example-word">am-bi-g<span class="special-case">√ºi</span>-tat</div>
              <div class="example-word">pas-q<span class="special-case">ua</span></div>
              <div class="example-word">ai-g<span class="special-case">√ºe</span>s</div>
            </div>
            <p>Les vocals de <strong>gue, gui, que, qui</strong> (la u √©s muda) tampoc se separen:</p>
            <div class="examples-grid">
              <div class="example-word">al-g<span class="special-case">ue</span>s</div>
              <div class="example-word">gro-g<span class="special-case">ui</span></div>
              <div class="example-word">ta-q<span class="special-case">ue</span>s</div>
              <div class="example-word">br√≤-q<span class="special-case">ui</span>l</div>
              <div class="example-word">ob-se-q<span class="special-case">ui</span></div>
            </div>
          </div>
        </div>
      </div>

      <div class="rule-box section">
        <h2>Regla fonamental</h2>
        <p><strong>TOTS els mots esdr√∫ixols porten accent.</strong></p>
      </div>

      <div class="accent-box section">
        <h2>Accents de les esdr√∫ixoles</h2>
        <p>Gaireb√© sempre l'accent de la <strong>e</strong> i de la <strong>o</strong> √©s <span class="open-accent">obert</span>. La proporci√≥ √©s aquesta:</p>

        <!-- üîµ Mostra de car√†cters: grans (√®, √≤) i petits (√©, √≥) -->
        <div class="char-board" aria-label="Mostra d'accents oberts i tancats">
          <div class="char-row" aria-label="Accents oberts en mida m√†xima">
            <span class="char-large open-accent" aria-label="E oberta gran">√®</span>
            <span class="char-large open-accent" aria-label="O oberta gran">√≤</span>
          </div>
          <div class="char-row" aria-label="Accents tancats en mida m√≠nima llegible">
            <span class="char-tiny closed-accent" aria-label="E tancada petita">√©</span>
            <span class="char-tiny closed-accent" aria-label="O tancada petita">√≥</span>
          </div>
        </div>
        <!-- üîµ Fi de la mostra -->

        <div class="accent-examples">
          <div class="accent-group">
            <h3>E oberta (√®)</h3>
            <div class="accent-list">
              <div class="example-word"><span class="open-accent">√®</span>-po-ca</div>
              <div class="example-word">in-tel-li-g<span class="open-accent">√®</span>n-ci-a</div>
              <div class="example-word"><span class="open-accent">√®</span>t-ni-a</div>
              <div class="example-word">s<span class="open-accent">√®</span>-ri-e</div>
              <div class="example-word">t<span class="open-accent">√®</span>-nu-e</div>
              <div class="example-word">es-t<span class="open-accent">√®</span>-re-o</div>
            </div>
          </div>
          <div class="accent-group">
            <h3>O oberta (√≤)</h3>
            <div class="accent-list">
              <div class="example-word">c<span class="open-accent">√≤</span>-le-ra</div>
              <div class="example-word"><span class="open-accent">√≤</span>-li-ba</div>
              <div class="example-word">me-m<span class="open-accent">√≤</span>-ri-a</div>
              <div class="example-word">qui-l<span class="open-accent">√≤</span>-me-tre</div>
              <div class="example-word">hi-p<span class="open-accent">√≤</span>-te-si</div>
              <div class="example-word">s<span class="open-accent">√≤</span>-mi-nes</div>
            </div>
          </div>
        </div>
      </div>

      <div class="exception-box section">
        <h2>Excepcions amb accent tancat</h2>
        <p>Hi ha poques paraules esdr√∫ixoles amb <span class="closed-accent">√©</span> o  <span class="closed-accent">√≥</span>:</p>
        <div class="accent-examples">
          <div class="accent-group">
            <h3>E tancada (√©)</h3>
            <div class="accent-list">
              <div class="example-word">fe-r<span class="closed-accent">√©</span>s-te-ga</div>
              <div class="example-word">c<span class="closed-accent">√©</span>r-vo-la</div>
              <div class="example-word">es-gl<span class="closed-accent">√©</span>-si-a</div>
            </div>
          </div>
          <div class="accent-group">
            <h3>O tancada (√≥)</h3>
            <div class="accent-list">
              <div class="example-word">es-c<span class="closed-accent">√≥</span>r-po-ra</div>
              <div class="example-word">f<span class="closed-accent">√≥</span>r-mu-la</div>
              <div class="example-word">p<span class="closed-accent">√≥</span>l-vo-ra</div>
              <div class="example-word">t<span class="closed-accent">√≥</span>m-bo-la</div>
              <div class="example-word">t<span class="closed-accent">√≥</span>r-to-ra</div>
            </div>
          </div>
        </div>
        <div class="mnemonic-box">
          <div class="mnemonic-title">üí° Truc per recordar les excepcions</div>
          <div class="mnemonic-image">
            <img src="excepcions_accentuacio_esdruixoles.png" alt="Frase mnemot√®cnica d'excepcions d'accent tancat en esdr√∫ixoles" />
            <div class="image-caption">Imatge mnemot√®cnica </div>
          </div>
          <p class="mnemonic-text">"A l'<span class="highlight-word">esgl√©sia</span> una <span class="highlight-word">c√©rvola</span> <span class="highlight-word">fer√©stega</span>, una <span class="highlight-word">t√≥rtora</span> i una <span class="highlight-word">esc√≥rpora</span> preparaven una <span class="highlight-word">f√≥rmula</span> amb la <span class="highlight-word">p√≥lvora</span> que van guanyar a la <span class="highlight-word">t√≥mbola</span>."</p>
          <p class="subtle" style="text-align:center">Memoritza la frase (i la imatge) per retenir les excepcions amb accent tancat.</p>
        </div>
      </div>
    </section>

    <!-- Contingut: Exercici -->
    <section id="separacio-sil-labes" class="tab-content" role="tabpanel" aria-labelledby="tab-separacio">
      <div class="section exercise-container">
        <h2>Exercici de separaci√≥ de s√≠l¬∑labes ¬∑ 10 paraules</h2>
        <div class="instructions">
          <p><strong>Com funciona?</strong></p>
          <p>Fes clic entre les lletres per col¬∑locar un separador. Torna a fer clic per treure'l. Pots comprovar cada paraula amb el bot√≥ "Comprova-ho" o prement "Enter".</p>
        </div>

        <div class="syllable-exercise" id="syllable-exercise"></div>

        <div class="progress-bar"><div class="progress" id="progress"></div></div>
        <p class="score" id="score">Paraules encertades: 0/10 (0 comprovades)</p>

        <div class="controls">
          <button class="btn btn-check" id="check-all-btn" aria-live="polite">Comprova-ho tot</button>
          <button class="btn btn-reset" id="reset-all-btn">Reinicia</button>
          <button class="btn" id="new-exercise-btn">Nou exercici</button>
        </div>

        <div class="instructions" id="feedback" style="display:none"></div>
      </div>
    </section>

    <!-- NOVA SECCI√ì: Accentuaci√≥ d‚Äôesdr√∫ixoles -->
    <section id="accentuacio-esdruixoles" class="tab-content" role="tabpanel" aria-labelledby="tab-accent">
      <div class="section exercise-container">
        <h2>Exercici d‚Äôaccentuaci√≥ d‚Äôesdr√∫ixoles ¬∑ 10 paraules</h2>
        <div class="instructions">
          <p><strong>Objectiu:</strong> Afegeix l‚Äôaccent correcte a la s√≠l¬∑laba antepen√∫ltima.</p>
          <p><strong>Com?</strong> Clica les vocals per <span class="highlight-word">alternar</span> l‚Äôaccent:
            <span class="kbd">a‚Üî√†</span>,
            <span class="kbd">e‚Üî√®‚Üî√©</span>,
            <span class="kbd">i‚Üî√≠</span>,
            <span class="kbd">o‚Üî√≤‚Üî√≥</span>,
            <span class="kbd">u‚Üî√∫</span>. Prem <span class="kbd">Enter</span> per comprovar la targeta.
          </p>
        </div>

        <div class="syllable-exercise" id="accent-exercise"></div>

        <div class="progress-bar"><div class="progress" id="accent-progress"></div></div>
        <p class="score" id="accent-score">Paraules encertades: 0/10 (0 comprovades)</p>

        <div class="controls">
          <button class="btn btn-check" id="accent-check-all-btn">Comprova-ho tot</button>
          <button class="btn btn-reset" id="accent-reset-all-btn">Reinicia</button>
          <button class="btn" id="accent-new-exercise-btn">Nou exercici</button>
        </div>

        <div class="instructions" id="accent-feedback" style="display:none"></div>
      </div>
    </section>
  </main>

  <script>
    /* ===== Tabs accessibles ===== */
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        tabs.forEach(t => { t.setAttribute('aria-selected', 'false'); });
        tab.setAttribute('aria-selected', 'true');
        tabContents.forEach(c => c.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
      });
    });

    /* ===== Exercici de s√≠l¬∑labes (ORIGINAL) ===== */
    const words = [
      { word: "Am√®lia", syllables: ["A", "m√®", "li", "a"] },
      { word: "matem√†tiques", syllables: ["ma", "te", "m√†", "ti", "ques"] },
      { word: "m√∫sica", syllables: ["m√∫", "si", "ca"] },
      { word: "esdr√∫ixola", syllables: ["es", "dr√∫i", "xo", "la"] },
      { word: "c√†mera", syllables: ["c√†", "me", "ra"] },
      { word: "p√†gina", syllables: ["p√†", "gi", "na"] },
      { word: "hip√≤tesi", syllables: ["hi", "p√≤", "te", "si"] },
      { word: "fam√≠lia", syllables: ["fa", "m√≠", "li", "a"] },
      { word: "televisi√≥", syllables: ["te", "le", "vi", "si", "√≥"] },
      { word: "electricitat", syllables: ["e", "lec", "tri", "ci", "tat"] },
      { word: "universitat", syllables: ["u", "ni", "ver", "si", "tat"] },
      { word: "important", syllables: ["im", "por", "tant"] },
      { word: "dificultat", syllables: ["di", "fi", "cul", "tat"] },
      { word: "paraula", syllables: ["pa", "rau", "la"] },
      { word: "s√≠l¬∑laba", syllables: ["s√≠l", "la", "ba"] },
      { word: "exemple", syllables: ["e", "xem", "ple"] },
      { word: "pr√†ctica", syllables: ["pr√†c", "ti", "ca"] },
      { word: "ci√®ncia", syllables: ["ci","√®n", "ci", "a"] },
      { word: "paci√®ncia", syllables: ["pa", "ci","√®n", "ci", "a"] },
      { word: "cl√≠nica", syllables: ["cl√≠", "ni", "ca"] },
      { word: "cont√≠nua", syllables: ["con", "t√≠", "nu", "a"] },
      { word: "plaques", syllables: ["pla", "ques"] },
      { word: "paraig√ºes", syllables: ["pa", "rai", "g√ºes"] },
      { word: "f√≠sica", syllables: ["f√≠", "si", "ca"] },
      { word: "ciberespai", syllables: ["ci", "ber", "es", "pai"] },
      { word: "consci√®ncia", syllables: ["cons", "ci", "√®n", "ci", "a"] },
      { word: "o√Øda", syllables: ["o", "√Ø", "da"] },
      { word: "decisi√≥", syllables: ["de", "ci", "si", "√≥"] },
      { word: "equaci√≥", syllables: ["e", "qua", "ci", "√≥"] },
      { word: "solucions", syllables: ["so", "lu", "ci", "ons"] },
      { word: "eleg√†ncia", syllables: ["e", "le", "g√†n", "ci", "a"] },
      { word: "coher√®ncia", syllables: ["co", "he", "r√®n", "ci", "a"] },
      { word: "ocurr√®ncia", syllables: ["o", "cur", "r√®n", "ci", "a"] },
      { word: "Maria", syllables: ["Ma", "ri", "a"] },
      { word: "abund√†ncia", syllables: ["a", "bun", "d√†n", "ci", "a"] },
      { word: "ac√†cia", syllables: ["a", "c√†", "ci", "a"] },
      { word: "acrob√†cia", syllables: ["a", "cro", "b√†", "ci", "a"] },
      { word: "l√≠nia", syllables: ["l√≠", "ni", "a"] },
      { word: "al√ß√†ria", syllables: ["al", "√ß√†", "ri", "a"] },
      { word: "alegria", syllables: ["a", "le", "gri", "a"] },
      { word: "al¬∑l√®rgia", syllables: ["al", "l√®r", "gi", "a"] },
      { word: "ambul√†ncia", syllables: ["am", "bu", "l√†n", "ci", "a"] },
      { word: "ang√∫nia", syllables: ["an", "g√∫", "ni", "a"] }
    ];

    const syllableExercise = document.getElementById('syllable-exercise');
    const checkAllBtn = document.getElementById('check-all-btn');
    const resetAllBtn = document.getElementById('reset-all-btn');
    const newExerciseBtn = document.getElementById('new-exercise-btn');
    const scoreElement = document.getElementById('score');
    const progressBar = document.getElementById('progress');
    const feedback = document.getElementById('feedback');

    let currentExerciseWords = [];
    let userSeparators = {};
    // wordStatus[index] = { checked, correct, attempts, scored, late }
    let wordStatus = {};

    function generateNewExercise() {
      currentExerciseWords = [...words].sort(() => Math.random() - 0.5).slice(0, 10);
      userSeparators = {};
      wordStatus = {};
      syllableExercise.innerHTML = '';
      updateScore();
      feedback.style.display = 'none';

      currentExerciseWords.forEach((wordObj, index) => {
        userSeparators[index] = [];
        wordStatus[index] = { checked: false, correct: false, attempts: 0, scored: false, late: false };

        const wordExercise = document.createElement('div');
        wordExercise.className = 'word-exercise';
        wordExercise.id = `word-exercise-${index}`;
        wordExercise.innerHTML = `
          <div class="word-title">
            <span>${index + 1}. ${wordObj.word}</span>
            <span class="word-status" id="word-status-${index}">Pendent</span>
          </div>
          <div class="word-container" id="word-container-${index}" tabindex="0" aria-label="Paraula ${wordObj.word}. Fes clic per afegir separadors."></div>
          <div class="word-controls">
            <button class="word-check-btn" data-index="${index}" aria-label="Comprova la paraula ${wordObj.word}">Comprova-ho</button>
          </div>
          <div class="word-feedback" id="feedback-${index}" aria-live="polite"></div>
        `;
        syllableExercise.appendChild(wordExercise);

        renderWord(index);

        const checkBtn = wordExercise.querySelector('.word-check-btn');
        checkBtn.addEventListener('click', () => checkSingleAnswer(index));
        const wordContainer = document.getElementById(`word-container-${index}`);
        wordContainer.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkSingleAnswer(index); });
      });
    }

    function renderWord(index) {
      const wordContainer = document.getElementById(`word-container-${index}`);
      const wordObj = currentExerciseWords[index];
      wordContainer.innerHTML = '';

      if (wordObj.word.includes('¬∑')) {
        renderWordWithSpecialChars(index, wordObj);
      } else {
        renderNormalWord(index, wordObj);
      }

      userSeparators[index].forEach((position) => applySeparator(index, position));
    }

    function renderNormalWord(index, wordObj) {
      const wordContainer = document.getElementById(`word-container-${index}`);
      const letters = wordObj.word.split('');
      letters.forEach((letter, letterIndex) => {
        const letterElement = document.createElement('span');
        letterElement.className = 'letter';
        letterElement.textContent = letter;
        letterElement.dataset.index = letterIndex;
        wordContainer.appendChild(letterElement);
        if (letterIndex < letters.length - 1) {
          const separatorPlaceholder = document.createElement('div');
          separatorPlaceholder.className = 'separator-placeholder';
          separatorPlaceholder.dataset.position = letterIndex;
          separatorPlaceholder.dataset.wordIndex = index;
          separatorPlaceholder.addEventListener('click', addSeparator);
          wordContainer.appendChild(separatorPlaceholder);
        }
      });
    }

    function renderWordWithSpecialChars(index, wordObj) {
      const wordContainer = document.getElementById(`word-container-${index}`);
      const word = wordObj.word;
      let currentIndex = 0;
      for (let i = 0; i < word.length; i++) {
        const char = word[i];
        if (char === '¬∑') {
          const specialChar = document.createElement('span');
          specialChar.className = 'special-char';
          specialChar.textContent = char;
          specialChar.dataset.position = currentIndex;
          specialChar.dataset.wordIndex = index;
          specialChar.dataset.isDot = 'true';
          specialChar.addEventListener('click', convertDotToSeparator);
          wordContainer.appendChild(specialChar);
          currentIndex++;
        } else {
          const letterElement = document.createElement('span');
          letterElement.className = 'letter';
          letterElement.textContent = char;
          letterElement.dataset.index = currentIndex;
          wordContainer.appendChild(letterElement);
          const nextChar = word[i + 1];
          const prevChar = word[i - 1];
          const isBetweenGeminades = (prevChar === '¬∑' || nextChar === '¬∑');
          if (i < word.length - 1 && !isBetweenGeminades) {
            const separatorPlaceholder = document.createElement('div');
            separatorPlaceholder.className = 'separator-placeholder';
            separatorPlaceholder.dataset.position = currentIndex;
            separatorPlaceholder.dataset.wordIndex = index;
            separatorPlaceholder.addEventListener('click', addSeparator);
            wordContainer.appendChild(separatorPlaceholder);
          }
          currentIndex++;
        }
      }
    }

    function convertDotToSeparator(event) {
      const position = parseInt(event.target.dataset.position);
      const wordIndex = parseInt(event.target.dataset.wordIndex);
      if (!userSeparators[wordIndex].includes(position)) {
        userSeparators[wordIndex].push(position);
        userSeparators[wordIndex].sort((a, b) => a - b);
        applySeparator(wordIndex, position);
        if (wordStatus[wordIndex].checked) softResetWordDisplay(wordIndex);
      }
    }

    function addSeparator(event) {
      const position = parseInt(event.target.dataset.position);
      const wordIndex = parseInt(event.target.dataset.wordIndex);
      if (!userSeparators[wordIndex].includes(position)) {
        userSeparators[wordIndex].push(position);
        userSeparators[wordIndex].sort((a, b) => a - b);
        applySeparator(wordIndex, position);
        if (wordStatus[wordIndex].checked) softResetWordDisplay(wordIndex);
      }
    }

    function removeSeparator(event) {
      const position = parseInt(event.target.dataset.position);
      const wordIndex = parseInt(event.target.dataset.wordIndex);
      userSeparators[wordIndex] = userSeparators[wordIndex].filter((pos) => pos !== position);
      renderWord(wordIndex);
      if (wordStatus[wordIndex].checked) softResetWordDisplay(wordIndex);
    }

    function applySeparator(wordIndex, position) {
      const wordContainer = document.getElementById(`word-container-${wordIndex}`);
      const elements = wordContainer.children;
      for (let i = 0; i < elements.length; i++) {
        const element = elements[i];
        const isPlaceholder = element.classList.contains('separator-placeholder');
        const isDot = element.classList.contains('special-char');
        if ((isPlaceholder || isDot) && parseInt(element.dataset.position) === position) {
          element.innerHTML = '-';
          element.className = 'separator';
          element.dataset.position = position;
          element.dataset.wordIndex = wordIndex;
          element.title = "Torna a fer clic per treure'l";
          if (isPlaceholder) element.removeEventListener('click', addSeparator);
          if (isDot) element.removeEventListener('click', convertDotToSeparator);
          element.addEventListener('click', removeSeparator);
        }
      }
    }

    function buildUserSyllables(wordObj, sepPositions) {
      const userSyllables = [];
      let currentSyllable = '';
      const cleanWord = wordObj.word.replace('¬∑', '');
      const letters = cleanWord.split('');
      let adjustedSeparators = [...sepPositions];
      if (wordObj.word.includes('¬∑')) {
        const dotPosition = wordObj.word.indexOf('¬∑');
        adjustedSeparators = sepPositions.map((pos) => (pos >= dotPosition ? pos - 1 : pos));
      }
      letters.forEach((letter, letterIndex) => {
        currentSyllable += letter;
        if (adjustedSeparators.includes(letterIndex)) {
          userSyllables.push(currentSyllable);
          currentSyllable = '';
        }
      });
      if (currentSyllable) userSyllables.push(currentSyllable);
      return userSyllables;
    }

    function checkSingleAnswer(index) {
      const wordObj = currentExerciseWords[index];
      const userSyllables = buildUserSyllables(wordObj, userSeparators[index]);

      // Comptem intents
      wordStatus[index].attempts += 1;

      const isCorrect = JSON.stringify(userSyllables) === JSON.stringify(wordObj.syllables);

      // Correcte a la primera -> suma punt
      if (isCorrect && wordStatus[index].attempts === 1) {
        wordStatus[index].scored = true;
        wordStatus[index].late = false;
      }

      // Correcte per√≤ despr√©s d'haver fallat -> no suma, marca "late"
      if (isCorrect && wordStatus[index].attempts > 1) {
        wordStatus[index].scored = wordStatus[index].scored || false; // mant√© si ja havia puntuat
        wordStatus[index].late = !wordStatus[index].scored;           // late nom√©s si no havia puntuat
      }

      wordStatus[index].checked = true;
      wordStatus[index].correct = isCorrect;

      // Visualitzaci√≥ segons estat
      if (isCorrect && wordStatus[index].late && !wordStatus[index].scored) {
        updateWordDisplay(index, 'late', wordObj.syllables.join('-'));
      } else {
        updateWordDisplay(index, isCorrect ? 'correct' : 'incorrect', wordObj.syllables.join('-'));
      }

      updateGlobalScore();
    }

    // Reseteig suau de la vista si es modifica despr√©s de comprovar, sense tocar intents ni "scored"
    function softResetWordDisplay(index) {
      wordStatus[index].checked = false;
      wordStatus[index].correct = false;
      const wordExercise = document.getElementById(`word-exercise-${index}`);
      const wordStatusElement = document.getElementById(`word-status-${index}`);
      const wordFeedback = document.getElementById(`feedback-${index}`);
      wordExercise.className = 'word-exercise';
      wordStatusElement.textContent = 'Pendent';
      wordStatusElement.className = 'word-status';
      wordFeedback.textContent = '';
      wordFeedback.className = 'word-feedback';
    }

    function updateWordDisplay(index, state, correctAnswer) {
      const wordExercise = document.getElementById(`word-exercise-${index}`);
      const wordStatusElement = document.getElementById(`word-status-${index}`);
      const wordFeedback = document.getElementById(`feedback-${index}`);

      if (state === 'correct') {
        wordExercise.className = 'word-exercise correct';
        wordStatusElement.textContent = 'Correcte';
        wordStatusElement.className = 'word-status correct';
        wordFeedback.textContent = '‚úì Correcte!';
        wordFeedback.className = 'word-feedback correct';
      } else if (state === 'late') {
        wordExercise.className = 'word-exercise late';
        wordStatusElement.textContent = 'Correcte';
        wordStatusElement.className = 'word-status late';
        wordFeedback.textContent = '‚úì Correcte (sense punt)';
        wordFeedback.className = 'word-feedback late';
      } else {
        wordExercise.className = 'word-exercise incorrect';
        wordStatusElement.textContent = 'Incorrecte';
        wordStatusElement.className = 'word-status incorrect';
        wordFeedback.textContent = `‚úó Correcte: ${correctAnswer}`;
        wordFeedback.className = 'word-feedback incorrect';
      }
    }

    function checkAllAnswers() {
      currentExerciseWords.forEach((_, index) => { if (!wordStatus[index].checked) checkSingleAnswer(index); });
      const scoredCount = Object.values(wordStatus).filter((s) => s.scored).length;
      if (scoredCount === 10) {
        feedback.textContent = 'Excel¬∑lent! Has encertat totes les paraules a la primera.';
        feedback.className = 'instructions';
      } else {
        feedback.textContent = `Has encertat ${scoredCount} de 10 paraules a la primera. Continua practicant!`;
        feedback.className = 'instructions';
      }
      feedback.style.display = 'block';
    }

    function resetAllWords() {
      currentExerciseWords.forEach((_, index) => {
        userSeparators[index] = [];
        renderWord(index);
        // Reinicia completament l‚Äôestat:
        wordStatus[index] = { checked: false, correct: false, attempts: 0, scored: false, late: false };
        softResetWordDisplay(index);
      });
      updateGlobalScore();
      feedback.style.display = 'none';
    }

    function updateGlobalScore() {
      const scoredCount = Object.values(wordStatus).filter((s) => s.scored).length;
      const checkedCount = Object.values(wordStatus).filter((s) => s.checked).length;
      scoreElement.textContent = `Paraules encertades: ${scoredCount}/10 (${checkedCount} comprovades)`;
      progressBar.style.width = `${(scoredCount / 10) * 100}%`;
    }

    function updateScore(correctCount = 0) {
      scoreElement.textContent = `Paraules encertades: ${correctCount}/10 (0 comprovades)`;
      progressBar.style.width = `${(correctCount / 10) * 100}%`;
    }

    checkAllBtn.addEventListener('click', checkAllAnswers);
    resetAllBtn.addEventListener('click', resetAllWords);
    newExerciseBtn.addEventListener('click', generateNewExercise);

    generateNewExercise();

    /* ===== NOVA L√íGICA: Accentuaci√≥ d‚Äôesdr√∫ixoles ===== */

    // Dataset: plain (sense accents) -> target (amb accents i ¬∑ si escau)
    const ACCENT_WORDS = [
      { plain: "musica", target: "m√∫sica" },
      { plain: "camera", target: "c√†mera" },
      { plain: "pagina", target: "p√†gina" },
      { plain: "hipotesi", target: "hip√≤tesi" },
      { plain: "familia", target: "fam√≠lia" },
      { plain: "clinica", target: "cl√≠nica" },
      { plain: "continua", target: "cont√≠nua" },
      { plain: "fisica", target: "f√≠sica" },
      { plain: "practica", target: "pr√†ctica" },
      { plain: "elegancia", target: "eleg√†ncia" },
      { plain: "coherencia", target: "coher√®ncia" },
      { plain: "ocurrencia", target: "ocurr√®ncia" },
      { plain: "al¬∑lergia", target: "al¬∑l√®rgia" },
      { plain: "ambulancia", target: "ambul√†ncia" },
      { plain: "angunia", target: "ang√∫nia" },
      { plain: "esdruixola", target: "esdr√∫ixola" },
      // Excepcions amb tancat
      { plain: "ferestega", target: "fer√©stega" },
      { plain: "cervola", target: "c√©rvola" },
      { plain: "esglesia", target: "esgl√©sia" },
      { plain: "escorpora", target: "esc√≥rpora" },
      { plain: "formula", target: "f√≥rmula" },
      { plain: "polvora", target: "p√≥lvora" },
      { plain: "tombola", target: "t√≥mbola" },
      { plain: "tortora", target: "t√≥rtora" }
    ];

    // Elements UI
    const accentExercise = document.getElementById('accent-exercise');
    const accentCheckAllBtn = document.getElementById('accent-check-all-btn');
    const accentResetAllBtn = document.getElementById('accent-reset-all-btn');
    const accentNewExerciseBtn = document.getElementById('accent-new-exercise-btn');
    const accentScoreEl = document.getElementById('accent-score');
    const accentProgressEl = document.getElementById('accent-progress');
    const accentFeedbackEl = document.getElementById('accent-feedback');

    // Estat
    let currentAccentWords = [];
    let userAccent = {}; // index -> string amb lletres actuals
    // accentStatus[index] = { checked, correct, attempts, scored, late }
    let accentStatus = {};

    // ‚úÖ Conjunts de cicle d'accents
    const CYCLE_SETS = {
      'A': ['A','√Ä'],
      'a': ['a','√†'],
      'E': ['E','√à','√â'],
      'e': ['e','√®','√©'],
      'I': ['I','√ç'],
      'i': ['i','√≠'],
      'O': ['O','√í','√ì'],
      'o': ['o','√≤','√≥'],
      'U': ['U','√ö'],
      'u': ['u','√∫']
    };

    function cycleChar(ch) {
      for (const seq of Object.values(CYCLE_SETS)) {
        const idx = seq.indexOf(ch);
        if (idx !== -1) return seq[(idx + 1) % seq.length];
      }
      return ch; // consonants, di√®resi, punt volat, etc.
    }

function generateAccentExercise() {
  currentAccentWords = [...ACCENT_WORDS].sort(() => Math.random() - 0.5).slice(0, 10);
  userAccent = {};
  accentStatus = {};
  accentExercise.innerHTML = '';
  updateAccentScore();
  accentFeedbackEl.style.display = 'none';

  currentAccentWords.forEach((item, index) => {
    const initial = item.plain; // sense diacr√≠tics
    userAccent[index] = initial;
    accentStatus[index] = { checked: false, correct: false, attempts: 0, scored: false, late: false };

    const card = document.createElement('div');
    card.className = 'word-exercise';
    card.id = `accent-card-${index}`;

    card.innerHTML = `
      <div class="word-title">
        <!-- ‚úÖ N√∫mero gran i gris, sense punt final -->
        <span class="card-index">${index + 1}</span>
        <span class="word-status" id="accent-status-${index}">Pendent</span>
      </div>
      <div class="word-container" id="accent-container-${index}" tabindex="0"
           aria-label="Paraula sense accent: ${initial}. Clica les vocals per afegir-ne."></div>
      <div class="word-controls">
        <button class="word-check-btn" data-index="${index}" aria-label="Comprova la paraula">Comprova-ho</button>
      </div>
      <div class="word-feedback" id="accent-feedback-${index}" aria-live="polite"></div>
    `;
    accentExercise.appendChild(card);
    renderAccentWord(index);

    const checkBtn = card.querySelector('.word-check-btn');
    checkBtn.addEventListener('click', () => checkSingleAccent(index));
    const container = document.getElementById(`accent-container-${index}`);
    container.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkSingleAccent(index); });
  });
}


    function renderAccentWord(index) {
      const container = document.getElementById(`accent-container-${index}`);
      container.innerHTML = '';
      const current = userAccent[index];
      for (let i = 0; i < current.length; i++) {
        const ch = current[i];
        if (ch === '¬∑') {
          const dot = document.createElement('span');
          dot.className = 'special-char';
          dot.textContent = '¬∑';
          container.appendChild(dot);
          continue;
        }
        const span = document.createElement('span');
        span.className = 'letter';
        span.textContent = ch;
        span.dataset.index = i;

        // üîÅ Cicle sobre la lletra viva cada clic
        span.addEventListener('click', () => {
          const live = userAccent[index];
          const arr = live.split('');
          arr[i] = cycleChar(arr[i]);
          userAccent[index] = arr.join('');
          renderAccentWord(index);
          if (accentStatus[index].checked) softResetAccentDisplay(index);
        });

        // Accessibilitat: Espai per ciclar, Enter per comprovar
        span.addEventListener('keydown', (e) => {
          if (e.key === ' ') {
            e.preventDefault();
            const live = userAccent[index];
            const arr = live.split('');
            arr[i] = cycleChar(arr[i]);
            userAccent[index] = arr.join('');
            renderAccentWord(index);
            if (accentStatus[index].checked) softResetAccentDisplay(index);
          } else if (e.key === 'Enter') {
            checkSingleAccent(index);
          }
        });

        span.tabIndex = 0;
        container.appendChild(span);
      }
    }

    function softResetAccentDisplay(index) {
      accentStatus[index].checked = false;
      accentStatus[index].correct = false;
      const card = document.getElementById(`accent-card-${index}`);
      const st = document.getElementById(`accent-status-${index}`);
      const fb = document.getElementById(`accent-feedback-${index}`);
      card.className = 'word-exercise';
      st.textContent = 'Pendent';
      st.className = 'word-status';
      fb.textContent = '';
      fb.className = 'word-feedback';
    }

    function updateAccentDisplay(index, state, solution) {
      const card = document.getElementById(`accent-card-${index}`);
      const st = document.getElementById(`accent-status-${index}`);
      const fb = document.getElementById(`accent-feedback-${index}`);
      if (state === 'correct') {
        card.className = 'word-exercise correct';
        st.textContent = 'Correcte';
        st.className = 'word-status correct';
        fb.textContent = '‚úì Correcte!';
        fb.className = 'word-feedback correct';
      } else if (state === 'late') {
        card.className = 'word-exercise late';
        st.textContent = 'Correcte';
        st.className = 'word-status late';
        fb.textContent = '‚úì Correcte (sense punt)';
        fb.className = 'word-feedback late';
      } else {
        card.className = 'word-exercise incorrect';
        st.textContent = 'Incorrecte';
        st.className = 'word-status incorrect';
        fb.textContent = `‚úó Correcte: ${solution}`;
        fb.className = 'word-feedback incorrect';
      }
    }

    function checkSingleAccent(index) {
      const item = currentAccentWords[index];
      accentStatus[index].attempts += 1;

      const isCorrect = userAccent[index] === item.target;

      if (isCorrect && accentStatus[index].attempts === 1) {
        accentStatus[index].scored = true; accentStatus[index].late = false;
      }
      if (isCorrect && accentStatus[index].attempts > 1) {
        accentStatus[index].scored = accentStatus[index].scored || false;
        accentStatus[index].late = !accentStatus[index].scored;
      }

      accentStatus[index].checked = true;
      accentStatus[index].correct = isCorrect;

      if (isCorrect && accentStatus[index].late && !accentStatus[index].scored) {
        updateAccentDisplay(index, 'late', item.target);
      } else {
        updateAccentDisplay(index, isCorrect ? 'correct' : 'incorrect', item.target);
      }
      updateAccentScore();
    }

    function checkAllAccents() {
      currentAccentWords.forEach((_, idx) => { if (!accentStatus[idx].checked) checkSingleAccent(idx); });
      const scoredCount = Object.values(accentStatus).filter(s => s.scored).length;
      if (scoredCount === 10) {
        accentFeedbackEl.textContent = 'Brutal! Has accentuat totes les paraules a la primera.';
      } else {
        accentFeedbackEl.textContent = `Has encertat ${scoredCount} de 10 paraules a la primera. Torna-ho a provar!`;
      }
      accentFeedbackEl.className = 'instructions';
      accentFeedbackEl.style.display = 'block';
    }

    function resetAllAccents() {
      currentAccentWords.forEach((item, idx) => {
        userAccent[idx] = item.plain;
        renderAccentWord(idx);
        accentStatus[idx] = { checked: false, correct: false, attempts: 0, scored: false, late: false };
        softResetAccentDisplay(idx);
      });
      updateAccentScore();
      accentFeedbackEl.style.display = 'none';
    }

    function updateAccentScore() {
      const scored = Object.values(accentStatus).filter(s => s.scored).length;
      const checked = Object.values(accentStatus).filter(s => s.checked).length;
      accentScoreEl.textContent = `Paraules encertades: ${scored}/10 (${checked} comprovades)`;
      accentProgressEl.style.width = `${(scored / 10) * 100}%`;
    }

    accentCheckAllBtn.addEventListener('click', checkAllAccents);
    accentResetAllBtn.addEventListener('click', resetAllAccents);
    accentNewExerciseBtn.addEventListener('click', generateAccentExercise);

    generateAccentExercise();
  </script>
</body>
</html>
