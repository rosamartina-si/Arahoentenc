 <!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Esdr√∫ixoles i Separaci√≥ de S√≠l¬∑labes</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    /* =============================
       Disseny modern i accessible
       ============================= */
    :root {
      --bg: #f6f8fb;
      --surface: #ffffff;
      --text: #243447;
      --muted: #5f6b7a;
      --primary: #2563eb; /* blau indigitible */
      --primary-600: #1d4ed8;
      --success: #22c55e;
      --success-600: #16a34a;
      --danger: #ef4444;
      --danger-600: #dc2626;
      --warning: #f59e0b;
      --info: #06b6d4;
      --ring: 0 0 0 3px rgb(37 99 235 / 22%);
      --radius: 14px;
      --shadow-1: 0 10px 30px rgb(2 6 23 / 8%);
      --shadow-2: 0 4px 12px rgb(2 6 23 / 6%);
      --grid-gap: 22px;
    }

  /* N√∫mero gran i gris per a les targetes de l'accentuaci√≥ */
  .card-index{
    font-weight: 900;
    color: var(--muted);          /* gris mitj√† del teu tema */
    font-size: clamp(1.2rem, 2.2vw, 1.6rem);
    letter-spacing: .01em;
  }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --surface: #0f172a;
        --text: #e2e8f0;
        --muted: #9aa7b8;
        --primary: #60a5fa;
        --primary-600: #93c5fd;
        --success: #34d399;
        --success-600: #10b981;
        --danger: #f87171;
        --danger-600: #ef4444;
        --warning: #fbbf24;
        --info: #22d3ee;
        --ring: 0 0 0 3px rgb(96 165 250 / 24%);
        --shadow-1: 0 10px 30px rgb(0 0 0 / 30%);
        --shadow-2: 0 4px 12px rgb(0 0 0 / 25%);
      }
    }

    * { box-sizing: border-box; }

    html, body { height: 100%; }

    body {
      margin: 0;
      background:
        radial-gradient(1200px 500px at 10% -10%, rgb(37 99 235 / 7%), transparent 60%),
        radial-gradient(900px 450px at 120% 10%, rgb(34 211 238 / 10%), transparent 60%),
        var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 24px;
      display: grid;
      place-items: start center;
    }

    .container {
      width: min(1100px, 100%);
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow-1);
      padding: clamp(18px, 4vw, 32px);
      border: 1px solid rgb(2 6 23 / 6%);
    }

    header.page-header {
      display: grid;
      gap: 6px;
      margin-bottom: 18px;
    }

    .eyebrow {
      font-size: 0.85rem;
      color: var(--muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-weight: 700;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.6rem, 2.8vw, 2.2rem);
      letter-spacing: -0.02em;
    }

    .subtle {
      color: var(--muted);
      font-size: 0.98rem;
    }

    /* ======= Tabs accessibles ======= */
 .tabs {
  display: flex; /* Canvia de grid a flex */
  flex-direction: column; /* Col¬∑loca el tablist a dalt i qualsevol altre contingut a sota */
  margin-top: 14px;
  border-bottom: 1px solid rgb(2 6 23 / 8%);
  position: sticky;
  top: 0;
  background: linear-gradient( to bottom, color-mix(in oklab, var(--surface), transparent 0%), color-mix(in oklab, var(--surface), transparent 20%) );
  z-index: 10;
}

.tablist {
  display: flex;
  gap: 6px;
  flex-wrap: nowrap;
  overflow-x: auto;
  white-space: nowrap;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
  width: 100%; /* Assegura que ocupi tot l'amplada */
}

    .tab {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      border: 0;
      padding: 10px 12px;
      border-radius: 10px 10px 0 0;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: 0.01em;
      cursor: pointer;
      position: relative;
      transition: color .2s ease;
      white-space: nowrap; /* Evita que el text es trenqui */
    }

/* Aquestes regles s√≥n per a la barra de despla√ßament (opcional) */
.tablist::-webkit-scrollbar {
  height: 4px;
}

.tablist::-webkit-scrollbar-track {
  background: color-mix(in oklab, var(--surface), var(--bg) 20%);
}

.tablist::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 2px;
}

    .tab[aria-selected="true"] { color: var(--text); }

    .tab[aria-selected="true"]::after {
      content: "";
      position: absolute;
      left: 0; right: 0; bottom: -1px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--info));
      border-radius: 999px;
    }

    /* ======= Blocs de contingut ======= */
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .section {
      background: color-mix(in oklab, var(--surface), var(--bg) 12%);
      border: 1px solid rgb(2 6 23 / 8%);
      box-shadow: var(--shadow-2);
      border-radius: var(--radius);
      padding: clamp(14px, 2.5vw, 20px);
      margin: 18px 0;
    }

    .section h2 {
      margin: 0 0 10px 0;
      font-size: clamp(1.1rem, 2.2vw, 1.3rem);
      color: var(--primary-600);
      letter-spacing: -0.01em;
    }

    p { line-height: 1.7; margin: 10px 0; }

    ol { margin: 0 0 0 1.15rem; }

    .kbd {
      font: 600 0.88rem ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      padding: 2px 6px; border-radius: 6px;
      background: color-mix(in oklab, var(--surface), var(--bg) 22%);
      border: 1px solid rgb(2 6 23 / 10%);
    }

    /* ======= Targetes/exercicis ======= */
    .exercise-container { margin-top: 10px; }

    .instructions {
      border-left: 4px solid var(--primary);
      background: color-mix(in oklab, var(--primary), transparent 88%);
      padding: 14px 16px;
      border-radius: 10px;
      color: color-mix(in oklab, var(--text), var(--primary) 20%);
    }

    .syllable-exercise {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: var(--grid-gap);
      margin: 18px 0;
    }

    .word-exercise {
      background: var(--surface);
      border-radius: 12px;
      padding: 14px;
      border: 1px solid rgb(2 6 23 / 8%);
      box-shadow: var(--shadow-2);
      transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .word-exercise:focus-within { box-shadow: 0 0 0 3px rgb(37 99 235 / 16%); }
    .word-exercise.correct { border-color: color-mix(in oklab, var(--success), black 10%); background: color-mix(in oklab, var(--success), transparent 92%); }
    .word-exercise.incorrect { border-color: color-mix(in oklab, var(--danger), black 10%); background: color-mix(in oklab, var(--danger), transparent 92%); }

    /* ‚úÖ Estat "correcte" (despr√©s d'haver fallat) */
    .word-exercise.late { 
      border-color: color-mix(in oklab, var(--warning), black 10%);
      background: color-mix(in oklab, var(--warning), transparent 92%);
    }

    .word-title { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .word-title span:first-child { font-weight: 700; letter-spacing: .01em; }

    .word-status {
      font-size: 0.8rem; padding: 4px 10px; border-radius: 999px;
      background: color-mix(in oklab, var(--surface), var(--bg) 18%);
      color: var(--muted); border: 1px solid rgb(2 6 23 / 10%);
    }
    .word-status.correct { background: color-mix(in oklab, var(--success), transparent 86%); color: color-mix(in oklab, var(--success), black 20%); border-color: color-mix(in oklab, var(--success), black 10%); }
    .word-status.incorrect { background: color-mix(in oklab, var(--danger), transparent 86%); color: color-mix(in oklab, var(--danger), black 20%); border-color: color-mix(in oklab, var(--danger), black 10%); }
    /* ‚úÖ Xip d'estat groc per als encerts sense punt */
    .word-status.late {
      background: color-mix(in oklab, var(--warning), transparent 86%);
      color: color-mix(in oklab, var(--warning), black 20%);
      border-color: color-mix(in oklab, var(--warning), black 10%);
    }

    .word-container {
      display: flex; justify-content: center; align-items: center; flex-wrap: wrap;
      gap: 3px; margin: 12px 0; padding: 10px; border-radius: 10px;
      background: color-mix(in oklab, var(--surface), var(--bg) 18%);
      min-height: 58px;
    }

    .letter { font-size: 1.45rem; padding: 8px 3px; border-bottom: 2px solid transparent; border-radius: 6px; cursor: pointer; }
    .letter:hover { background: color-mix(in oklab, var(--surface), var(--bg) 24%); }

    .syllable {
      font-size: 1.45rem;
      padding: 8px 10px;
      margin: 2px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 2px solid transparent;
      background: color-mix(in oklab, var(--surface), var(--bg) 10%);
    }
    
    .syllable:hover {
      background: color-mix(in oklab, var(--surface), var(--bg) 24%);
      transform: translateY(-2px);
    }
    
    .syllable.selected { 
      border-color: var(--primary);
      background: color-mix(in oklab, var(--primary), transparent 88%);
    }
    
    .syllable.correct { 
      border-color: var(--success);
      background: color-mix(in oklab, var(--success), transparent 88%);
    }
    
    .syllable.incorrect { 
      border-color: var(--danger);
      background: color-mix(in oklab, var(--danger), transparent 88%);
    }
    
    .syllable.late { 
      border-color: var(--warning);
      background: color-mix(in oklab, var(--warning), transparent 88%);
    }

    .special-char { font-size: 1.45rem; padding: 8px 2px; color: #8e44ad; font-weight: 800; cursor: pointer; border-radius: 6px; }
    .special-char:hover { background: color-mix(in oklab, var(--surface), var(--bg) 24%); color: var(--primary); }

    .separator { font-size: 1.45rem; padding: 8px 4px; color: var(--primary); font-weight: 800; cursor: pointer; border-radius: 6px; position: relative; }
    .separator:hover { background: color-mix(in oklab, var(--primary), transparent 88%); color: var(--primary); }
    .separator::after { content: none !important; }

    .separator-placeholder { width: 9px; height: 30px; cursor: pointer; border: 2px dashed rgb(2 6 23 / 20%); border-radius: 3px; transition: 120ms ease; }
    .separator-placeholder:hover { background: color-mix(in oklab, var(--primary), transparent 88%); border-color: var(--primary); }

    .word-controls { display: flex; gap: 10px; }

    .word-check-btn {
      flex: 1; background: var(--primary); color: white; border: 0; padding: 10px 14px; border-radius: 999px; font-weight: 800; cursor: pointer;
      box-shadow: 0 2px 8px rgb(37 99 235 / 22%);
      transition: transform .16s ease, background .16s ease, box-shadow .16s ease;
    }
    .word-check-btn:hover { background: var(--primary-600); transform: translateY(-1px); }
    .word-check-btn:active { transform: translateY(0); }

    .word-feedback { 
      margin-top: 10px; 
      font-weight: 700; 
      min-height: 22px; 
      text-align: center; 
      padding: 8px; 
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .word-feedback.correct { 
      color: var(--success-600); 
      background: color-mix(in oklab, var(--success), transparent 88%); 
    }
    .word-feedback.incorrect { 
      color: var(--danger-600); 
      background: color-mix(in oklab, var(--danger), transparent 88%); 
    }
    .word-feedback.late { 
      color: #b45309; 
      background: color-mix(in oklab, var(--warning), transparent 88%);
    }
    
    /* Icones per al feedback */
    .feedback-icon {
      font-size: 1.1em;
    }

    /* ======= Bot√≥ d'√†udio ======= */
    .audio-btn {
      background: color-mix(in oklab, var(--primary), transparent 90%);
      border: 2px solid var(--primary);
      color: var(--primary);
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      margin-bottom: 12px;
      width: 100%;
      justify-content: center;
    }
    
    .audio-btn:hover {
      background: color-mix(in oklab, var(--primary), transparent 80%);
      transform: translateY(-2px);
    }
    
    .audio-btn:active {
      transform: translateY(0);
    }
    
    .audio-btn.playing {
      background: var(--primary);
      color: white;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(37, 99, 235, 0); }
      100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
    }

    /* ======= Controls generals ======= */
    .controls { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
    .btn { background: var(--primary); color: white; border: 0; padding: 12px 22px; border-radius: 12px; cursor: pointer; font-weight: 800; box-shadow: 0 4px 12px rgb(37 99 235 / 22%); transition: .18s ease; }
    .btn:hover { transform: translateY(-2px); }
    .btn:focus-visible { outline: none; box-shadow: var(--ring); }
    .btn-check { background: var(--success); }
    .btn-check:hover { background: var(--success-600); }
    .btn-reset { background: var(--danger); }
    .btn-reset:hover { background: var(--danger-600); }

    .score { font-weight: 800; text-align: center; margin: 14px 0; }

    .progress-bar { height: 12px; border-radius: 999px; background: color-mix(in oklab, var(--surface), var(--bg) 24%); overflow: hidden; border: 1px solid rgb(2 6 23 / 10%); }
    .progress { height: 100%; width: 0%; background: linear-gradient(90deg, var(--success), var(--info)); transition: width .4s ease; }

    /* ======= Llistes d'exemples i caixes tem√†tiques ======= */
    .accent-examples { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; margin: 12px 0; }
    .accent-group { background: var(--surface); border-radius: 10px; border: 1px solid rgb(2 6 23 / 10%); padding: 10px; }
    .accent-list { display: grid; gap: 8px; }
    .example-word { padding: 6px 10px; border-radius: 8px; background: color-mix(in oklab, var(--surface), var(--bg) 16%); text-align: center; font-weight: 600; }

    .rule-box, .important-box, .accent-box, .exception-box, .mnemonic-box { border-radius: 12px; padding: 16px; margin: 16px 0; }
    .rule-box { border-left: 6px solid var(--primary); background: color-mix(in oklab, var(--primary), transparent 90%); }
    .important-box { border-left: 6px solid var(--warning); background: color-mix(in oklab, var(--warning), transparent 90%); }
    .accent-box { border-left: 6px solid var(--info); background: color-mix(in oklab, var(--info), transparent 92%); }
    .exception-box { border-left: 6px solid #e67e22; background: color-mix(in oklab, #e67e22, transparent 90%); }

    .special-cases { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 14px; }
    .case-group { background: var(--surface); border-radius: 12px; border: 1px solid rgb(2 6 23 / 10%); padding: 12px; }
    .case-title { font-weight: 800; color: var(--primary-600); margin-bottom: 8px; text-align: center; }

    .open-accent { color: #16a34a; font-weight: 800; }
    .closed-accent { color: #b45309; font-weight: 800; }
    .special-case { color: #8e44ad; font-weight: 800; }

    .examples-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; }

    .mnemonic-box .mnemonic-title { color: #8e44ad; font-weight: 900; display: flex; align-items: center; gap: 8px; }
    .mnemonic-text { font-style: italic; background: var(--surface); border: 1px dashed #8e44ad; padding: 14px; border-radius: 10px; text-align: center; }
    .highlight-word { background: #e8d4f5; padding: 2px 6px; border-radius: 6px; font-weight: 900; color: #6d28d9; }
    .mnemonic-image { text-align: center; margin: 12px 0; }
    .mnemonic-image img { max-width: 100%; border-radius: 10px; border: 3px solid #e8d4f5; box-shadow: var(--shadow-2); }
    .image-caption { color: var(--muted); font-size: .9rem; text-align: center; }

    /* ======= Mostra grans/petites per a accents ======= */
    .char-board { display: grid; gap: 6px; margin: 8px 0 4px; }
    .char-row { display: flex; gap: 14px; align-items: baseline; justify-content: center; flex-wrap: wrap; }
    .char-large { 
      font-size: clamp(10rem, 35vw, 40rem); 
      line-height: .85;
    }

    .char-tiny { 
      font-size: clamp(0.35rem, 0.9vw, 0.4rem); 
      line-height: 1.1;
    }

    /* ======= Puntets per indicar s√≠l¬∑labes ======= */
    .dots-container {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 12px 0;
      flex-wrap: wrap;
    }
    
    .dot {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: color-mix(in oklab, var(--surface), var(--bg) 30%);
      border: 2px solid color-mix(in oklab, var(--text), transparent 60%);
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .dot:hover {
      background: color-mix(in oklab, var(--primary), transparent 80%);
      border-color: var(--primary);
      transform: scale(1.1);
    }
    
    .dot.selected {
      background: var(--primary);
      border-color: var(--primary);
      transform: scale(1.1);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--primary), transparent 70%);
    }
    
    .dot.correct {
      background: var(--success);
      border-color: var(--success);
      transform: scale(1.1);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--success), transparent 70%);
    }
    
    .dot.incorrect {
      background: var(--danger);
      border-color: var(--danger);
      transform: scale(1.1);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--danger), transparent 70%);
    }
    
    .dot.late {
      background: var(--warning);
      border-color: var(--warning);
      transform: scale(1.1);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--warning), transparent 70%);
    }

    /* ======= Estils per a frases en context amb accentuaci√≥ directa ======= */
    .context-phrase {
      background: var(--surface);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgb(2 6 23 / 8%);
      box-shadow: var(--shadow-2);
      margin-bottom: 20px;
    }

    /* Frases en context - ID√àNTIC a "Accentuaci√≥ d'esdr√∫ixoles" */
    /* Frases en context - Text m√©s natural sense espais entre lletres */
    .phrase-content {
      display: block; /* Canvia de flex a block */
      margin: 12px 0; 
      padding: 16px 20px; 
      border-radius: 10px;
      background: color-mix(in oklab, var(--surface), var(--bg) 12%);
      border: 1px solid rgb(2 6 23 / 10%);
      font-size: 1.3rem;
      line-height: 1.6;
      text-align: left; /* Text a l'esquerra, no centrat */
      word-wrap: break-word;
      white-space: normal;
      cursor: text;
      letter-spacing: -0.01em;
      word-spacing: 0.2em;
      min-height: auto; /* Elimina altura m√≠nima fixa */
    }
    
    /* Eliminar espais entre lletres (marges negatius) */
    .phrase-content .letter {
      margin: 0 -0.5px; /* Aix√≤ elimina l'espai entre lletres */
      display: inline; /* Mantenir inline, no inline-block */
    }
    
    /* Espais entre paraules */
    .phrase-content .space {
      margin: 0 0.2em; /* Espai normal entre paraules */
      padding: 0;
      cursor: default;
      background: transparent !important;
    }

    /* ======= Responsive ======= */
    @media (max-width: 720px) {
      body { padding: 16px; }
      .tablist { overflow-x: auto; }
      .word-container { min-height: 52px; }
      .dot { width: 25px; height: 25px; }
      .phrase-content { 
        font-size: 1.15rem; 
        padding: 14px 16px; 
        line-height: 1.5;
      }
    }

    @media (max-width: 480px) {
      .phrase-content { 
        font-size: 1.05rem; 
        padding: 12px 14px; 
        line-height: 1.4;
      }
    }
  </style>
</head>
<body>
  <main class="container">
    <header class="page-header">
      <span class="eyebrow">Pr√†ctica guiada</span>
      <h1>Esdr√∫ixoles i separaci√≥ de s√≠l¬∑labes</h1>
    </header>

    <!-- Tabs -->
<nav class="tabs" role="tablist" aria-label="Seccions">
  <div class="tablist">
    <button class="tab" role="tab" id="tab-teoria" aria-controls="teoria" aria-selected="true" data-tab="teoria">Esdr√∫ixoles</button>
    <button class="tab" role="tab" id="tab-separacio" aria-controls="separacio-sil-labes" aria-selected="false" data-tab="separacio-sil-labes">Separaci√≥ de s√≠l¬∑labes</button>
    <button class="tab" role="tab" id="tab-tonica" aria-controls="sil-laba-tonica" aria-selected="false" data-tab="sil-laba-tonica">S√≠l¬∑laba t√≤nica</button>
    <button class="tab" role="tab" id="tab-accent" aria-controls="accentuacio-esdruixoles" aria-selected="false" data-tab="accentuacio-esdruixoles">Accentuaci√≥ d'esdr√∫ixoles</button>
    <button class="tab" role="tab" id="tab-context" aria-controls="context-frases" aria-selected="false" data-tab="context-frases">Paraules en Context</button>
  </div>
</nav>

    <!-- Contingut: Teoria (CONTINGUT ORIGINAL COMPLET) -->
    <section id="teoria" class="tab-content active" role="tabpanel" aria-labelledby="tab-teoria">
      <div class="section">
        <h2>Qu√® √©s una paraula esdr√∫ixola?</h2>
        <p>Una paraula <strong>esdr√∫ixola</strong> t√© l'accent t√≤nic (la s√≠l¬∑laba que es pronuncia amb m√©s for√ßa) a la  s√≠l¬∑laba <strong>antepen√∫ltima</strong> (la tercera comen√ßant pel final).</p>
        <p class="instructions"><strong>Exemples:</strong> <em><strong>m√∫</strong>-si-ca</em>, <em>es-<strong>dr√∫i</strong>-xo-la</em>, <em><strong>c√†</strong>-me-ra</em>.</p>
      </div>

      <div class="section">
        <h2>Com identificar una esdr√∫ixola</h2>
        <ol>
          <li>Separa la paraula en s√≠l¬∑labes.</li>
          <li>Compta les s√≠l¬∑labes des del final.</li>
          <li>Si l'accent t√≤nic √©s a la tercera s√≠l¬∑laba des del final, √©s esdr√∫ixola.</li>
        </ol>
        <p class="instructions">Exemple: <strong>esdr√∫ixola</strong> ‚Üí es-<strong>dr√∫i</strong>-xo-la (accent a la s√≠l¬∑laba <strong>antepen√∫ltima</strong>).</p>
      </div>

      <div class="important-box section">
        <h2>Recorda quan les vocals se separen:</h2>
        <div class="special-cases">
          <div class="case-group">
            <div class="case-title">I + a/e/o</div>
            <p>La <span class="special-case">i</span> seguida de <strong>a</strong>, <strong>e</strong> o <strong>o</strong> no forma diftong; s√≥n s√≠l¬∑labes diferents:</p>
            <div class="examples-grid">
              <div class="example-word">fa-m<span class="special-case">√≠</span>-li-a</div>
              <div class="example-word">gr<span class="special-case">√†</span>-ci-es</div>
              <div class="example-word">su-per-f<span class="special-case">√≠</span>-ci-e</div>
              <div class="example-word">c<span class="special-case">√†</span>-ri-es</div>
              <div class="example-word">N<span class="special-case">√∫</span>-ri-a</div>
              <div class="example-word">r<span class="special-case">√†</span>-di-o</div>
            </div>
          </div>
          <div class="case-group">
            <div class="case-title">U + a/e/o</div>
            <p>Quan la <span class="special-case">u</span> va seguida de <strong>a</strong>, <strong>e</strong> o <strong>o</strong>, tampoc forma diftong:</p>
            <div class="examples-grid">
              <div class="example-word">con-t<span class="special-case">√≠</span>-nu-a</div>
              <div class="example-word">t<span class="special-case">√®</span>-nu-e</div>
            </div>
          </div>
        </div>
        <div class="special-cases">
          <div class="case-group">
            <div class="case-title">Atenci√≥!</div>
            <p>Les vocals de les combinacions <strong>gua / g√ºe / g√ºi / guo</strong> i <strong>qua / q√ºe / q√ºi / quo</strong> formen diftong i, per tant, no se separen:</p>
            <div class="examples-grid">
              <div class="example-word">am-bi-g<span class="special-case">√ºi</span>-tat</div>
              <div class="example-word">pas-q<span class="special-case">ua</span></div>
              <div class="example-word">ai-g<span class="special-case">√ºe</span>s</div>
            </div>
            <p>Les vocals de <strong>gue, gui, que, qui</strong> (la u √©s muda) tampoc se separen:</p>
            <div class="examples-grid">
              <div class="example-word">al-g<span class="special-case">ue</span>s</div>
              <div class="example-word">gro-g<span class="special-case">ui</span></div>
              <div class="example-word">ta-q<span class="special-case">ue</span>s</div>
              <div class="example-word">br√≤-q<span class="special-case">ui</span>l</div>
              <div class="example-word">ob-se-q<span class="special-case">ui</span></div>
            </div>
          </div>
        </div>
      </div>

      <div class="rule-box section">
        <h2>Regla fonamental</h2>
        <p><strong>TOTS els mots esdr√∫ixols porten accent.</strong></p>
      </div>

      <div class="accent-box section">
        <h2>Accents de les esdr√∫ixoles</h2>
        <p>Gaireb√© sempre l'accent de la <strong>e</strong> i de la <strong>o</strong> √©s <span class="open-accent">obert</span>. La proporci√≥ √©s aquesta:</p>

        <!-- üîµ Mostra de car√†cters: grans (√®, √≤) i petits (√©, √≥) -->
        <div class="char-board" aria-label="Mostra d'accents oberts i tancats">
          <div class="char-row" aria-label="Accents oberts en mida m√†xima">
            <span class="char-large open-accent" aria-label="E oberta gran">√®</span>
            <span class="char-large open-accent" aria-label="O oberta gran">√≤</span>
          </div>
          <div class="char-row" aria-label="Accents tancats en mida m√≠nima llegible">
            <span class="char-tiny closed-accent" aria-label="E tancada petita">√©</span>
            <span class="char-tiny closed-accent" aria-label="O tancada petita">√≥</span>
          </div>
        </div>
        <!-- üîµ Fi de la mostra -->

        <div class="accent-examples">
          <div class="accent-group">
            <h3>E oberta (√®)</h3>
            <div class="accent-list">
              <div class="example-word"><span class="open-accent">√®</span>-po-ca</div>
              <div class="example-word">in-tel-li-g<span class="open-accent">√®</span>n-ci-a</div>
              <div class="example-word"><span class="open-accent">√®</span>t-ni-a</div>
              <div class="example-word">s<span class="open-accent">√®</span>-ri-e</div>
              <div class="example-word">t<span class="open-accent">√®</span>-nu-e</div>
              <div class="example-word">es-t<span class="open-accent">√®</span>-re-o</div>
            </div>
          </div>
          <div class="accent-group">
            <h3>O oberta (√≤)</h3>
            <div class="accent-list">
              <div class="example-word">c<span class="open-accent">√≤</span>-le-ra</div>
              <div class="example-word"><span class="open-accent">√≤</span>-li-ba</div>
              <div class="example-word">me-m<span class="open-accent">√≤</span>-ri-a</div>
              <div class="example-word">qui-l<span class="open-accent">√≤</span>-me-tre</div>
              <div class="example-word">hi-p<span class="open-accent">√≤</span>-te-si</div>
              <div class="example-word">s<span class="open-accent">√≤</span>-mi-nes</div>
            </div>
          </div>
        </div>
      </div>

      <div class="exception-box section">
        <h2>Excepcions amb accent tancat</h2>
        <p>Hi ha poques paraules esdr√∫ixoles amb <span class="closed-accent">√©</span> o  <span class="closed-accent">√≥</span>:</p>
        <div class="accent-examples">
          <div class="accent-group">
            <h3>E tancada (√©)</h3>
            <div class="accent-list">
              <div class="example-word">fe-r<span class="closed-accent">√©</span>s-te-ga</div>
              <div class="example-word">c<span class="closed-accent">√©</span>r-vo-la</div>
              <div class="example-word">es-gl<span class="closed-accent">√©</span>-si-a</div>
            </div>
          </div>
          <div class="accent-group">
            <h3>O tancada (√≥)</h3>
            <div class="accent-list">
              <div class="example-word">es-c<span class="closed-accent">√≥</span>r-po-ra</div>
              <div class="example-word">f<span class="closed-accent">√≥</span>r-mu-la</div>
              <div class="example-word">p<span class="closed-accent">√≥</span>l-vo-ra</div>
              <div class="example-word">t<span class="closed-accent">√≥</span>m-bo-la</div>
              <div class="example-word">t<span class="closed-accent">√≥</span>r-to-ra</div>
            </div>
          </div>
        </div>
        <div class="mnemonic-box">
          <div class="mnemonic-title">üí° Truc per recordar les excepcions</div>
          <div class="mnemonic-image">
            <img src="excepcions_accentuacio_esdruixoles.png" alt="Frase mnemot√®cnica d'excepcions d'accent tancat en esdr√∫ixoles" />
            <div class="image-caption">Imatge mnemot√®cnica </div>
          </div>
          <p class="mnemonic-text">"A l'<span class="highlight-word">esgl√©sia</span> una <span class="highlight-word">c√©rvola</span> <span class="highlight-word">fer√©stega</span>, una <span class="highlight-word">t√≥rtora</span> i una <span class="highlight-word">esc√≥rpora</span> preparaven una <span class="highlight-word">f√≥rmula</span> amb la <span class="highlight-word">p√≥lvora</span> que van guanyar a la <span class="highlight-word">t√≥mbola</span>."</p>
          <p class="subtle" style="text-align:center">Memoritza la frase (i la imatge) per retenir les excepcions amb accent tancat.</p>
        </div>
      </div>
    </section>

    <!-- Contingut: Exercici de separaci√≥ -->
    <section id="separacio-sil-labes" class="tab-content" role="tabpanel" aria-labelledby="tab-separacio">
      <div class="section exercise-container">
        <h2>Exercici de separaci√≥ de s√≠l¬∑labes ¬∑ 10 paraules</h2>
        <div class="instructions">
          <p><strong>Com funciona?</strong></p>
          <p>Fes clic entre les lletres per col¬∑locar un separador. Torna a fer clic per treure'l. Pots comprovar cada paraula amb el bot√≥ "Comprova-ho" o prement "Enter".</p>
        </div>

        <div class="syllable-exercise" id="syllable-exercise"></div>

        <div class="progress-bar"><div class="progress" id="progress"></div></div>
        <p class="score" id="score">Paraules encertades: 0/10 (0 comprovades)</p>

        <div class="controls">
          <button class="btn btn-check" id="check-all-btn" aria-live="polite">Comprova-ho tot</button>
          <button class="btn btn-reset" id="reset-all-btn">Reinicia</button>
          <button class="btn" id="new-exercise-btn">Nou exercici</button>
        </div>

        <div class="instructions" id="feedback" style="display:none"></div>
      </div>
    </section>

    <!-- SECCI√ì: Accentuaci√≥ d'esdr√∫ixoles -->
    <section id="accentuacio-esdruixoles" class="tab-content" role="tabpanel" aria-labelledby="tab-accent">
      <div class="section exercise-container">
        <h2>Exercici d'accentuaci√≥ d'esdr√∫ixoles ¬∑ 10 paraules</h2>
        <div class="instructions">
          <p><strong>Objectiu:</strong> Afegeix l'accent correcte a la s√≠l¬∑laba antepen√∫ltima.</p>
          <p><strong>Com?</strong> Clica les vocals per <span class="highlight-word">alternar</span> l'accent:
            <span class="kbd">a‚Üî√†</span>,
            <span class="kbd">e‚Üî√®‚Üî√©</span>,
            <span class="kbd">i‚Üî√≠</span>,
            <span class="kbd">o‚Üî√≤‚Üî√≥</span>,
            <span class="kbd">u‚Üî√∫</span>. Prem <span class="kbd">Enter</span> per comprovar la targeta.
          </p>
        </div>

        <div class="syllable-exercise" id="accent-exercise"></div>

        <div class="progress-bar"><div class="progress" id="accent-progress"></div></div>
        <p class="score" id="accent-score">Paraules encertades: 0/10 (0 comprovades)</p>

        <div class="controls">
          <button class="btn btn-check" id="accent-check-all-btn">Comprova-ho tot</button>
          <button class="btn btn-reset" id="accent-reset-all-btn">Reinicia</button>
          <button class="btn" id="accent-new-exercise-btn">Nou exercici</button>
        </div>

        <div class="instructions" id="accent-feedback" style="display:none"></div>
      </div>
    </section>

    <!-- SECCI√ì: S√≠l¬∑laba t√≤nica -->
    <section id="sil-laba-tonica" class="tab-content" role="tabpanel" aria-labelledby="tab-tonica">
      <div class="section exercise-container">
        <h2>Exercici de s√≠l¬∑laba t√≤nica ¬∑ 10 paraules</h2>
        <div class="instructions">
          <p><strong>Objectiu:</strong> Escolta la paraula i identifica la s√≠l¬∑laba t√≤nica (la que porta l'accent).</p>
          <p><strong>Com?</strong> Prem el bot√≥ d'√†udio per escoltar la paraula. Despr√©s, clica sobre el punt que correspon a la s√≠l¬∑laba t√≤nica. Els colors indiquen:
            <span style="color: var(--success)">Verd</span> = correcte a la primera,
            <span style="color: var(--danger)">Vermell</span> = incorrecte,
            <span style="color: var(--warning)">Groc</span> = correcte despr√©s d'haver fallat (sense punt).
          </p>
          <p>Prem <span class="kbd">Enter</span> per comprovar la targeta quan hagis seleccionat una s√≠l¬∑laba.</p>
        </div>

        <div class="syllable-exercise" id="tonica-exercise"></div>

        <div class="progress-bar"><div class="progress" id="tonica-progress"></div></div>
        <p class="score" id="tonica-score">Paraules encertades: 0/10 (0 comprovades)</p>

        <div class="controls">
          <button class="btn btn-check" id="tonica-check-all-btn">Comprova-ho tot</button>
          <button class="btn btn-reset" id="tonica-reset-all-btn">Reinicia</button>
          <button class="btn" id="tonica-new-exercise-btn">Nou exercici</button>
        </div>

        <div class="instructions" id="tonica-feedback" style="display:none"></div>
      </div>
    </section>

    <!-- NOVA SECCI√ì: Paraules en Context (amb accentuaci√≥ directa a la frase) -->
    <section id="context-frases" class="tab-content" role="tabpanel" aria-labelledby="tab-context">
      <div class="section exercise-container">
        <h2>Accentuaci√≥ en context ¬∑ 10 frases</h2>
        <div class="instructions">
          <p><strong>Objectiu:</strong> Afegeix tots els accents que faltin a la frase.</p>
          <p><strong>Com?</strong> Llegeix la frase i <strong>clica sobre qualsevol lletra</strong> de qualsevol paraula per afegir o treure accents:
            <span class="kbd">a‚Üî√†</span>,
            <span class="kbd">e‚Üî√®‚Üî√©</span>,
            <span class="kbd">i‚Üî√≠</span>,
            <span class="kbd">o‚Üî√≤‚Üî√≥</span>,
            <span class="kbd">u‚Üî√∫</span>. Prem <span class="kbd">Enter</span> per comprovar.
          </p>
        </div>

        <div class="syllable-exercise" id="context-exercise"></div>

        <div class="progress-bar"><div class="progress" id="context-progress"></div></div>
        <p class="score" id="context-score">Frases encertades: 0/10 (0 comprovades)</p>

        <div class="controls">
          <button class="btn btn-check" id="context-check-all-btn">Comprova-ho tot</button>
          <button class="btn btn-reset" id="context-reset-all-btn">Reinicia</button>
          <button class="btn" id="context-new-exercise-btn">Noves frases</button>
        </div>

        <div class="instructions" id="context-feedback" style="display:none"></div>
      </div>
    </section>
  </main>

  <script>
    /* ===== Tabs accessibles ===== */
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        tabs.forEach(t => { t.setAttribute('aria-selected', 'false'); });
        tab.setAttribute('aria-selected', 'true');
        tabContents.forEach(c => c.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
      });
    });

    /* ===== Sistema de missatges de feedback ===== */
    const feedbackMessages = {
      separation: {
        correct: { icon: '‚úÖ', text: 'Molt b√©!' },
        late: { icon: '‚úÖ', text: 'Ara s√≠!' },
        incorrect: { icon: '‚ùå', text: 'Prova de nou' }
      },
      accent: {
        correct: { icon: '‚úÖ', text: 'Molt b√©!' },
        late: { icon: '‚úÖ', text: 'Ara s√≠!' },
        incorrect: { icon: '‚ùå', text: 'Prova de nou' }
      },
      tonic: {
        correct: { icon: '‚úÖ', text: 'Molt b√©!' },
        late: { icon: '‚úÖ', text: 'Ara s√≠!' },
        incorrect: { icon: '‚ùå', text: 'Prova de nou' }
      },
      context: {
        correct: { icon: '‚úÖ', text: 'Perfecte! Tots els accents s√≥n correctes.' },
        late: { icon: '‚úÖ', text: 'Ara s√≠! Tots els accents s√≥n correctes.' },
        incorrect: { icon: '‚ùå', text: 'Alguns accents no s√≥n correctes.' }
      }
    };

    /* ===== Exercici de s√≠l¬∑labes (ORIGINAL) ===== */
    const words = [
      { word: "Am√®lia", syllables: ["A", "m√®", "li", "a"] },
      { word: "matem√†tiques", syllables: ["ma", "te", "m√†", "ti", "ques"] },
      { word: "m√∫sica", syllables: ["m√∫", "si", "ca"] },
      { word: "esdr√∫ixola", syllables: ["es", "dr√∫i", "xo", "la"] },
      { word: "c√†mera", syllables: ["c√†", "me", "ra"] },
      { word: "p√†gina", syllables: ["p√†", "gi", "na"] },
      { word: "hip√≤tesi", syllables: ["hi", "p√≤", "te", "si"] },
      { word: "fam√≠lia", syllables: ["fa", "m√≠", "li", "a"] },
      { word: "televisi√≥", syllables: ["te", "le", "vi", "si", "√≥"] },
      { word: "electricitat", syllables: ["e", "lec", "tri", "ci", "tat"] },
      { word: "universitat", syllables: ["u", "ni", "ver", "si", "tat"] },
      { word: "important", syllables: ["im", "por", "tant"] },
      { word: "dificultat", syllables: ["di", "fi", "cul", "tat"] },
      { word: "paraula", syllables: ["pa", "rau", "la"] },
      { word: "s√≠l¬∑laba", syllables: ["s√≠l", "la", "ba"] },
      { word: "exemple", syllables: ["e", "xem", "ple"] },
      { word: "pr√†ctica", syllables: ["pr√†c", "ti", "ca"] },
      { word: "ci√®ncia", syllables: ["ci", "√®n", "ci", "a"] },
      { word: "paci√®ncia", syllables: ["pa", "ci", "√®n", "ci", "a"] },
      { word: "cl√≠nica", syllables: ["cl√≠", "ni", "ca"] },
      { word: "cont√≠nua", syllables: ["con", "t√≠", "nu", "a"] },
      { word: "plaques", syllables: ["pla", "ques"] },
      { word: "paraig√ºes", syllables: ["pa", "rai", "g√ºes"] },
      { word: "f√≠sica", syllables: ["f√≠", "si", "ca"] },
      { word: "ciberespai", syllables: ["ci", "ber", "es", "pai"] },
      { word: "consci√®ncia", syllables: ["cons", "ci", "√®n", "ci", "a"] },
      { word: "o√Øda", syllables: ["o", "√Ø", "da"] },
      { word: "decisi√≥", syllables: ["de", "ci", "si", "√≥"] },
      { word: "equaci√≥", syllables: ["e", "qua", "ci", "√≥"] },
      { word: "solucions", syllables: ["so", "lu", "ci", "ons"] },
      { word: "eleg√†ncia", syllables: ["e", "le", "g√†n", "ci", "a"] },
      { word: "coher√®ncia", syllables: ["co", "he", "r√®n", "ci", "a"] },
      { word: "ocurr√®ncia", syllables: ["o", "cur", "r√®n", "ci", "a"] },
      { word: "Maria", syllables: ["Ma", "ri", "a"] },
      { word: "abund√†ncia", syllables: ["a", "bun", "d√†n", "ci", "a"] },
      { word: "ac√†cia", syllables: ["a", "c√†", "ci", "a"] },
      { word: "acrob√†cia", syllables: ["a", "cro", "b√†", "ci", "a"] },
      { word: "l√≠nia", syllables: ["l√≠", "ni", "a"] },
      { word: "al√ß√†ria", syllables: ["al", "√ß√†", "ri", "a"] },
      { word: "alegria", syllables: ["a", "le", "gri", "a"] },
      { word: "al¬∑l√®rgia", syllables: ["al", "l√®r", "gi", "a"] },
      { word: "ambul√†ncia", syllables: ["am", "bu", "l√†n", "ci", "a"] },
      { word: "ang√∫nia", syllables: ["an", "g√∫", "ni", "a"] },
      { word: "hist√≤ria", syllables: ["his", "t√≤", "ri", "a"] },
      { word: "vict√≤ria", syllables: ["vic", "t√≤", "ri", "a"] },
      { word: "est√†tua", syllables: ["es", "t√†", "tu", "a"] },
      { word: "inf√†ncia", syllables: ["in", "f√†n", "ci", "a"] },
      { word: "quil√≤metre", syllables: ["qui", "l√≤", "me", "tre"] },
      { word: "ind√∫stria", syllables: ["in", "d√∫s", "tri", "a"] },
      { word: "col√≤nia", syllables: ["co", "l√≤", "ni", "a"] },
      { word: "solit√†ria", syllables: ["so", "li", "t√†", "ri", "a"] },
      { word: "mem√≤ries", syllables: ["me", "m√≤", "ri", "es"] },
      { word: "g√†bies", syllables: ["g√†", "bi", "es"] },
      { word: "mis√®ria", syllables: ["mi", "s√®", "ri", "a"] },
      { word: "mat√®ria", syllables: ["ma", "t√®", "ri", "a"] },
      { word: "gal√†xies", syllables: ["ga", "l√†", "xi", "es"] },
      { word: "farm√†cia", syllables: ["far", "m√†", "ci", "a"] },
      { word: "assist√®ncia", syllables: ["as", "sis", "t√®n", "ci", "a"] },
      { word: "√†rea", syllables: ["√†", "re", "a"] },
      { word: "f√∫csia", syllables: ["f√∫c", "si", "a"] },
      { word: "just√≠cia", syllables: ["jus", "t√≠", "ci", "a"] },
      { word: "m√∫tua", syllables: ["m√∫", "tu", "a"] },
      { word: "gu√†rdia", syllables: ["gu√†r", "di", "a"] },
      { word: "r√†dio", syllables: ["r√†", "di", "o"] },
      { word: "an√®cdota", syllables: ["a", "n√®c", "do", "ta"] },
      { word: "d√®cimes", syllables: ["d√®", "ci", "mes"] },
      { word: "m√®tode", syllables: ["m√®", "to", "de"] },
      { word: "etc√®tera", syllables: ["et", "c√®", "te", "ra"] },
      { word: "t√®nue", syllables: ["t√®", "nu", "e"] },
      { word: "com√®dia", syllables: ["co", "m√®", "di", "a"] },
      { word: "c√≤mode", syllables: ["c√≤", "mo", "de"] },
      { word: "√≤pera", syllables: ["√≤", "pe", "ra"] },
      { word: "c√≤pia", syllables: ["c√≤", "pi", "a"] },
      { word: "mem√≤ria", syllables: ["me", "m√≤", "ri", "a"] }
    ];
    
    const syllableExercise = document.getElementById('syllable-exercise');
    const checkAllBtn = document.getElementById('check-all-btn');
    const resetAllBtn = document.getElementById('reset-all-btn');
    const newExerciseBtn = document.getElementById('new-exercise-btn');
    const scoreElement = document.getElementById('score');
    const progressBar = document.getElementById('progress');
    const feedback = document.getElementById('feedback');

    let currentExerciseWords = [];
    let userSeparators = {};
    let wordStatus = {};

    function generateNewExercise() {
      currentExerciseWords = [...words].sort(() => Math.random() - 0.5).slice(0, 10);
      userSeparators = {};
      wordStatus = {};
      syllableExercise.innerHTML = '';
      updateScore();
      feedback.style.display = 'none';

      currentExerciseWords.forEach((wordObj, index) => {
        userSeparators[index] = [];
        wordStatus[index] = { checked: false, correct: false, attempts: 0, scored: false, late: false };

        const wordExercise = document.createElement('div');
        wordExercise.className = 'word-exercise';
        wordExercise.id = `word-exercise-${index}`;
        wordExercise.innerHTML = `
          <div class="word-title">
            <span>${index + 1}. ${wordObj.word}</span>
            <span class="word-status" id="word-status-${index}">Pendent</span>
          </div>
          <div class="word-container" id="word-container-${index}" tabindex="0" aria-label="Paraula ${wordObj.word}. Fes clic per afegir separadors."></div>
          <div class="word-controls">
            <button class="word-check-btn" data-index="${index}" aria-label="Comprova la paraula ${wordObj.word}">Comprova-ho</button>
          </div>
          <div class="word-feedback" id="feedback-${index}" aria-live="polite"></div>
        `;
        syllableExercise.appendChild(wordExercise);

        renderWord(index);

        const checkBtn = wordExercise.querySelector('.word-check-btn');
        checkBtn.addEventListener('click', () => checkSingleAnswer(index));
        const wordContainer = document.getElementById(`word-container-${index}`);
        wordContainer.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkSingleAnswer(index); });
      });
    }

    function renderWord(index) {
      const wordContainer = document.getElementById(`word-container-${index}`);
      const wordObj = currentExerciseWords[index];
      wordContainer.innerHTML = '';

      if (wordObj.word.includes('¬∑')) {
        renderWordWithSpecialChars(index, wordObj);
      } else {
        renderNormalWord(index, wordObj);
      }

      userSeparators[index].forEach((position) => applySeparator(index, position));
    }

    function renderNormalWord(index, wordObj) {
      const wordContainer = document.getElementById(`word-container-${index}`);
      const letters = wordObj.word.split('');
      letters.forEach((letter, letterIndex) => {
        const letterElement = document.createElement('span');
        letterElement.className = 'letter';
        letterElement.textContent = letter;
        letterElement.dataset.index = letterIndex;
        wordContainer.appendChild(letterElement);
        if (letterIndex < letters.length - 1) {
          const separatorPlaceholder = document.createElement('div');
          separatorPlaceholder.className = 'separator-placeholder';
          separatorPlaceholder.dataset.position = letterIndex;
          separatorPlaceholder.dataset.wordIndex = index;
          separatorPlaceholder.addEventListener('click', addSeparator);
          wordContainer.appendChild(separatorPlaceholder);
        }
      });
    }

    function renderWordWithSpecialChars(index, wordObj) {
      const wordContainer = document.getElementById(`word-container-${index}`);
      const word = wordObj.word;
      let currentIndex = 0;
      for (let i = 0; i < word.length; i++) {
        const char = word[i];
        if (char === '¬∑') {
          const specialChar = document.createElement('span');
          specialChar.className = 'special-char';
          specialChar.textContent = char;
          specialChar.dataset.position = currentIndex;
          specialChar.dataset.wordIndex = index;
          specialChar.dataset.isDot = 'true';
          specialChar.addEventListener('click', convertDotToSeparator);
          wordContainer.appendChild(specialChar);
          currentIndex++;
        } else {
          const letterElement = document.createElement('span');
          letterElement.className = 'letter';
          letterElement.textContent = char;
          letterElement.dataset.index = currentIndex;
          wordContainer.appendChild(letterElement);
          const nextChar = word[i + 1];
          const prevChar = word[i - 1];
          const isBetweenGeminades = (prevChar === '¬∑' || nextChar === '¬∑');
          if (i < word.length - 1 && !isBetweenGeminades) {
            const separatorPlaceholder = document.createElement('div');
            separatorPlaceholder.className = 'separator-placeholder';
            separatorPlaceholder.dataset.position = currentIndex;
            separatorPlaceholder.dataset.wordIndex = index;
            separatorPlaceholder.addEventListener('click', addSeparator);
            wordContainer.appendChild(separatorPlaceholder);
          }
          currentIndex++;
        }
      }
    }

    function convertDotToSeparator(event) {
      const position = parseInt(event.target.dataset.position);
      const wordIndex = parseInt(event.target.dataset.wordIndex);
      if (!userSeparators[wordIndex].includes(position)) {
        userSeparators[wordIndex].push(position);
        userSeparators[wordIndex].sort((a, b) => a - b);
        applySeparator(wordIndex, position);
        if (wordStatus[wordIndex].checked) softResetWordDisplay(wordIndex);
      }
    }

    function addSeparator(event) {
      const position = parseInt(event.target.dataset.position);
      const wordIndex = parseInt(event.target.dataset.wordIndex);
      if (!userSeparators[wordIndex].includes(position)) {
        userSeparators[wordIndex].push(position);
        userSeparators[wordIndex].sort((a, b) => a - b);
        applySeparator(wordIndex, position);
        if (wordStatus[wordIndex].checked) softResetWordDisplay(wordIndex);
      }
    }

    function removeSeparator(event) {
      const position = parseInt(event.target.dataset.position);
      const wordIndex = parseInt(event.target.dataset.wordIndex);
      userSeparators[wordIndex] = userSeparators[wordIndex].filter((pos) => pos !== position);
      renderWord(wordIndex);
      if (wordStatus[wordIndex].checked) softResetWordDisplay(wordIndex);
    }

    function applySeparator(wordIndex, position) {
      const wordContainer = document.getElementById(`word-container-${wordIndex}`);
      const elements = wordContainer.children;
      for (let i = 0; i < elements.length; i++) {
        const element = elements[i];
        const isPlaceholder = element.classList.contains('separator-placeholder');
        const isDot = element.classList.contains('special-char');
        if ((isPlaceholder || isDot) && parseInt(element.dataset.position) === position) {
          element.innerHTML = '-';
          element.className = 'separator';
          element.dataset.position = position;
          element.dataset.wordIndex = wordIndex;
          element.title = "Torna a fer clic per treure'l";
          if (isPlaceholder) element.removeEventListener('click', addSeparator);
          if (isDot) element.removeEventListener('click', convertDotToSeparator);
          element.addEventListener('click', removeSeparator);
        }
      }
    }

    function buildUserSyllables(wordObj, sepPositions) {
      const userSyllables = [];
      let currentSyllable = '';
      const cleanWord = wordObj.word.replace('¬∑', '');
      const letters = cleanWord.split('');
      let adjustedSeparators = [...sepPositions];
      if (wordObj.word.includes('¬∑')) {
        const dotPosition = wordObj.word.indexOf('¬∑');
        adjustedSeparators = sepPositions.map((pos) => (pos >= dotPosition ? pos - 1 : pos));
      }
      letters.forEach((letter, letterIndex) => {
        currentSyllable += letter;
        if (adjustedSeparators.includes(letterIndex)) {
          userSyllables.push(currentSyllable);
          currentSyllable = '';
        }
      });
      if (currentSyllable) userSyllables.push(currentSyllable);
      return userSyllables;
    }

    function checkSingleAnswer(index) {
      const wordObj = currentExerciseWords[index];
      const userSyllables = buildUserSyllables(wordObj, userSeparators[index]);

      wordStatus[index].attempts += 1;

      const isCorrect = JSON.stringify(userSyllables) === JSON.stringify(wordObj.syllables);

      if (isCorrect && wordStatus[index].attempts === 1) {
        wordStatus[index].scored = true;
        wordStatus[index].late = false;
      }

      if (isCorrect && wordStatus[index].attempts > 1) {
        wordStatus[index].scored = wordStatus[index].scored || false;
        wordStatus[index].late = !wordStatus[index].scored;
      }

      wordStatus[index].checked = true;
      wordStatus[index].correct = isCorrect;

      updateWordDisplay(index, isCorrect ? (wordStatus[index].late ? 'late' : 'correct') : 'incorrect', wordObj.syllables.join('-'));
      updateGlobalScore();
    }

    function softResetWordDisplay(index) {
      wordStatus[index].checked = false;
      wordStatus[index].correct = false;
      const wordExercise = document.getElementById(`word-exercise-${index}`);
      const wordStatusElement = document.getElementById(`word-status-${index}`);
      const wordFeedback = document.getElementById(`feedback-${index}`);
      wordExercise.className = 'word-exercise';
      wordStatusElement.textContent = 'Pendent';
      wordStatusElement.className = 'word-status';
      wordFeedback.textContent = '';
      wordFeedback.className = 'word-feedback';
    }

    function updateWordDisplay(index, state, correctAnswer) {
      const wordExercise = document.getElementById(`word-exercise-${index}`);
      const wordStatusElement = document.getElementById(`word-status-${index}`);
      const wordFeedback = document.getElementById(`feedback-${index}`);
      const messages = feedbackMessages.separation[state];

      wordExercise.className = `word-exercise ${state}`;
      wordStatusElement.textContent = state === 'incorrect' ? 'Incorrecte' : 'Correcte';
      wordStatusElement.className = `word-status ${state}`;
      
      // Crear el feedback amb icona i text
      wordFeedback.innerHTML = `
        <span class="feedback-icon">${messages.icon}</span>
        <span>${messages.text}</span>
      `;
      wordFeedback.className = `word-feedback ${state}`;
    }

    function checkAllAnswers() {
      currentExerciseWords.forEach((_, index) => { if (!wordStatus[index].checked) checkSingleAnswer(index); });
      const scoredCount = Object.values(wordStatus).filter((s) => s.scored).length;
      if (scoredCount === 10) {
        feedback.textContent = 'Excel¬∑lent! Has encertat totes les paraules a la primera.';
        feedback.className = 'instructions';
      } else {
        feedback.textContent = `Has encertat ${scoredCount} de 10 paraules a la primera. Continua practicant!`;
        feedback.className = 'instructions';
      }
      feedback.style.display = 'block';
    }

    function resetAllWords() {
      currentExerciseWords.forEach((_, index) => {
        userSeparators[index] = [];
        renderWord(index);
        wordStatus[index] = { checked: false, correct: false, attempts: 0, scored: false, late: false };
        softResetWordDisplay(index);
      });
      updateGlobalScore();
      feedback.style.display = 'none';
    }

    function updateGlobalScore() {
      const scoredCount = Object.values(wordStatus).filter((s) => s.scored).length;
      const checkedCount = Object.values(wordStatus).filter((s) => s.checked).length;
      scoreElement.textContent = `Paraules encertades: ${scoredCount}/10 (${checkedCount} comprovades)`;
      progressBar.style.width = `${(scoredCount / 10) * 100}%`;
    }

    function updateScore(correctCount = 0) {
      scoreElement.textContent = `Paraules encertades: ${correctCount}/10 (0 comprovades)`;
      progressBar.style.width = `${(correctCount / 10) * 100}%`;
    }

    checkAllBtn.addEventListener('click', checkAllAnswers);
    resetAllBtn.addEventListener('click', resetAllWords);
    newExerciseBtn.addEventListener('click', generateNewExercise);

    generateNewExercise();

    /* ===== NOVA L√íGICA: Accentuaci√≥ d'esdr√∫ixoles ===== */
    const ACCENT_WORDS = [
      { plain: "musica", target: "m√∫sica" },
      { plain: "camera", target: "c√†mera" },
      { plain: "pagina", target: "p√†gina" },
      { plain: "hipotesi", target: "hip√≤tesi" },
      { plain: "familia", target: "fam√≠lia" },
      { plain: "clinica", target: "cl√≠nica" },
      { plain: "fisica", target: "f√≠sica" },
      { plain: "elegancia", target: "eleg√†ncia" },
      { plain: "coherencia", target: "coher√®ncia" },
      { plain: "ocurrencia", target: "ocurr√®ncia" },
      { plain: "al¬∑lergia", target: "al¬∑l√®rgia" },
      { plain: "ambulancia", target: "ambul√†ncia" },
      { plain: "angunia", target: "ang√∫nia" },
      { plain: "esdruixola", target: "esdr√∫ixola" },
      { plain: "ciencia", target: "ci√®ncia" },
      { plain: "historia", target: "hist√≤ria" },
      { plain: "victoria", target: "vict√≤ria" },
      { plain: "estatua", target: "est√†tua" },
      { plain: "infancia", target: "inf√†ncia" },
      { plain: "quilometre", target: "quil√≤metre" },
      { plain: "industria", target: "ind√∫stria" },
      { plain: "colonia", target: "col√≤nia" },
      { plain: "solitaria", target: "solit√†ria" },
      { plain: "memories", target: "mem√≤ries" },
      { plain: "gabies", target: "g√†bies" },
      { plain: "miseria", target: "mis√®ria" },
      { plain: "materia", target: "mat√®ria" },
      { plain: "galaxies", target: "gal√†xies" },
      { plain: "farmacia", target: "farm√†cia" },
      { plain: "assistencia", target: "assist√®ncia" },
      { plain: "area", target: "√†rea" },
      { plain: "fucsia", target: "f√∫csia" },
      { plain: "justicia", target: "just√≠cia" },
      { plain: "mutua", target: "m√∫tua" },
      { plain: "guardia", target: "gu√†rdia" },
      { plain: "radio", target: "r√†dio" },
      { plain: "anecdota", target: "an√®cdota" },
      { plain: "decimes", target: "d√®cimes" },
      { plain: "metode", target: "m√®tode" },
      { plain: "etcetera", target: "etc√®tera" },
      { plain: "tenue", target: "t√®nue" },
      { plain: "comedia", target: "com√®dia" },
      { plain: "comode", target: "c√≤mode" },
      { plain: "opera", target: "√≤pera" },
      { plain: "copia", target: "c√≤pia" },
      { plain: "memoria", target: "mem√≤ria" },
      { plain: "ferestega", target: "fer√©stega" },
      { plain: "cervola", target: "c√©rvola" },
      { plain: "esglesia", target: "esgl√©sia" },
      { plain: "escorpora", target: "esc√≥rpora" },
      { plain: "formula", target: "f√≥rmula" },
      { plain: "polvora", target: "p√≥lvora" },
      { plain: "tombola", target: "t√≥mbola" },
      { plain: "tortores", target: "t√≥rtores" }
    ];

    const accentExercise = document.getElementById('accent-exercise');
    const accentCheckAllBtn = document.getElementById('accent-check-all-btn');
    const accentResetAllBtn = document.getElementById('accent-reset-all-btn');
    const accentNewExerciseBtn = document.getElementById('accent-new-exercise-btn');
    const accentScoreEl = document.getElementById('accent-score');
    const accentProgressEl = document.getElementById('accent-progress');
    const accentFeedbackEl = document.getElementById('accent-feedback');

    let currentAccentWords = [];
    let userAccent = {};
    let accentStatus = {};

    const CYCLE_SETS = {
      'A': ['A','√Ä','√Å'],
      'a': ['a','√†','√°'],
      'E': ['E','√à','√â'],
      'e': ['e','√®','√©'],
      'I': ['I','√ç'],
      'i': ['i','√≠'],
      'O': ['O','√í','√ì'],
      'o': ['o','√≤','√≥'],
      'U': ['U','√ö'],
      'u': ['u','√∫']
    };

    function cycleChar(ch) {
      for (const seq of Object.values(CYCLE_SETS)) {
        const idx = seq.indexOf(ch);
        if (idx !== -1) return seq[(idx + 1) % seq.length];
      }
      return ch;
    }

    function generateAccentExercise() {
      currentAccentWords = [...ACCENT_WORDS].sort(() => Math.random() - 0.5).slice(0, 10);
      userAccent = {};
      accentStatus = {};
      accentExercise.innerHTML = '';
      updateAccentScore();
      accentFeedbackEl.style.display = 'none';

      currentAccentWords.forEach((item, index) => {
        const initial = item.plain;
        userAccent[index] = initial;
        accentStatus[index] = { checked: false, correct: false, attempts: 0, scored: false, late: false };

        const card = document.createElement('div');
        card.className = 'word-exercise';
        card.id = `accent-card-${index}`;

        card.innerHTML = `
          <div class="word-title">
            <span class="card-index">${index + 1}</span>
            <span class="word-status" id="accent-status-${index}">Pendent</span>
          </div>
          <div class="word-container" id="accent-container-${index}" tabindex="0"
               aria-label="Paraula sense accent: ${initial}. Clica les vocals per afegir-ne."></div>
          <div class="word-controls">
            <button class="word-check-btn" data-index="${index}" aria-label="Comprova la paraula">Comprova-ho</button>
          </div>
          <div class="word-feedback" id="accent-feedback-${index}" aria-live="polite"></div>
        `;
        accentExercise.appendChild(card);
        renderAccentWord(index);

        const checkBtn = card.querySelector('.word-check-btn');
        checkBtn.addEventListener('click', () => checkSingleAccent(index));
        const container = document.getElementById(`accent-container-${index}`);
        container.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkSingleAccent(index); });
      });
    }

    function renderAccentWord(index) {
      const container = document.getElementById(`accent-container-${index}`);
      container.innerHTML = '';
      const current = userAccent[index];
      for (let i = 0; i < current.length; i++) {
        const ch = current[i];
        if (ch === '¬∑') {
          const dot = document.createElement('span');
          dot.className = 'special-char';
          dot.textContent = '¬∑';
          container.appendChild(dot);
          continue;
        }
        const span = document.createElement('span');
        span.className = 'letter';
        span.textContent = ch;
        span.dataset.index = i;

        span.addEventListener('click', () => {
          const live = userAccent[index];
          const arr = live.split('');
          arr[i] = cycleChar(arr[i]);
          userAccent[index] = arr.join('');
          renderAccentWord(index);
          if (accentStatus[index].checked) softResetAccentDisplay(index);
        });

        span.addEventListener('keydown', (e) => {
          if (e.key === ' ') {
            e.preventDefault();
            const live = userAccent[index];
            const arr = live.split('');
            arr[i] = cycleChar(arr[i]);
            userAccent[index] = arr.join('');
            renderAccentWord(index);
            if (accentStatus[index].checked) softResetAccentDisplay(index);
          } else if (e.key === 'Enter') {
            checkSingleAccent(index);
          }
        });

        span.tabIndex = 0;
        container.appendChild(span);
      }
    }

    function softResetAccentDisplay(index) {
      accentStatus[index].checked = false;
      accentStatus[index].correct = false;
      const card = document.getElementById(`accent-card-${index}`);
      const st = document.getElementById(`accent-status-${index}`);
      const fb = document.getElementById(`accent-feedback-${index}`);
      card.className = 'word-exercise';
      st.textContent = 'Pendent';
      st.className = 'word-status';
      fb.textContent = '';
      fb.className = 'word-feedback';
    }

    function updateAccentDisplay(index, state, solution) {
      const card = document.getElementById(`accent-card-${index}`);
      const st = document.getElementById(`accent-status-${index}`);
      const fb = document.getElementById(`accent-feedback-${index}`);
      const messages = feedbackMessages.accent[state];
      
      card.className = `word-exercise ${state}`;
      st.textContent = state === 'incorrect' ? 'Incorrecte' : 'Correcte';
      st.className = `word-status ${state}`;
      
      // Crear el feedback amb icona i text
      fb.innerHTML = `
        <span class="feedback-icon">${messages.icon}</span>
        <span>${messages.text}</span>
      `;
      fb.className = `word-feedback ${state}`;
    }

    function checkSingleAccent(index) {
      const item = currentAccentWords[index];
      accentStatus[index].attempts += 1;

      const isCorrect = userAccent[index] === item.target;

      if (isCorrect && accentStatus[index].attempts === 1) {
        accentStatus[index].scored = true; 
        accentStatus[index].late = false;
      }
      if (isCorrect && accentStatus[index].attempts > 1) {
        accentStatus[index].scored = accentStatus[index].scored || false;
        accentStatus[index].late = !accentStatus[index].scored;
      }

      accentStatus[index].checked = true;
      accentStatus[index].correct = isCorrect;

      updateAccentDisplay(index, isCorrect ? (accentStatus[index].late ? 'late' : 'correct') : 'incorrect', item.target);
      updateAccentScore();
    }

    function checkAllAccents() {
      currentAccentWords.forEach((_, idx) => { if (!accentStatus[idx].checked) checkSingleAccent(idx); });
      const scoredCount = Object.values(accentStatus).filter(s => s.scored).length;
      if (scoredCount === 10) {
        accentFeedbackEl.textContent = 'Brutal! Has accentuat totes les paraules a la primera.';
      } else {
        accentFeedbackEl.textContent = `Has encertat ${scoredCount} de 10 paraules a la primera. Torna-ho a provar!`;
      }
      accentFeedbackEl.className = 'instructions';
      accentFeedbackEl.style.display = 'block';
    }

    function resetAllAccents() {
      currentAccentWords.forEach((item, idx) => {
        userAccent[idx] = item.plain;
        renderAccentWord(idx);
        accentStatus[idx] = { checked: false, correct: false, attempts: 0, scored: false, late: false };
        softResetAccentDisplay(idx);
      });
      updateAccentScore();
      accentFeedbackEl.style.display = 'none';
    }

    function updateAccentScore() {
      const scored = Object.values(accentStatus).filter(s => s.scored).length;
      const checked = Object.values(accentStatus).filter(s => s.checked).length;
      accentScoreEl.textContent = `Paraules encertades: ${scored}/10 (${checked} comprovades)`;
      accentProgressEl.style.width = `${(scored / 10) * 100}%`;
    }

    accentCheckAllBtn.addEventListener('click', checkAllAccents);
    accentResetAllBtn.addEventListener('click', resetAllAccents);
    accentNewExerciseBtn.addEventListener('click', generateAccentExercise);

    generateAccentExercise();

    /* ===== NOVA L√íGICA: Exercici de s√≠l¬∑laba t√≤nica amb √†udio ===== */
    const TONIC_WORDS = [
      { word: "m√∫sica", syllables: ["m√∫", "si", "ca"], tonicIndex: 0 },
      { word: "c√†mera", syllables: ["c√†", "me", "ra"], tonicIndex: 0 },
      { word: "p√†gina", syllables: ["p√†", "gi", "na"], tonicIndex: 0 },
      { word: "hip√≤tesi", syllables: ["hi", "p√≤", "te", "si"], tonicIndex: 1 },
      { word: "fam√≠lia", syllables: ["fa", "m√≠", "li", "a"], tonicIndex: 1 },
      { word: "cl√≠nica", syllables: ["cl√≠", "ni", "ca"], tonicIndex: 0 },
      { word: "f√≠sica", syllables: ["f√≠", "si", "ca"], tonicIndex: 0 },
      { word: "eleg√†ncia", syllables: ["e", "le", "g√†n", "ci", "a"], tonicIndex: 2 },
      { word: "coher√®ncia", syllables: ["co", "he", "r√®n", "ci", "a"], tonicIndex: 2 },
      { word: "ocurr√®ncia", syllables: ["o", "cur", "r√®n", "ci", "a"], tonicIndex: 2 },
      { word: "al¬∑l√®rgia", syllables: ["al", "l√®r", "gi", "a"], tonicIndex: 1 },
      { word: "ambul√†ncia", syllables: ["am", "bu", "l√†n", "ci", "a"], tonicIndex: 2 },
      { word: "ang√∫nia", syllables: ["an", "g√∫", "ni", "a"], tonicIndex: 1 },
      { word: "esdr√∫ixola", syllables: ["es", "dr√∫i", "xo", "la"], tonicIndex: 1 },
      { word: "ci√®ncia", syllables: ["ci", "√®n", "ci", "a"], tonicIndex: 1 },
      { word: "hist√≤ria", syllables: ["his", "t√≤", "ri", "a"], tonicIndex: 1 },
      { word: "vict√≤ria", syllables: ["vic", "t√≤", "ri", "a"], tonicIndex: 1 },
      { word: "est√†tua", syllables: ["es", "t√†", "tu", "a"], tonicIndex: 1 },
      { word: "inf√†ncia", syllables: ["in", "f√†n", "ci", "a"], tonicIndex: 1 },
      { word: "quil√≤metre", syllables: ["qui", "l√≤", "me", "tre"], tonicIndex: 1 },
      { word: "ind√∫stria", syllables: ["in", "d√∫s", "tri", "a"], tonicIndex: 1 },
      { word: "col√≤nia", syllables: ["co", "l√≤", "ni", "a"], tonicIndex: 1 },
      { word: "solit√†ria", syllables: ["so", "li", "t√†", "ri", "a"], tonicIndex: 2 },
      { word: "mem√≤ries", syllables: ["me", "m√≤", "ri", "es"], tonicIndex: 1 },
      { word: "g√†bies", syllables: ["g√†", "bi", "es"], tonicIndex: 0 },
      { word: "mis√®ria", syllables: ["mi", "s√®", "ri", "a"], tonicIndex: 1 },
      { word: "mat√®ria", syllables: ["ma", "t√®", "ri", "a"], tonicIndex: 1 },
      { word: "gal√†xies", syllables: ["ga", "l√†", "xi", "es"], tonicIndex: 1 },
      { word: "farm√†cia", syllables: ["far", "m√†", "ci", "a"], tonicIndex: 1 },
      { word: "assist√®ncia", syllables: ["as", "sis", "t√®n", "ci", "a"], tonicIndex: 2 },
      { word: "√†rea", syllables: ["√†", "re", "a"], tonicIndex: 0 },
      { word: "f√∫csia", syllables: ["f√∫c", "si", "a"], tonicIndex: 0 },
      { word: "just√≠cia", syllables: ["jus", "t√≠", "ci", "a"], tonicIndex: 1 },
      { word: "m√∫tua", syllables: ["m√∫", "tu", "a"], tonicIndex: 0 },
      { word: "gu√†rdia", syllables: ["gu√†r", "di", "a"], tonicIndex: 0 },
      { word: "r√†dio", syllables: ["r√†", "di", "o"], tonicIndex: 0 },
      { word: "an√®cdota", syllables: ["a", "n√®c", "do", "ta"], tonicIndex: 1 },
      { word: "d√®cimes", syllables: ["d√®", "ci", "mes"], tonicIndex: 0 },
      { word: "m√®tode", syllables: ["m√®", "to", "de"], tonicIndex: 0 },
      { word: "etc√®tera", syllables: ["et", "c√®", "te", "ra"], tonicIndex: 1 },
      { word: "t√®nue", syllables: ["t√®", "nu", "e"], tonicIndex: 0 },
      { word: "com√®dia", syllables: ["co", "m√®", "di", "a"], tonicIndex: 1 },
      { word: "c√≤mode", syllables: ["c√≤", "mo", "de"], tonicIndex: 0 },
      { word: "√≤pera", syllables: ["√≤", "pe", "ra"], tonicIndex: 0 },
      { word: "c√≤pia", syllables: ["c√≤", "pi", "a"], tonicIndex: 0 },
      { word: "mem√≤ria", syllables: ["me", "m√≤", "ri", "a"], tonicIndex: 1 },
      { word: "fer√©stega", syllables: ["fe", "r√©s", "te", "ga"], tonicIndex: 1 },
      { word: "c√©rvola", syllables: ["c√©r", "vo", "la"], tonicIndex: 0 },
      { word: "esgl√©sia", syllables: ["es", "gl√©", "si", "a"], tonicIndex: 1 },
      { word: "esc√≥rpora", syllables: ["es", "c√≥r", "po", "ra"], tonicIndex: 1 },
      { word: "f√≥rmula", syllables: ["f√≥r", "mu", "la"], tonicIndex: 0 },
      { word: "p√≥lvora", syllables: ["p√≥l", "vo", "ra"], tonicIndex: 0 },
      { word: "t√≥mbola", syllables: ["t√≥m", "bo", "la"], tonicIndex: 0 },
      { word: "t√≥rtores", syllables: ["t√≥r", "to", "res"], tonicIndex: 0 }
    ];

    const tonicaExercise = document.getElementById('tonica-exercise');
    const tonicaCheckAllBtn = document.getElementById('tonica-check-all-btn');
    const tonicaResetAllBtn = document.getElementById('tonica-reset-all-btn');
    const tonicaNewExerciseBtn = document.getElementById('tonica-new-exercise-btn');
    const tonicaScoreEl = document.getElementById('tonica-score');
    const tonicaProgressEl = document.getElementById('tonica-progress');
    const tonicaFeedbackEl = document.getElementById('tonica-feedback');

    let currentTonicWords = [];
    let userTonicSelection = {};
    let tonicStatus = {};

    // Funci√≥ per parlar text (utilitza l'API Web Speech)
    function speakText(text, lang = 'ca-ES') {
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = lang;
        utterance.rate = 0.9;
        utterance.pitch = 1;
        speechSynthesis.speak(utterance);
        return utterance;
      } else {
        console.warn('SpeechSynthesis no est√† suportat en aquest navegador');
        return null;
      }
    }

    function generateTonicExercise() {
      currentTonicWords = [...TONIC_WORDS].sort(() => Math.random() - 0.5).slice(0, 10);
      userTonicSelection = {};
      tonicStatus = {};
      tonicaExercise.innerHTML = '';
      updateTonicScore();
      tonicaFeedbackEl.style.display = 'none';

      currentTonicWords.forEach((item, index) => {
        userTonicSelection[index] = null;
        tonicStatus[index] = { checked: false, correct: false, attempts: 0, scored: false, late: false };

        const card = document.createElement('div');
        card.className = 'word-exercise';
        card.id = `tonic-card-${index}`;

        card.innerHTML = `
          <div class="word-title">
            <span class="card-index">${index + 1}</span>
            <span class="word-status" id="tonic-status-${index}">Pendent</span>
          </div>
          <div class="word-container">
            <button class="audio-btn" id="audio-btn-${index}" aria-label="Escolta la paraula">
              <span>üéµ</span> Escolta la paraula
            </button>
            <div class="dots-container" id="dots-container-${index}" aria-label="Selecciona la s√≠l¬∑laba t√≤nica"></div>
          </div>
          <div class="word-controls">
            <button class="word-check-btn" data-index="${index}" aria-label="Comprova la s√≠l¬∑laba t√≤nica">Comprova-ho</button>
          </div>
          <div class="word-feedback" id="tonic-feedback-${index}" aria-live="polite"></div>
        `;
        tonicaExercise.appendChild(card);
        
        renderTonicDots(index);
        
        const audioBtn = document.getElementById(`audio-btn-${index}`);
        audioBtn.addEventListener('click', () => {
          speechSynthesis.cancel();
          audioBtn.classList.add('playing');
          
          const utterance = speakText(item.word);
          
          if (utterance) {
            utterance.onend = () => {
              audioBtn.classList.remove('playing');
            };
          } else {
            setTimeout(() => {
              audioBtn.classList.remove('playing');
            }, 1500);
          }
        });

        const checkBtn = card.querySelector('.word-check-btn');
        checkBtn.addEventListener('click', () => checkSingleTonic(index));
        
        card.addEventListener('keydown', (e) => { 
          if (e.key === 'Enter' && e.target.classList.contains('word-check-btn')) {
            checkSingleTonic(index);
          }
        });
      });
    }

    function renderTonicDots(index) {
      const container = document.getElementById(`dots-container-${index}`);
      container.innerHTML = '';
      const item = currentTonicWords[index];
      
      item.syllables.forEach((_, syllableIndex) => {
        const dot = document.createElement('div');
        dot.className = 'dot';
        dot.dataset.index = syllableIndex;
        dot.setAttribute('role', 'button');
        dot.setAttribute('tabindex', '0');
        dot.setAttribute('aria-label', `S√≠l¬∑laba ${syllableIndex + 1}`);
        
        dot.addEventListener('click', () => {
          if (userTonicSelection[index] === syllableIndex) {
            userTonicSelection[index] = null;
          } else {
            userTonicSelection[index] = syllableIndex;
          }
          renderTonicDots(index);
          if (tonicStatus[index].checked) softResetTonicDisplay(index);
        });
        
        dot.addEventListener('keydown', (e) => {
          if (e.key === ' ' || e.key === 'Enter') {
            e.preventDefault();
            if (userTonicSelection[index] === syllableIndex) {
              userTonicSelection[index] = null;
            } else {
              userTonicSelection[index] = syllableIndex;
            }
            renderTonicDots(index);
            if (tonicStatus[index].checked) softResetTonicDisplay(index);
          }
        });
        
        if (userTonicSelection[index] === syllableIndex) {
          dot.classList.add('selected');
        }
        
        container.appendChild(dot);
      });
    }

    function softResetTonicDisplay(index) {
      tonicStatus[index].checked = false;
      tonicStatus[index].correct = false;
      const card = document.getElementById(`tonic-card-${index}`);
      const st = document.getElementById(`tonic-status-${index}`);
      const fb = document.getElementById(`tonic-feedback-${index}`);
      card.className = 'word-exercise';
      st.textContent = 'Pendent';
      st.className = 'word-status';
      fb.textContent = '';
      fb.className = 'word-feedback';
      renderTonicDots(index);
    }

    function updateTonicDisplay(index, state) {
      const card = document.getElementById(`tonic-card-${index}`);
      const st = document.getElementById(`tonic-status-${index}`);
      const fb = document.getElementById(`tonic-feedback-${index}`);
      const item = currentTonicWords[index];
      const messages = feedbackMessages.tonic[state];
      
      const container = document.getElementById(`dots-container-${index}`);
      const dots = container.querySelectorAll('.dot');
      
      dots.forEach((dot, syllableIndex) => {
        dot.classList.remove('selected', 'correct', 'incorrect', 'late');
        
        if (state === 'correct' || state === 'late') {
          if (syllableIndex === item.tonicIndex) {
            dot.classList.add(state === 'correct' ? 'correct' : 'late');
          }
        } else if (state === 'incorrect') {
          if (syllableIndex === item.tonicIndex) {
            dot.classList.add('correct');
          } else if (syllableIndex === userTonicSelection[index]) {
            dot.classList.add('incorrect');
          }
        }
      });
      
      card.className = `word-exercise ${state}`;
      st.textContent = state === 'incorrect' ? 'Incorrecte' : 'Correcte';
      st.className = `word-status ${state}`;
      
      // Crear el feedback amb icona i text
      fb.innerHTML = `
        <span class="feedback-icon">${messages.icon}</span>
        <span>${messages.text}</span>
      `;
      fb.className = `word-feedback ${state}`;
    }

    function checkSingleTonic(index) {
      const item = currentTonicWords[index];
      tonicStatus[index].attempts += 1;

      const isCorrect = userTonicSelection[index] === item.tonicIndex;

      if (isCorrect && tonicStatus[index].attempts === 1) {
        tonicStatus[index].scored = true; 
        tonicStatus[index].late = false;
      }
      
      if (isCorrect && tonicStatus[index].attempts > 1) {
        tonicStatus[index].scored = tonicStatus[index].scored || false;
        tonicStatus[index].late = !tonicStatus[index].scored;
      }

      tonicStatus[index].checked = true;
      tonicStatus[index].correct = isCorrect;

      updateTonicDisplay(index, isCorrect ? (tonicStatus[index].late ? 'late' : 'correct') : 'incorrect');
      updateTonicScore();
    }

    function checkAllTonics() {
      currentTonicWords.forEach((_, idx) => { 
        if (!tonicStatus[idx].checked) checkSingleTonic(idx); 
      });
      const scoredCount = Object.values(tonicStatus).filter(s => s.scored).length;
      if (scoredCount === 10) {
        tonicaFeedbackEl.textContent = 'Perfecte! Has identificat totes les s√≠l¬∑labes t√≤niques a la primera.';
      } else {
        tonicaFeedbackEl.textContent = `Has encertat ${scoredCount} de 10 s√≠l¬∑labes t√≤niques a la primera. Continua practicant!`;
      }
      tonicaFeedbackEl.className = 'instructions';
      tonicaFeedbackEl.style.display = 'block';
    }

    function resetAllTonics() {
      currentTonicWords.forEach((item, idx) => {
        userTonicSelection[idx] = null;
        renderTonicDots(idx);
        tonicStatus[idx] = { checked: false, correct: false, attempts: 0, scored: false, late: false };
        softResetTonicDisplay(idx);
      });
      updateTonicScore();
      tonicaFeedbackEl.style.display = 'none';
    }

    function updateTonicScore() {
      const scored = Object.values(tonicStatus).filter(s => s.scored).length;
      const checked = Object.values(tonicStatus).filter(s => s.checked).length;
      tonicaScoreEl.textContent = `Paraules encertades: ${scored}/10 (${checked} comprovades)`;
      tonicaProgressEl.style.width = `${(scored / 10) * 100}%`;
    }

    tonicaCheckAllBtn.addEventListener('click', checkAllTonics);
    tonicaResetAllBtn.addEventListener('click', resetAllTonics);
    tonicaNewExerciseBtn.addEventListener('click', generateTonicExercise);

    generateTonicExercise();

/* ===== L√íGICA: Paraules en Context (ID√àNTICA a Accentuaci√≥ d'esdr√∫ixoles) ===== */
const CONTEXT_PHRASES = [
  { plain: "‚ÄîCom us expliqueu aquesta coincidencia tan singular?", target: "‚ÄîCom us expliqueu aquesta coincid√®ncia tan singular?" },
  { plain: "Els casos son a milers, i extraordinariament populars...", target: "Els casos s√≥n a milers, i extraordin√†riament populars..." },
  { plain: "Desitjaria que em tinguessiu al corrent de les vostres experiencies...", target: "Desitjaria que em tingu√©ssiu al corrent de les vostres experi√®ncies..." },
  { plain: "En dies successius ens visitarem amb freq√ºencia.", target: "En dies successius ens visit√†rem amb freq√º√®ncia." },
  { plain: "‚ÄîEstem passant sobre Armenia i ens dirigim cap al nord.", target: "‚ÄîEstem passant sobre Arm√®nia i ens dirigim cap al nord." },
  { plain: "‚ÄîPer que m'has fet cridar amb tanta urgencia?", target: "‚ÄîPer qu√® m'has fet cridar amb tanta urg√®ncia?" },
  { plain: "Encara vaig haver de donar-li les gracies.", target: "Encara vaig haver de donar-li les gr√†cies." },
  { plain: "La musica va omplir el local en un instant.", target: "La m√∫sica va omplir el local en un instant." },
  { plain: "Al pati del costat, uns senyors arreglats escoltaven la radio.", target: "Al pati del costat, uns senyors arreglats escoltaven la r√†dio." },
  { plain: "Jo m'adonava que vivia una experiencia inoblidable.", target: "Jo m'adonava que vivia una experi√®ncia inoblidable." },
  { plain: "I aixo, digui's el que es vulgui, es historia.", target: "I aix√≤, digui's el que es vulgui, √©s hist√≤ria." },
  { plain: "La convivencia amb una persona aixi era senzilla.", target: "La conviv√®ncia amb una persona aix√≠ era senzilla." },
  { plain: "Els diaris de la nit portaran la noticia de l'accident.", target: "Els diaris de la nit portaran la not√≠cia de l'accident." },
  { plain: "Coneixeu la historia de l'home de la barba?", target: "Coneixeu la hist√≤ria de l'home de la barba?" },
  { plain: "S'ha dit tant que les besties parlen!", target: "S'ha dit tant que les b√®sties parlen!" },
  { plain: "La nau brillava i emetia una fosforescencia intermitent.", target: "La nau brillava i emetia una fosforesc√®ncia intermitent." },
  { plain: "Els combustibles liquids son per als reactors d'emergencia.", target: "Els combustibles l√≠quids s√≥n per als reactors d'emerg√®ncia." },
  { plain: "Estic sorpresa, perque em pensava que tot aixo eren histories.", target: "Estic sorpresa, perqu√® em pensava que tot aix√≤ eren hist√≤ries." },
  { plain: "I si es tractes d'una paraula magica?", target: "I si es tract√©s d'una paraula m√†gica?" },
  { plain: "Aquestes coses, per sort, encara son voluntaries.", target: "Aquestes coses, per sort, encara s√≥n volunt√†ries." },
  { plain: "Ho deixarem en bra√ßos de la ciencia.", target: "Ho deixarem en bra√ßos de la ci√®ncia." },
  { plain: "Pero trobar pis vol temps i paciencia.", target: "Per√≤ trobar pis vol temps i paci√®ncia." },
  { plain: "‚ÄîPero si es una fabrica de sopes en sobres!", target: "‚ÄîPer√≤ si √©s una f√†brica de sopes en sobres!" },
  { plain: "Es respectaven mutuament i es tenien afecte.", target: "Es respectaven m√∫tuament i es tenien afecte." },
  { plain: "A la familia el disgust prengue proporcions dramatiques.", target: "A la fam√≠lia el disgust prengu√© proporcions dram√†tiques." },
  { plain: "‚ÄîTinc set ‚Äîdigue un adolescent, aprofitant una pausa momentania.", target: "‚ÄîTinc set ‚Äîdigu√© un adolescent, aprofitant una pausa moment√†nia." },
  { plain: "Jo, es clar, vaig posar-me en guardia.", target: "Jo, √©s clar, vaig posar-me en gu√†rdia." },
  { plain: "Va preguntar al pacient si experimentava alguna altra molestia.", target: "Va preguntar al pacient si experimentava alguna altra mol√®stia." },
  { plain: "‚ÄîNo vull cap examen, ni analisis ni radiografies ni res.", target: "‚ÄîNo vull cap examen, ni an√†lisis ni radiografies ni res." },
  { plain: "Tinc l'esperanca que, un dia o altre, arreglarem les diferencies.", target: "Tinc l'esperan√ßa que, un dia o altre, arreglarem les difer√®ncies." },
  { plain: "Aqu√≠ podriem penjar-hi una gabia amb un ocell.", target: "Aqu√≠ podr√≠em penjar-hi una g√†bia amb un ocell." },
  { plain: "Ara vol que li compri una radio!", target: "Ara vol que li compri una r√†dio!" },
  { plain: "La venedora encara em mira amb una certa impertinencia.", target: "La venedora encara em mira amb una certa impertin√®ncia." },
  { plain: "‚ÄîNo obstant aixo ‚Äîafegi‚Äî, la meva presencia sera util.", target: "‚ÄîNo obstant aix√≤ ‚Äîafeg√≠‚Äî, la meva pres√®ncia ser√† √∫til." },
  { plain: "Es com un cinema on passessin sempre la mateixa pel¬∑licula.", target: "√âs com un cinema on passessin sempre la mateixa pel¬∑l√≠cula." },
  { plain: "¬´I la historia¬ª, afegia morda√ßment, ¬´es irreversible¬ª.", target: "¬´I la hist√≤ria¬ª, afegia morda√ßment, ¬´√©s irreversible¬ª." },
  { plain: "Ara: si li donaven tanta importancia, alguna cosa devia tenir.", target: "Ara: si li donaven tanta import√†ncia, alguna cosa devia tenir." },
  { plain: "Movent la superficie de l'aigua, feia l'efecte que bategava.", target: "Movent la superf√≠cie de l'aigua, feia l'efecte que bategava." },
  { plain: "Jo dic que la lluna no te tanta importancia.", target: "Jo dic que la lluna no t√© tanta import√†ncia." },
  { plain: "‚ÄîJo crec que te importancia ‚Äîva dir amb discrecio‚Äî.", target: "‚ÄîJo crec que t√© import√†ncia ‚Äîva dir amb discreci√≥‚Äî." },
  { plain: "Es veu que no t'adones de les conseq√ºencies!", target: "Es veu que no t'adones de les conseq√º√®ncies!" },
  { plain: "A la teva epoca us complicaveu la vida.", target: "A la teva √®poca us complic√†veu la vida." },
  { plain: "La trajectoria cap a Mart s'ha seguit d'una manera impecable.", target: "La traject√≤ria cap a Mart s'ha seguit d'una manera impecable." },
  { plain: "Ara ens queda la ciencia pura i simple.", target: "Ara ens queda la ci√®ncia pura i simple." },
  { plain: "Si no t'expliques satisfactoriament, et negaran l'entrada.", target: "Si no t'expliques satisfact√≤riament, et negaran l'entrada." },
  { plain: "Al capdavall, aixo d'ara es una experiencia inoblidable.", target: "Al capdavall, aix√≤ d'ara √©s una experi√®ncia inoblidable." },
  { plain: "Mai no havia vist dues cares tan identiques...", target: "Mai no havia vist dues cares tan id√®ntiques..." },
  { plain: "‚ÄîPero hi ha situacions excepcionals ‚Äîvaig replicar timidament‚Äî.", target: "‚ÄîPer√≤ hi ha situacions excepcionals ‚Äîvaig replicar t√≠midament‚Äî." },
  { plain: "‚ÄîHe perdut la memoria i no la trobo enlloc!", target: "‚ÄîHe perdut la mem√≤ria i no la trobo enlloc!" },
  { plain: "‚ÄîDiria que soc un creient sense esglesia determinada...", target: "‚ÄîDiria que soc un creient esgl√©sia determinada..." },
  { plain: "La competencia, en aquest cas, es deslleial.", target: "La compet√®ncia, en aquest cas, √©s deslleial." },
  { plain: "T√®cnicament, no podem plegar ni podem continuar.", target: "T√®cnicament, no podem plegar ni podem continuar." },
  { plain: "‚ÄîI se'n poden treure conseq√ºencies, de tot plegat?", target: "‚ÄîI se'n poden treure conseq√º√®ncies, de tot plegat?" },
  { plain: "Pero de conseq√ºencies se'n poden treure sempre, de tot.", target: "Per√≤ de conseq√º√®ncies se'n poden treure sempre, de tot." },
  { plain: "La Gloria se'n va anar a fora.", target: "La Gl√≤ria se'n va anar a fora." },
  { plain: "Es va posar en guardia, sense la menor agitacio externa.", target: "Es va posar en gu√†rdia, sense la menor agitaci√≥ externa." },
  { plain: "Si mes no, riurem novament la gracia.", target: "Si m√©s no, riurem novament la gr√†cia." },
  { plain: "Aquesta es l'habitacio de la tieta Emilia.", target: "Aquesta √©s l'habitaci√≥ de la tieta Em√≠lia." },
  { plain: "Es famosa la gota simbolica que fa vessar els gots.", target: "√âs famosa la gota simb√≤lica que fa vessar els gots." },
  { plain: "Vaig accedir-hi, per una serie de motius.", target: "Vaig accedir-hi, per una s√®rie de motius." },
  { plain: "M'inclino per un afer clandesti de comer√ß de momies.", target: "M'inclino per un afer clandest√≠ de comer√ß de m√≤mies." },
  { plain: "‚ÄîPer estrany que resulti, obeeix a una logica implacable.", target: "‚ÄîPer estrany que resulti, obeeix a una l√≤gica implacable." },
  { plain: "‚ÄîI que en farem, de la momia?", target: "‚ÄîI qu√® en farem, de la m√≤mia?" },
  { plain: "Ja se qui es i conec tota la seva historia.", target: "Ja s√© qui √©s i conec tota la seva hist√≤ria." },
  { plain: "‚ÄîVoste deu tenir molt poca experiencia en q√ºestions policiaques.", target: "‚ÄîVost√® deu tenir molt poca experi√®ncia en q√ºestions polic√≠aques." },
  { plain: "Timidament, vaig dir-li: Es una noticia extraordinaria.", target: "T√≠midament, vaig dir-li: ‚Äî√âs una not√≠cia extraordin√†ria." },
  { plain: "En aquesta epoca, la ciutat es preciosa...", target: "En aquesta √®poca, la ciutat √©s preciosa..." },
  { plain: "‚ÄîHome, per a nosaltres son un punt de referencia.", target: "‚ÄîHome, per a nosaltres s√≥n un punt de refer√®ncia." },
  { plain: "Que no ho veu que aixo es un centre d'urgencies?", target: "Que no ho veu que aix√≤ √©s un centre d'urg√®ncies?" },
  { plain: "Al final, digue: Hi hem d'anar amb una gran prudencia.", target: "Al final, digu√©: ‚ÄîHi hem d'anar amb una gran prud√®ncia." },
  { plain: "Desentona, encara que es mogui amb eficacia.", target: "Desentona, encara que es mogui amb efic√†cia." },
  { plain: "Pero quant a determinats detalls hi havia diferencies.", target: "Per√≤ quant a determinats detalls hi havia difer√®ncies." },
  { plain: "Et vinc a fer una confidencia, em digue.", target: "¬´Et vinc a fer una confid√®ncia¬ª, em digu√©." },
  { plain: "Pero nosaltres no portem mai la contraria al client.", target: "Per√≤ nosaltres no portem mai la contr√†ria al client." },
  { plain: "‚ÄîTenint en compte les circumstancies, es podria dir que si.", target: "‚ÄîTenint en compte les circumst√†ncies, es podria dir que s√≠." },
  { plain: "La Claudia digue: ‚ÄîI que farem, ara?", target: "La Cl√†udia digu√©: ‚ÄîI qu√® farem, ara?" }
];

const contextExercise = document.getElementById('context-exercise');
const contextCheckAllBtn = document.getElementById('context-check-all-btn');
const contextResetAllBtn = document.getElementById('context-reset-all-btn');
const contextNewExerciseBtn = document.getElementById('context-new-exercise-btn');
const contextScoreEl = document.getElementById('context-score');
const contextProgressEl = document.getElementById('context-progress');
const contextFeedbackEl = document.getElementById('context-feedback');

let currentContextPhrases = [];
let userContextState = {};
let contextStatus = {};

function generateContextExercise() {
  currentContextPhrases = [...CONTEXT_PHRASES].sort(() => Math.random() - 0.5).slice(0, 10);
  userContextState = {};
  contextStatus = {};
  contextExercise.innerHTML = '';
  updateContextScore();
  contextFeedbackEl.style.display = 'none';

  currentContextPhrases.forEach((item, index) => {
    const initial = item.plain;
    userContextState[index] = initial;
    contextStatus[index] = { checked: false, correct: false, attempts: 0, scored: false, late: false };

    const card = document.createElement('div');
    card.className = 'word-exercise';
    card.id = `context-card-${index}`;

    card.innerHTML = `
      <div class="word-title">
        <span class="card-index">${index + 1}</span>
        <span class="word-status" id="context-status-${index}">Pendent</span>
      </div>
      <div class="phrase-content" id="context-container-${index}" tabindex="0"
           aria-label="Frase: ${initial}. Clica les lletres per afegir accents."></div>
      <div class="word-controls">
        <button class="word-check-btn" data-index="${index}" aria-label="Comprova la frase">Comprova-ho</button>
      </div>
      <div class="word-feedback" id="context-feedback-${index}" aria-live="polite"></div>
    `;
    contextExercise.appendChild(card);
    renderContextPhrase(index);

    const checkBtn = card.querySelector('.word-check-btn');
    checkBtn.addEventListener('click', () => checkSingleContext(index));
    const container = document.getElementById(`context-container-${index}`);
    container.addEventListener('keydown', (e) => { if (e.key === 'Enter') checkSingleContext(index); });
  });
}

function renderContextPhrase(index) {
  const container = document.getElementById(`context-container-${index}`);
  container.innerHTML = '';
  const current = userContextState[index];
  
  for (let i = 0; i < current.length; i++) {
    const ch = current[i];
    
    // Tractar espais
    if (ch === ' ') {
      const spaceSpan = document.createElement('span');
      spaceSpan.textContent = ' ';
      spaceSpan.className = 'letter space';
      spaceSpan.dataset.index = i;
      container.appendChild(spaceSpan);
      continue;
    }
    
    // Tractar signes de puntuaci√≥ (tamb√© clicables per consist√®ncia)
    if (/[.,;!?'"-]/.test(ch)) {
      const punctSpan = document.createElement('span');
      punctSpan.textContent = ch;
      punctSpan.className = 'letter';
      punctSpan.dataset.index = i;
      
      // Fer tamb√© clicable (per si acas hi ha accents en puntuaci√≥)
      punctSpan.addEventListener('click', () => {
        const live = userContextState[index];
        const arr = live.split('');
        arr[i] = cycleChar(arr[i]);
        userContextState[index] = arr.join('');
        renderContextPhrase(index);
        if (contextStatus[index].checked) softResetContextDisplay(index);
      });
      
      container.appendChild(punctSpan);
      continue;
    }
    
    // Lletres normals (clicables)
    const span = document.createElement('span');
    span.className = 'letter';
    span.textContent = ch;
    span.dataset.index = i;

    // Fer les lletres clicables per canviar accents
    span.addEventListener('click', () => {
      const live = userContextState[index];
      const arr = live.split('');
      arr[i] = cycleChar(arr[i]);
      userContextState[index] = arr.join('');
      renderContextPhrase(index);
      if (contextStatus[index].checked) softResetContextDisplay(index);
    });

    span.addEventListener('keydown', (e) => {
      if (e.key === ' ') {
        e.preventDefault();
        const live = userContextState[index];
        const arr = live.split('');
        arr[i] = cycleChar(arr[i]);
        userContextState[index] = arr.join('');
        renderContextPhrase(index);
        if (contextStatus[index].checked) softResetContextDisplay(index);
      } else if (e.key === 'Enter') {
        checkSingleContext(index);
      }
    });

    span.tabIndex = 0;
    container.appendChild(span);
  }
}
function softResetContextDisplay(index) {
  contextStatus[index].checked = false;
  contextStatus[index].correct = false;
  const card = document.getElementById(`context-card-${index}`);
  const st = document.getElementById(`context-status-${index}`);
  const fb = document.getElementById(`context-feedback-${index}`);
  card.className = 'word-exercise';
  st.textContent = 'Pendent';
  st.className = 'word-status';
  fb.textContent = '';
  fb.className = 'word-feedback';
}

function updateContextDisplay(index, state, solution) {
  const card = document.getElementById(`context-card-${index}`);
  const st = document.getElementById(`context-status-${index}`);
  const fb = document.getElementById(`context-feedback-${index}`);
  const messages = feedbackMessages.context[state];
  
  card.className = `word-exercise ${state}`;
  st.textContent = state === 'incorrect' ? 'Incorrecte' : 'Correcte';
  st.className = `word-status ${state}`;
  
  // Crear el feedback amb icona i text
  fb.innerHTML = `
    <span class="feedback-icon">${messages.icon}</span>
    <span>${messages.text}</span>
  `;
  
  // Si √©s incorrecte, mostrar la soluci√≥
  if (state === 'incorrect') {
    fb.innerHTML += `<br><small>Correcte: <strong>${solution}</strong></small>`;
  }
  
  fb.className = `word-feedback ${state}`;
}

function checkSingleContext(index) {
  const item = currentContextPhrases[index];
  contextStatus[index].attempts += 1;

  const isCorrect = userContextState[index] === item.target;

  if (isCorrect && contextStatus[index].attempts === 1) {
    contextStatus[index].scored = true; 
    contextStatus[index].late = false;
  }
  if (isCorrect && contextStatus[index].attempts > 1) {
    contextStatus[index].scored = contextStatus[index].scored || false;
    contextStatus[index].late = !contextStatus[index].scored;
  }

  contextStatus[index].checked = true;
  contextStatus[index].correct = isCorrect;

  updateContextDisplay(index, isCorrect ? (contextStatus[index].late ? 'late' : 'correct') : 'incorrect', item.target);
  updateContextScore();
}

function checkAllContexts() {
  currentContextPhrases.forEach((_, idx) => { if (!contextStatus[idx].checked) checkSingleContext(idx); });
  const scoredCount = Object.values(contextStatus).filter(s => s.scored).length;
  if (scoredCount === 10) {
    contextFeedbackEl.textContent = 'Excel¬∑lent! Has accentuat totes les frases correctament a la primera.';
  } else {
    contextFeedbackEl.textContent = `Has encertat ${scoredCount} de 10 frases a la primera. Continua practicant!`;
  }
  contextFeedbackEl.className = 'instructions';
  contextFeedbackEl.style.display = 'block';
}

function resetAllContexts() {
  currentContextPhrases.forEach((item, idx) => {
    userContextState[idx] = item.plain;
    renderContextPhrase(idx);
    contextStatus[idx] = { checked: false, correct: false, attempts: 0, scored: false, late: false };
    softResetContextDisplay(idx);
  });
  updateContextScore();
  contextFeedbackEl.style.display = 'none';
}

function updateContextScore() {
  const scored = Object.values(contextStatus).filter(s => s.scored).length;
  const checked = Object.values(contextStatus).filter(s => s.checked).length;
  contextScoreEl.textContent = `Frases encertades: ${scored}/10 (${checked} comprovades)`;
  contextProgressEl.style.width = `${(scored / 10) * 100}%`;
}

// Configurar esdeveniments
contextCheckAllBtn.addEventListener('click', checkAllContexts);
contextResetAllBtn.addEventListener('click', resetAllContexts);
contextNewExerciseBtn.addEventListener('click', generateContextExercise);

// Generar exercici inicial
generateContextExercise();
  </script>
</body>
</html>
